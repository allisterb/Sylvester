(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3;a=self;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Array=c.Array||{};e=c.String=c.String||{};f=c.List=c.List||{};g=c.Abbrev=c.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=b&&b.Obj;l=g.Slot=g.Slot||{};m=g.Async=g.Async||{};n=g.Mailbox=g.Mailbox||{};o=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};p=c.AppendList=c.AppendList||{};q=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};r=c.DomUtility=c.DomUtility||{};s=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};t=c.Trie=c.Trie||{};u=t.LookupResult=t.LookupResult||{};v=a.StartupCode$WebSharper_UI$Trie=a.StartupCode$WebSharper_UI$Trie||{};w=c.Snap=c.Snap||{};x=c.Var=c.Var||{};y=c.View=c.View||{};z=c.ConcreteVar=c.ConcreteVar||{};A=c.Var$1=c.Var$1||{};B=c.Updates=c.Updates||{};C=c.FromView=c.FromView||{};D=c.ViewBuilder=c.ViewBuilder||{};E=c.Submitter=c.Submitter||{};F=c.Key=c.Key||{};G=c.Model=c.Model||{};H=c.Serializer=c.Serializer||{};I=c.Storage=c.Storage||{};J=I.ArrayStorage=I.ArrayStorage||{};K=I.LocalStorageBackend=I.LocalStorageBackend||{};L=c.ListModel=c.ListModel||{};M=c.ListModels=c.ListModels||{};N=a.StartupCode$WebSharper_UI$Models=a.StartupCode$WebSharper_UI$Models||{};O=c.ReactiveExtensions=c.ReactiveExtensions||{};P=c.DoubleInterpolation=c.DoubleInterpolation||{};Q=c.Interpolation=c.Interpolation||{};R=c.Easing=c.Easing||{};S=c.Easings=c.Easings||{};T=c.An=c.An||{};U=c.Anims=c.Anims||{};V=c.Trans=c.Trans||{};W=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};X=b&&b.Web;Y=X&&X.Control;Z=c.OnAfterRenderControl=c.OnAfterRenderControl||{};_0=c.AnimatedAttrNode=c.AnimatedAttrNode||{};_1=c.DynamicAttrNode=c.DynamicAttrNode||{};_2=c.AttrProxy=c.AttrProxy||{};_3=c.Client=c.Client||{};_4=_3.Attrs=_3.Attrs||{};_5=_4.Dyn=_4.Dyn||{};_6=c.Attrs=c.Attrs||{};_7=c.CheckedInput=c.CheckedInput||{};_8=c.BindVar=c.BindVar||{};_9=c.AttrModule=c.AttrModule||{};_=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};$=_3.Settings=_3.Settings||{};ba=c.DocElemNode=c.DocElemNode||{};bb=_3.Docs=_3.Docs||{};bc=bb.DomNodes=bb.DomNodes||{};bd=bb.NodeSet=bb.NodeSet||{};be=bb.RunState=bb.RunState||{};bf=c.Docs=c.Docs||{};bg=c.Doc=c.Doc||{};bh=c.Elt=c.Elt||{};bi=_3.EltUpdater=_3.EltUpdater||{};bj=a.StartupCode$WebSharper_UI$Doc_Proxy=a.StartupCode$WebSharper_UI$Doc_Proxy||{};bk=_3.Templates=_3.Templates||{};bl=bk.Prepare=bk.Prepare||{};bm=a.StartupCode$WebSharper_UI$Templates=a.StartupCode$WebSharper_UI$Templates||{};bn=c.Flow=c.Flow||{};bo=c.FlowBuilder=c.FlowBuilder||{};bp=c.HtmlModule=c.HtmlModule||{};bq=bp.attr=bp.attr||{};br=c.Router=c.Router||{};bs=c.Route=c.Route||{};bt=c.Routing=c.Routing||{};bu=c.RouteMap=c.RouteMap||{};bv=c.Input=c.Input||{};bw=bv.MousePosSt=bv.MousePosSt||{};bx=bv.MouseBtnSt=bv.MouseBtnSt||{};by=bv.Mouse=bv.Mouse||{};bz=bv.KeyListenerSt=bv.KeyListenerSt||{};bA=bv.Keyboard=bv.Keyboard||{};bB=a.StartupCode$WebSharper_UI$Input=a.StartupCode$WebSharper_UI$Input||{};bC=b&&b.List;bD=b&&b.Arrays;bE=b&&b.Enumerator;bF=b&&b.Strings;bG=b&&b.Char;bH=b&&b.Collections;bI=bH&&bH.HashSet;bJ=b&&b.Seq;bK=a.IntelliFactory;bL=bK&&bK.Runtime;bM=b&&b.Unchecked;bN=a.console;bO=b&&b.Concurrency;bP=bH&&bH.Map;bQ=bH&&bH.FSharpMap;bR=b&&b.Operators;bS=b&&b.Queue;bT=b&&b.Lazy;bU=bH&&bH.Dictionary;bV=a.JSON;bW=b&&b.Numeric;bX=a.Node;bY=b&&b.Slice;bZ=b&&b.Sitelets;b0=bZ&&bZ.RouterModule;b1=bZ&&bZ.Route;b2=b&&b.Utils;b3=b&&b.Option;d.mapInPlace=function(b4,b5){var b6,b7;for(b6=0,b7=b5.length-1;b6<=b7;b6++)b5[b6]=b4(b5[b6]);return b5;};d.ofSeqNonCopying=function(b4){var b5,b6;if(b4 instanceof a.Array)return b4;else if(b4 instanceof bC.T)return bD.ofList(b4);else if(b4===null)return[];else{b5=[];b6=bE.Get(b4);try{while(b6.MoveNext())b5.push(b6.Current());return b5;}finally{if(typeof b6=="object"&&"Dispose"in b6)b6.Dispose();}}};d.MapTreeReduce=function(b4,b5,b6,b7){var b8;function b9(b_){return function(b$){var ca,cb;return b$<=0?b5:b$===1&&(b_>=0&&b_<b8)?b4(bD.get(b7,b_)):(cb=b$/2>>0,b6((b9(b_))(cb),(b9(b_+cb))(b$-cb)));};}b8=bD.length(b7);return(b9(0))(b8);};d.TreeReduce=function(b4,b5,b6){var b7;function b8(b9){return function(b_){var b$,ca;return b_<=0?b4:b_===1&&(b9>=0&&b9<b7)?bD.get(b6,b9):(ca=b_/2>>0,b5((b8(b9))(ca),(b8(b9+ca))(b_-ca)));};}b7=bD.length(b6);return(b8(0))(b7);};e.isBlank=function(b4){return bF.forall(bG.IsWhiteSpace,b4);};f.maybeReplaceFirst=function(b4,b5,b6){var b7;b7=[false];return bC.map(function(b8){var b9;return!b7[0]&&b4(b8)?(b9=b5(b8),b9==null?b8:b9.$0):b8;},b6);};f.replaceFirst=function(b4,b5,b6){var b7;b7=[false];return bC.map(function(b8){return!b7[0]&&b4(b8)?b5(b8):b8;},b6);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){o.$cctor();return o.counter;};h.set_counter=function(b4){o.$cctor();o.counter=b4;};i.Filter=function(b4,b5){return new bI.New$2(bD.filter(b4,i.ToArray(b5)));};i.Intersect=function(b4,b5){var b6;b6=new bI.New$2(i.ToArray(b4));b6.IntersectWith(i.ToArray(b5));return b6;};i.Except=function(b4,b5){var b6;b6=new bI.New$2(i.ToArray(b5));b6.ExceptWith(i.ToArray(b4));return b6;};i.ToArray=function(b4){var b5;b5=bD.create(b4.get_Count(),void 0);b4.CopyTo(b5);return b5;};j.ToValueArray=function(b4){var b5;b5=bD.create(b4.count,void 0);bJ.iteri(function(b6,b7){return bD.set(b5,b6,b7.V);},b4);return b5;};j.ToKeyArray=function(b4){var b5;b5=bD.create(b4.count,void 0);bJ.iteri(function(b6,b7){return bD.set(b5,b6,b7.K);},b4);return b5;};l=g.Slot=bL.Class({GetHashCode:function(){return bM.Hash(this.key(this.value));},Equals:function(b4){return bM.Equals(this.key(this.value),this.key(b4.get_Value()));},get_Value:function(){return this.value;}},k,l);l.New=bL.Ctor(function(b4,b5){k.New.call(this);this.key=b4;this.value=b5;},l);l.Create=function(b4,b5){return new l.New(b4,b5);};m.OnError=function(b4){return bN.log("WebSharper UI: Uncaught asynchronous exception",b4);};m.StartTo=function(b4,b5){bO.StartWithContinuations(b4,b5,function(b6){m.OnError(b6);},a.ignore,null);};n.StartProcessor=function(b4){var b5;function b6(){var b7;b7=null;return bO.Delay(function(){return bO.Bind(b4,function(){var b8;b8=b5[0];return b8===1?(b5[0]=0,bO.Zero()):b8===2?(b5[0]=1,b6()):bO.Zero();});});}b5=[0];return function(){var b7;b7=b5[0];b7===0?(b5[0]=1,bO.Start(b6(),null)):b7===1?b5[0]=2:void 0;};};o.$cctor=function(){o.$cctor=a.ignore;o.counter=0;};p.FromArray=function(b4){var b5;b5=b4.length;return b5===0?{$:0}:b5===1?{$:1,$0:bD.get(b4,0)}:{$:3,$0:b4.slice()};};p.ToArray=function(b4){var b5;function b6(b7){var b8,b9;while(true)if(b7.$==1)return b5.push(b7.$0);else if(b7.$==2){b8=b7.$1;b9=b7.$0;b6(b9);b7=b8;}else return b7.$==3?bD.iter(function(b_){b5.push(b_);},b7.$0):null;}b5=[];b6(b4);return b5.slice(0);};p.Single=function(b4){return{$:1,$0:b4};};p.Concat=function(b4){var b5;b5=d.ofSeqNonCopying(b4);return d.TreeReduce(p.Empty(),p.Append,b5);};p.Append=function(b4,b5){return b4.$==0?b5:b5.$==0?b4:{$:2,$0:b4,$1:b5};};p.Empty=function(){q.$cctor();return q.Empty;};q.$cctor=function(){q.$cctor=a.ignore;q.Empty={$:0};};r.ParseHTMLIntoFakeRoot=function(b4){var b5,b6,b7,b8,b9;function b_(b$,ca){var cb;while(true)if(ca===0)return b$;else{cb=ca;b$=b$.lastChild;ca=cb-1;}}b5=self.document.createElement("div");return!r.rhtml().test(b4)?(b5.appendChild(self.document.createTextNode(b4)),b5):(b6=(b7=r.rtagName().exec(b4),bM.Equals(b7,null)?"":bD.get(b7,1).toLowerCase()),(b8=(b9=(r.wrapMap())[b6],b9?b9:r.defaultWrap()),(b5.innerHTML=b8[1]+b4.replace(r.rxhtmlTag(),"<$1></$2>")+b8[2],b_(b5,b8[0]))));};r.defaultWrap=function(){s.$cctor();return s.defaultWrap;};r.wrapMap=function(){s.$cctor();return s.wrapMap;};r.rhtml=function(){s.$cctor();return s.rhtml;};r.rtagName=function(){s.$cctor();return s.rtagName;};r.rxhtmlTag=function(){s.$cctor();return s.rxhtmlTag;};r.IterSelector=function(b4,b5,b6){var b7,b8,b9;b7=b4.querySelectorAll(b5);for(b8=0,b9=b7.length-1;b8<=b9;b8++)b6(b7[b8]);};r.ChildrenArray=function(b4){var b5,b6,b7;b5=[];for(b6=0,b7=b4.childNodes.length-1;b6<=b7;b6++)b5.push(b4.childNodes[b6]);return b5;};r.RemoveClass=function(b4,b5){var b6;r.setClass(b4,(b6=r.clsRE(b5),r.getClass(b4).replace(b6,function(b7,b8,b9){return b8===""||b9===""?"":" ";})));};r.AddClass=function(b4,b5){var b6;b6=r.getClass(b4);b6===""?r.setClass(b4,b5):!r.clsRE(b5).test(b6)?r.setClass(b4,b6+" "+b5):void 0;};r.setClass=function(b4,b5){if(b4 instanceof a.SVGElement)b4.setAttribute("class",b5);else b4.className=b5;};r.getClass=function(b4){return b4 instanceof a.SVGElement?b4.getAttribute("class"):b4.className;};r.clsRE=function(b4){return new a.RegExp("(\\s+|^)"+b4+"(?:\\s+"+b4+")*(\\s+|$)","g");};r.InsertAt=function(b4,b5,b6){var b7;if(!(b6.parentNode===b4&&b5===(b7=b6.nextSibling,bM.Equals(b7,null)?null:b7)))b4.insertBefore(b6,b5);};r.RemoveNode=function(b4,b5){if(b5.parentNode===b4)b4.removeChild(b5);};s.$cctor=function(){var b4;s.$cctor=a.ignore;s.rxhtmlTag=new a.RegExp("<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>","gi");s.rtagName=new a.RegExp("<([\\w:]+)");s.rhtml=new a.RegExp("<|&#?\\w+;");s.wrapMap=(b4=[1,"<table>","</table>"],{option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:b4,tbody:b4,tfoot:b4,tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><colgroup>","</colgoup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"]});s.defaultWrap=[0,"",""];};u.NotFound={$:1};t.Empty=function(){v.$cctor();return v.Empty;};t.Lookup=function(b4,b5){return t.Look(bC.ofSeq(b5),b4);};t.Look=function(b4,b5){var b6,b7;switch(b5.$==2?(b6=b5.$0,0):b5.$==0?b4.$==1?(b6=[b4.$0,b4.$1,b5.$0],1):2:2){case 0:return{$:0,$0:b6,$1:b4};case 1:b7=bP.TryFind(b6[0],b6[2]);return b7==null?u.NotFound:t.Look(b6[1],b7.$0);case 2:return u.NotFound;}};t.ToArray=function(b4){var b5;b5=[];t.Map(function(){return function(b6){return b5.push(b6);};},b4);return b5.slice(0);};t.Mapi=function(b4,b5){var b6;function b7(){var b8;b8=b6[0];b6[0]=b8+1;return b8;}b6=[0];return t.Map(function(b8){return b4(b7(),b8);},b5);};t.Map=function(b4,b5){return t.MapLoop(bC.T.Empty,b4,b5);};t.MapLoop=function(b4,b5,b6){return b6.$==1?{$:1}:b6.$==2?{$:2,$0:(b5(b4))(b6.$0)}:t.TrieBranch(bP.Map(function(b7,b8){return t.MapLoop(bC.append(b4,bC.ofArray([b7])),b5,b8);},b6.$0));};t.Merge=function(b4){var b5,b6,b7;b5=d.ofSeqNonCopying(b4);b6=bD.length(b5);return b6===0?{$:1,$0:{$:1}}:b6===1?{$:1,$0:bD.get(b5,0)}:bD.exists(t.IsLeaf,b5)?null:(b7=t.MergeMaps(t.Merge,bJ.choose(function(b8){return b8.$==0?{$:1,$0:b8.$0}:null;},b5)),b7==null?null:{$:1,$0:t.TrieBranch(b7.$0)});};t.IsLeaf=function(b4){return b4.$==2;};t.MergeMaps=function(b4,b5){var b6,b7;function b8(b9,b_){var b$;b$=b4(b_);return b$==null?null:{$:1,$0:[b9,b$.$0]};}b6=t.AllSome(bJ.map(function(b9){return b8(b9[0],b9[1]);},bP.ToSeq((b7=bJ.collect(bP.ToSeq,b5),bJ.fold(function(b9,b_){return t.MultiAdd(b_[0],b_[1],b9);},new bQ.New([]),b7)))));return b6==null?null:{$:1,$0:bP.OfArray(bD.ofSeq(b6.$0))};};t.AllSome=function(b4){var b5,b6,b7,b8;b6=bE.Get(b4);b7=[];b5=true;while(b5&&b6.MoveNext()){b8=b6.Current();b8!=null&&b8.$==1?b7.push(b8.$0):b5=false;}return b5?{$:1,$0:b7.slice()}:null;};t.MultiAdd=function(b4,b5,b6){return b6.Add(b4,new bC.T({$:1,$0:b5,$1:t.MultiFind(b4,b6)}));};t.MultiFind=function(b4,b5){var b6;b6=bP.TryFind(b4,b5);return b6==null?bC.T.Empty:b6.$0;};t.Prefix=function(b4,b5){return t.TrieBranch(new bQ.New(bC.ofArray([[b4,b5]])));};t.Leaf=function(b4){return{$:2,$0:b4};};t.TrieBranch=function(b4){return b4.get_IsEmpty()?{$:1}:{$:0,$0:b4};};v.$cctor=function(){v.$cctor=a.ignore;v.Empty={$:1};};w.Obsolete=function(b4){var b5,b6,b7,b8,b9;b6=b4.s;if(b6==null||(b6!=null&&b6.$==2?(b5=b6.$1,false):b6!=null&&b6.$==3?(b5=b6.$1,false):true))void 0;else{b4.s=null;for(b7=0,b8=bD.length(b5)-1;b7<=b8;b7++){b9=bD.get(b5,b7);typeof b9=="object"?function(b_){w.Obsolete(b_);}(b9):b9();}}};w.New=function(b4){return{s:b4};};w.MapAsync=function(b4,b5){var b6;b6=w.New({$:3,$0:[],$1:[]});w.When(b5,function(b7){m.StartTo(b4(b7),function(b8){w.MarkDone(b6,b5,b8);});},b6);return b6;};w.SnapshotOn=function(b4,b5){var b6;function b7(b8){var b9,b_,b$;if(!(b9=b6.s,b9!=null&&b9.$==0||b9!=null&&b9.$==2)){b_=w.ValueAndForever(b4);b$=w.ValueAndForever(b5);b_!=null&&b_.$==1?b$!=null&&b$.$==1?b_.$0[1]||b$.$0[1]?w.MarkForever(b6,b$.$0[0]):w.MarkReady(b6,b$.$0[0]):void 0:void 0;}}b6=w.New({$:3,$0:[],$1:[]});w.When(b4,b7,b6);w.WhenReady(b5,b7);return b6;};w.Map3=function(b4,b5,b6,b7){var b8,b9,b_,b$;function ca(cb){var cc,cd,ce,cf;if(!(cc=b$.s,cc!=null&&cc.$==0||cc!=null&&cc.$==2)){cd=w.ValueAndForever(b5);ce=w.ValueAndForever(b6);cf=w.ValueAndForever(b7);cd!=null&&cd.$==1?ce!=null&&ce.$==1?cf!=null&&cf.$==1?cd.$0[1]&&ce.$0[1]&&cf.$0[1]?w.MarkForever(b$,b4(cd.$0[0],ce.$0[0],cf.$0[0])):w.MarkReady(b$,b4(cd.$0[0],ce.$0[0],cf.$0[0])):void 0:void 0:void 0;}}b8=b5.s;b9=b6.s;b_=b7.s;return b8!=null&&b8.$==0?b9!=null&&b9.$==0?b_!=null&&b_.$==0?w.New({$:0,$0:b4(b8.$0,b9.$0,b_.$0)}):w.Map3Opt1(b4,b8.$0,b9.$0,b7):b_!=null&&b_.$==0?w.Map3Opt2(b4,b8.$0,b_.$0,b6):w.Map3Opt3(b4,b8.$0,b6,b7):b9!=null&&b9.$==0?b_!=null&&b_.$==0?w.Map3Opt4(b4,b9.$0,b_.$0,b5):w.Map3Opt5(b4,b9.$0,b5,b7):b_!=null&&b_.$==0?w.Map3Opt6(b4,b_.$0,b5,b6):(b$=w.New({$:3,$0:[],$1:[]}),(w.When(b5,ca,b$),w.When(b6,ca,b$),w.When(b7,ca,b$),b$));};w.Map3Opt6=function(b4,b5,b6,b7){return w.Map2(function(b8,b9){return b4(b8,b9,b5);},b6,b7);};w.Map3Opt5=function(b4,b5,b6,b7){return w.Map2(function(b8,b9){return b4(b8,b5,b9);},b6,b7);};w.Map3Opt4=function(b4,b5,b6,b7){return w.Map(function(b8){return b4(b8,b5,b6);},b7);};w.Map3Opt3=function(b4,b5,b6,b7){return w.Map2(function(b8,b9){return b4(b5,b8,b9);},b6,b7);};w.Map3Opt2=function(b4,b5,b6,b7){return w.Map(function(b8){return b4(b5,b8,b6);},b7);};w.Map3Opt1=function(b4,b5,b6,b7){return w.Map(function(b8){return b4(b5,b6,b8);},b7);};w.Map2Unit=function(b4,b5){var b6,b7,b8;function b9(){var b_,b$,ca;if(!(b_=b8.s,b_!=null&&b_.$==0||b_!=null&&b_.$==2)){b$=w.ValueAndForever(b4);ca=w.ValueAndForever(b5);b$!=null&&b$.$==1?ca!=null&&ca.$==1?b$.$0[1]&&ca.$0[1]?w.MarkForever(b8,null):w.MarkReady(b8,null):void 0:void 0;}}b6=b4.s;b7=b5.s;return b6!=null&&b6.$==0?b7!=null&&b7.$==0?w.New({$:0,$0:null}):b5:b7!=null&&b7.$==0?b4:(b8=w.New({$:3,$0:[],$1:[]}),(w.When(b4,b9,b8),w.When(b5,b9,b8),b8));};w.Map2=function(b4,b5,b6){var b7,b8,b9;function b_(b$){var ca,cb,cc;if(!(ca=b9.s,ca!=null&&ca.$==0||ca!=null&&ca.$==2)){cb=w.ValueAndForever(b5);cc=w.ValueAndForever(b6);cb!=null&&cb.$==1?cc!=null&&cc.$==1?cb.$0[1]&&cc.$0[1]?w.MarkForever(b9,b4(cb.$0[0],cc.$0[0])):w.MarkReady(b9,b4(cb.$0[0],cc.$0[0])):void 0:void 0;}}b7=b5.s;b8=b6.s;return b7!=null&&b7.$==0?b8!=null&&b8.$==0?w.New({$:0,$0:b4(b7.$0,b8.$0)}):w.Map2Opt1(b4,b7.$0,b6):b8!=null&&b8.$==0?w.Map2Opt2(b4,b8.$0,b5):(b9=w.New({$:3,$0:[],$1:[]}),(w.When(b5,b_,b9),w.When(b6,b_,b9),b9));};w.Map2Opt2=function(b4,b5,b6){return w.Map(function(b7){return b4(b7,b5);},b6);};w.Map2Opt1=function(b4,b5,b6){return w.Map(function(b7){return b4(b5,b7);},b6);};w.MapCachedBy=function(b4,b5,b6,b7){return w.Map(function(b8){var b9,b_,b$;b9=b5[0];return b9!=null&&b9.$==1&&(b4(b8,b9.$0[0])&&(b_=[b9.$0[0],b9.$0[1]],true))?b_[1]:(b$=b6(b8),(b5[0]={$:1,$0:[b8,b$]},b$));},b7);};w.Copy=function(b4){var b5,b6,b7;b5=b4.s;return b5==null?b4:b5!=null&&b5.$==2?(b6=w.New({$:2,$0:b5.$0,$1:[]}),(w.WhenObsolete(b4,b6),b6)):b5!=null&&b5.$==3?(b7=w.New({$:3,$0:[],$1:[]}),(w.When(b4,function(b8){w.MarkDone(b7,b4,b8);},b7),b7)):b4;};w.WithInitOption=function(b4){var b5,b6,b7;b5=b4.s;return b5==null?w.New(null):b5!=null&&b5.$==2?(b6=w.New({$:2,$0:{$:1,$0:b5.$0},$1:[]}),(w.WhenObsolete(b4,b6),b6)):b5!=null&&b5.$==3?(b7=w.New({$:2,$0:null,$1:[]}),(w.When(b4,function(){w.Obsolete(b7);},b7),b7)):w.New({$:0,$0:{$:1,$0:b5.$0}});};w.WithInit=function(b4,b5){var b6,b7,b8;b6=b5.s;return b6==null?b5:b6!=null&&b6.$==2?(b7=w.New({$:2,$0:b6.$0,$1:[]}),(w.WhenObsolete(b5,b7),b7)):b6!=null&&b6.$==3?(b8=w.New({$:2,$0:b4,$1:[]}),(w.When(b5,function(){w.Obsolete(b8);},b8),b8)):b5;};w.Map=function(b4,b5){var b6,b7;b6=b5.s;return b6!=null&&b6.$==0?w.New({$:0,$0:b4(b6.$0)}):(b7=w.New({$:3,$0:[],$1:[]}),(w.When(b5,function(b8){w.MarkDone(b7,b5,b4(b8));},b7),b7));};w.Sequence=function(b4){var b5,b6,b7;function b8(b9){var b_;if(b7[0]===0){b_=bD.map(function(b$){var ca;ca=b$.s;return ca!=null&&ca.$==0?ca.$0:ca!=null&&ca.$==2?ca.$0:bR.FailWith("value not found by View.Sequence");},b5);bD.forall(function(b$){var ca;ca=b$.s;return ca!=null&&ca.$==0;},b5)?w.MarkForever(b6,b_):w.MarkReady(b6,b_);}else b7[0]--;}b5=bD.ofSeq(b4);return b5.length==0?w.New({$:0,$0:[]}):(b6=w.New({$:3,$0:[],$1:[]}),(b7=[bD.length(b5)-1],(bD.iter(function(b9){w.When(b9,b8,b6);},b5),b6)));};w.CreateForeverAsync=function(b4){var b5;b5=w.New({$:3,$0:[],$1:[]});m.StartTo(b4,function(b6){w.MarkForever(b5,b6);});return b5;};w.JoinInner=function(b4){var b5;b5=w.New({$:3,$0:[],$1:[]});w.When(b4,function(b6){var b7;b7=b6();w.When(b7,function(b8){var b9,b_;if((b9=b7.s,b9!=null&&b9.$==0)&&(b_=b4.s,b_!=null&&b_.$==0))w.MarkForever(b5,b8);else w.MarkReady(b5,b8);},b5);w.WhenObsolete(b4,b7);},b5);return b5;};w.Join=function(b4){var b5;b5=w.New({$:3,$0:[],$1:[]});w.When(b4,function(b6){var b7;b7=b6();w.When(b7,function(b8){var b9,b_;if((b9=b7.s,b9!=null&&b9.$==0)&&(b_=b4.s,b_!=null&&b_.$==0))w.MarkForever(b5,b8);else w.MarkReady(b5,b8);},b5);},b5);return b5;};w.ValueAndForever=function(b4){var b5;b5=b4.s;return b5!=null&&b5.$==0?{$:1,$0:[b5.$0,true]}:b5!=null&&b5.$==2?{$:1,$0:[b5.$0,false]}:null;};w.WhenObsoleteRun=function(b4,b5){var b6;b6=b4.s;b6==null?b5():b6!=null&&b6.$==2?b6.$1.push(b5):b6!=null&&b6.$==3?b6.$1.push(b5):void 0;};w.WhenObsolete=function(b4,b5){var b6;b6=b4.s;b6==null?w.Obsolete(b5):b6!=null&&b6.$==2?w.EnqueueSafe(b6.$1,b5):b6!=null&&b6.$==3?w.EnqueueSafe(b6.$1,b5):void 0;};w.WhenReady=function(b4,b5){var b6,b7;b7=b4.s;switch(b7!=null&&b7.$==2?(b6=b7.$0,0):b7==null?1:b7!=null&&b7.$==3?2:(b6=b7.$0,0)){case 0:b5(b6);break;case 1:null;break;case 2:b7.$0.push(b5);break;}};w.WhenRun=function(b4,b5,b6){var b7;b7=b4.s;b7==null?b6():b7!=null&&b7.$==2?(b7.$1.push(b6),b5(b7.$0)):b7!=null&&b7.$==3?(b7.$0.push(b5),b7.$1.push(b6)):b5(b7.$0);};w.When=function(b4,b5,b6){var b7;b7=b4.s;b7==null?w.Obsolete(b6):b7!=null&&b7.$==2?(w.EnqueueSafe(b7.$1,b6),b5(b7.$0)):b7!=null&&b7.$==3?(b7.$0.push(b5),w.EnqueueSafe(b7.$1,b6)):b5(b7.$0);};w.EnqueueSafe=function(b4,b5){var b6,b7,b8,b9;b4.push(b5);if(b4.length%20===0){b6=b4.slice(0);bS.Clear(b4);for(b7=0,b8=bD.length(b6)-1;b7<=b8;b7++){b9=bD.get(b6,b7);typeof b9=="object"?function(b_){if(b_.s)b4.push(b_);}(b9):function(b_){b4.push(b_);}(b9);}}else void 0;};w.MarkDone=function(b4,b5,b6){var b7;if(b7=b5.s,b7!=null&&b7.$==0)w.MarkForever(b4,b6);else w.MarkReady(b4,b6);};w.MarkReady=function(b4,b5){var b6,b7,b8,b9;b6=b4.s;if(b6!=null&&b6.$==3){b4.s={$:2,$0:b5,$1:b6.$1};b7=b6.$0;for(b8=0,b9=bD.length(b7)-1;b8<=b9;b8++)(bD.get(b7,b8))(b5);}else void 0;};w.MarkForever=function(b4,b5){var b6,b7,b8,b9;b6=b4.s;if(b6!=null&&b6.$==3){b4.s={$:0,$0:b5};b7=b6.$0;for(b8=0,b9=bD.length(b7)-1;b8<=b9;b8++)(bD.get(b7,b8))(b5);}else void 0;};w.TryGet=function(b4){var b5,b6;b5=b4.s;return(b5!=null&&b5.$==0?(b6=b5.$0,true):b5!=null&&b5.$==2&&(b6=b5.$0,true))?{$:1,$0:b6}:null;};x=c.Var=bL.Class({},k,x);x.New=bL.Ctor(function(){k.New.call(this);},x);y=c.View=bL.Class({get_V:function(){return bR.FailWith("View<'T>.V can only be called in an argument to a V-enabled function or if 'T = Doc.");}},null,y);z=c.ConcreteVar=bL.Class({get_Id:function(){return"uinref"+a.String(this.id);},get_View:function(){return this.view;},UpdateMaybe:function(b4){var b5;b5=b4(this.Get());b5!=null&&b5.$==1?this.Set(b5.$0):void 0;},Update:function(b4){this.Set(b4(this.Get()));},SetFinal:function(b4){if(this.isConst)(function(b5){return b5("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(b5){bN.log(b5);}));else{w.Obsolete(this.snap);this.isConst=true;this.current=b4;this.snap=w.New({$:0,$0:b4});}},Set:function(b4){if(this.isConst)(function(b5){return b5("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(b5){bN.log(b5);}));else{w.Obsolete(this.snap);this.current=b4;this.snap=w.New({$:2,$0:b4,$1:[]});}},Get:function(){return this.current;}},x,z);z.New=bL.Ctor(function(b4,b5,b6){var b7;b7=this;x.New.call(this);this.isConst=b4;this.current=b6;this.snap=b5;this.view=function(){return b7.snap;};this.id=h.Int();},z);A=c.Var$1=bL.Class({},k,A);A.MapLens=function(b4,b5,b6){return y.MapSeqCachedViewBy(b4,function(b7,b8){var b9,b_;function b$(ca){return bM.Equals(b4(ca),b7);}b9=h.Id();return b5((b_=new x({Get:function(){return bJ.find(b$,b6.Get());},Set:function(ca){function cb(cc){return ca;}return b6.Update(function(cc){return f.replaceFirst(b$,cb,cc);});},SetFinal:function(ca){return this.Set(ca);},Update:function(ca){return b6.Update(function(cb){return f.replaceFirst(b$,ca,cb);});},UpdateMaybe:function(ca){return b6.Update(function(cb){return f.maybeReplaceFirst(b$,ca,cb);});},get_View:function(){return b8;},get_Id:function(){return b9;}}),(x.New.call(b_),b_)));},b6.get_View());};A.Lens=function(b4,b5,b6){var b7,b8,b9;b7=h.Id();b8=y.Map(b5,b4.get_View());b9=new x({Get:function(){return b5(b4.Get());},Set:function(b_){return b4.Update(function(b$){return b6(b$,b_);});},SetFinal:function(b_){return this.Set(b_);},Update:function(b_){return b4.Update(function(b$){return b6(b$,b_(b5(b$)));});},UpdateMaybe:function(b_){return b4.UpdateMaybe(function(b$){var ca;ca=b_(b5(b$));return ca==null?null:{$:1,$0:b6(b$,ca.$0)};});},get_View:function(){return b8;},get_Id:function(){return b7;}});x.New.call(b9);return b9;};A.Update=function(b4,b5){A.Set(b4,b5(b4.Get()));};A.SetFinal=function(b4,b5){b4.SetFinal(b5);};A.Set=function(b4,b5){b4.Set(b5);};A.CreateWaiting=function(){return new z.New(false,w.New({$:3,$0:[],$1:[]}),null);};A.Create=function(){return new z.New(false,w.New({$:2,$0:null,$1:[]}),null);};A.CreateLogged=function(b4,b5){var b6;!self.UINVars?self.UINVars=[]:void 0;b6=A.Create$1(b5);self.UINVars.push([b4,b6]);return b6;};A.Create$1=function(b4){return new z.New(false,w.New({$:2,$0:b4,$1:[]}),b4);};A.New=bL.Ctor(function(){k.New.call(this);},A);B=c.Updates=bL.Class({set_Value:function(b4){var b5;b5=this.s;!(b5===null)?w.Obsolete(b5):void 0;this.c=b4;}},null,B);B.Create=function(b4){var b5;b5=null;b5=B.New(b4,null,function(){var b6;b6=b5.s;return b6===null?(b6=w.Copy(b5.c()),b5.s=b6,w.WhenObsoleteRun(b6,function(){b5.s=null;}),b6):b6;});return b5;};B.New=function(b4,b5,b6){return new B({c:b4,s:b5,v:b6});};y.get_Do=function(){return D.B;};y.Apply=function(b4,b5){return y.Map2(function(b6,b7){return b6(b7);},b4,b5);};y.AsyncAwait=function(b4,b5){function b6(b7){var b8,b9;function b_(){return y.RemovableSink(function(b$){if(b4(b$)){(bT.Force(b8))();b7(b$);}},b5);}b8=bT.Create(b_);b9=bT.Force(b8);}return bO.FromContinuations(function(b7,b8,b9){return b6.apply(null,[b7,b8,b9]);});};y.RemovableSink=function(b4,b5){var b6;function b7(){w.WhenRun(b5(),function(b8){if(b6[0])b4(b8);},function(){if(b6[0])bO.scheduler().Fork(b7);});}b6=[true];bO.scheduler().Fork(b7);return function(){b6[0]=false;};};y.Sink=function(b4,b5){function b6(){w.WhenRun(b5(),b4,function(){bO.scheduler().Fork(b6);});}bO.scheduler().Fork(b6);};y.TryFinally=function(b4,b5){return y.CreateLazy(function(){try{return b5();}finally{b4();}});};y.TryWith=function(b4,b5){return y.CreateLazy(function(){try{return b5();}catch(b6){return(b4(b6))();}});};y.ConstAsync=function(b4){var b5;b5=w.CreateForeverAsync(b4);return function(){return b5;};};y.Const=function(b4){var b5;b5=w.New({$:0,$0:b4});return function(){return b5;};};y.Sequence=function(b4){return y.CreateLazy(function(){return w.Sequence(bJ.map(function(b5){return b5();},b4));});};y.UpdateWhile=function(b4,b5,b6){var b7;b7=[b4];return y.BindInner(function(b8){return b8?y.Map(function(b9){b7[0]=b9;return b9;},b6):y.Const(b7[0]);},b5);};y.BindInner=function(b4,b5){return y.JoinInner(y.Map(b4,b5));};y.JoinInner=function(b4){return y.CreateLazy(function(){return w.JoinInner(b4());});};y.Bind=function(b4,b5){return y.Join(y.Map(b4,b5));};y.Join=function(b4){return y.CreateLazy(function(){return w.Join(b4());});};y.MapSeqCachedView=function(b4,b5){function b6(b7){return b4;}return y.MapSeqCachedViewBy(a.id,function(b7,b8){return(b6(b7))(b8);},b5);};y.MapSeqCachedViewBy=function(b4,b5,b6){var b7;b7=[new bU.New$5()];return y.Map(function(b8){var b9,b_,b$;b9=b7[0];b_=new bU.New$5();b$=d.mapInPlace(function(ca){var cb,cc,cd;cb=b4(ca);cc=b9.ContainsKey(cb)?(cd=b9.get_Item(cb),(A.Set(cd.r,ca),cd)):y.ConvertSeqNode(function(ce){return b5(cb,ce);},ca);b_.set_Item(cb,cc);return cc.e;},bD.ofSeq(b8));b7[0]=b_;return b$;},b6);};y.ConvertSeqNode=function(b4,b5){var b6,b7;b6=A.Create$1(b5);b7=b6.get_View();return{e:b4(b7),r:b6,w:b7};};y.MapSeqCached=function(b4,b5){return y.MapSeqCachedBy(a.id,b4,b5);};y.MapSeqCachedBy=function(b4,b5,b6){var b7;b7=[new bU.New$5()];return y.Map(function(b8){var b9,b_,b$;b9=b7[0];b_=new bU.New$5();b$=d.mapInPlace(function(ca){var cb,cc;cb=b4(ca);cc=b9.ContainsKey(cb)?b9.get_Item(cb):b5(ca);b_.set_Item(cb,cc);return cc;},bD.ofSeq(b8));b7[0]=b_;return b$;},b6);};y.SnapshotOn=function(b4,b5,b6){var b7;b7=w.New({$:2,$0:b4,$1:[]});return y.CreateLazy(function(){return b7.s==null?w.SnapshotOn(b5(),b6()):(w.WhenObsolete(b5(),b7),b7);});};y.GetAsync=function(b4){return bO.FromContinuations(function(b5){return y.Get(b5,b4);});};y.WithInitOption=function(b4){return y.CreateLazy(function(){return w.WithInitOption(b4());});};y.WithInit=function(b4,b5){return y.CreateLazy(function(){return w.WithInit(b4,b5());});};y.Get=function(b4,b5){var b6;function b7(){w.WhenRun(b5(),function(b8){if(!b6[0]){b6[0]=true;b4(b8);}},function(){if(!b6[0])b7();});}b6=[false];b7();};y.TryGet=function(b4){return w.TryGet(b4());};y.MapAsync2=function(b4,b5,b6){return y.MapAsync(a.id,y.Map2(b4,b5,b6));};y.MapAsync=function(b4,b5){return y.CreateLazy(function(){return w.MapAsync(b4,b5());});};y.Map3=function(b4,b5,b6,b7){return y.CreateLazy(function(){return w.Map3(b4,b5(),b6(),b7());});};y.Map2Unit=function(b4,b5){return y.CreateLazy(function(){return w.Map2Unit(b4(),b5());});};y.Map2=function(b4,b5,b6){return y.CreateLazy(function(){return w.Map2(b4,b5(),b6());});};y.MapCached=function(b4,b5){return y.MapCachedBy(bM.Equals,b4,b5);};y.MapCachedBy=function(b4,b5,b6){var b7;b7=[null];return y.CreateLazy(function(){return w.MapCachedBy(b4,b7,b5,b6());});};y.Map=function(b4,b5){return y.CreateLazy(function(){return w.Map(b4,b5());});};y.CreateLazy=function(b4){var b5;b5={c:null,o:b4};return function(){var b6,b7;b6=b5.c;return b6===null?(b6=b5.o(),b5.c=b6,(b7=b6.s,b7!=null&&b7.$==0)?b5.o=null:w.WhenObsoleteRun(b6,function(){b5.c=null;}),b6):b6;};};C=c.FromView=bL.Class({get_Id:function(){return"uinref"+a.String(this.id);},SetFinal:function(b4){this.set(b4);},Update:function(b4){var b5;y.Get((b5=this.set,function(b6){return b5(b4(b6));}),this.view);},UpdateMaybe:function(b4){var b5;b5=this;y.Get(function(b6){var b7;b7=b4(b6);b7!=null&&b7.$==1?b5.set(b7.$0):void 0;},this.view);},Set:function(b4){this.set(b4);},Get:function(){return this.current;},get_View:function(){return this.view;}},x,C);C.New=bL.Ctor(function(b4,b5){var b6,b7;b6=this;x.New.call(this);this.set=b5;this.id=h.Int();this.current=(b7=y.TryGet(b4),b7==null?null:b7.$0);this.view=y.Map(function(b8){b6.current=b8;return b8;},b4);},C);D.B={$:0};E=c.Submitter=bL.Class({Trigger:function(){this["var"].Set(null);}},k,E);E.New=bL.Ctor(function(b4,b5){k.New.call(this);this.input=b4;this["var"]=A.Create();this.view=y.SnapshotOn(b5,this["var"].get_View(),this.input);},E);E.CreateOption=function(b4){return new E.New(y.Map(function(b5){return{$:1,$0:b5};},b4),null);};F.Fresh=function(){return{$:0,$0:h.Int()};};G=c.Model=bL.Class({},k,G);G.New=bL.Ctor(function(b4,b5){var b6;b6=A.Create$1(b5);G.New$1.call(this,b6,y.Map(b4,b6.get_View()));},G);G.New$1=bL.Ctor(function(b4,b5){k.New.call(this);this["var"]=b4;this.view=b5;},G);G.Update=function(b4,b5){A.Update(b5["var"],function(b6){b4(b6);return b6;});};G.Create=function(b4,b5){return new G.New(b4,b5);};H.Default=function(){N.$cctor();return N.Default;};J=I.ArrayStorage=bL.Class({SSet:function(b4){return bD.ofSeq(b4);},SSetAt:function(b4,b5,b6){bD.set(b6,b4,b5);return b6;},SRemoveIf:function(b4,b5){return bD.filter(function(b6){return!b4(b6);},b5);},SInit:function(){return this.init;},SPrependMany:function(b4,b5){var b6;b6=d.ofSeqNonCopying(b4);b5.unshift.apply(b5,b6);return b5;},SPrepend:function(b4,b5){b5.unshift(b4);return b5;},SAppendMany:function(b4,b5){var b6;b6=d.ofSeqNonCopying(b4);b5.push.apply(b5,b6);return b5;},SAppend:function(b4,b5){b5.push(b4);return b5;}},k,J);J.New=bL.Ctor(function(b4){k.New.call(this);this.init=b4;},J);K=I.LocalStorageBackend=bL.Class({clear:function(){this.storage.removeItem(this.id);},set:function(b4){this.storage.setItem(this.id,bV.stringify(bD.map(this.serializer.Encode,b4)));return b4;},SSet:function(b4){return this.set(bD.ofSeq(b4));},SSetAt:function(b4,b5,b6){bD.set(b6,b4,b5);return this.set(b6);},SRemoveIf:function(b4,b5){return this.set(bD.filter(function(b6){return!b4(b6);},b5));},SInit:function(){var b4;b4=this.storage.getItem(this.id);if(b4===null)return[];else try{return bD.map(this.serializer.Decode,bV.parse(b4));}catch(b5){return[];}},SPrependMany:function(b4,b5){var b6;b6=d.ofSeqNonCopying(b4);b5.unshift.apply(b5,b6);return this.set(b5);},SPrepend:function(b4,b5){b5.unshift(b4);return this.set(b5);},SAppendMany:function(b4,b5){var b6;b6=d.ofSeqNonCopying(b4);b5.push.apply(b5,b6);return this.set(b5);},SAppend:function(b4,b5){b5.push(b4);return this.set(b5);}},k,K);K.New=bL.Ctor(function(b4,b5){k.New.call(this);this.id=b4;this.serializer=b5;this.storage=self.localStorage;},K);I.LocalStorage=function(b4,b5){return new K.New(b4,b5);};I.InMemory=function(b4){return new J.New(b4);};L=c.ListModel=bL.Class({Wrap:function(b4,b5,b6){return L.Wrap(this,b4,b5,b6);},MapLens:function(b4){var b5;b5=this;return y.MapSeqCachedViewBy(b5.key,function(b6,b7){return b4(b6,b5["LensInto'"](a.id,function(b8,b9){return b9;},b6,b7));},this["var"].get_View());},Lens:function(b4){return this.LensInto(a.id,function(b5,b6){return b6;},b4);},LensInto:function(b4,b5,b6){return this["LensInto'"](b4,b5,b6,y.Map(b4,this.FindByKeyAsView(b6)));},"LensInto'":function(b4,b5,b6,b7){var b8,b9,b_;b8=this;b9=h.Id();b_=new x({Get:function(){return b4(b8.FindByKey(b6));},Set:function(b$){return b8.UpdateBy(function(ca){return{$:1,$0:b5(ca,b$)};},b6);},SetFinal:function(b$){return this.Set(b$);},Update:function(b$){return b8.UpdateBy(function(ca){return{$:1,$0:b5(ca,b$(b4(ca)))};},b6);},UpdateMaybe:function(b$){return b8.UpdateBy(function(ca){var cb;cb=b$(b4(ca));return cb==null?null:{$:1,$0:b5(ca,cb.$0)};},b6);},get_View:function(){return b7;},get_Id:function(){return b9;}});x.New.call(b_);return b_;},get_LengthAsView:function(){return y.Map(bD.length,this["var"].get_View());},get_Length:function(){return bD.length(this["var"].Get());},Clear:function(){this["var"].Set(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(b4,b5){var b6,b7,b8,b9,b_;b6=this;b7=this["var"].Get();b8=bD.tryFindIndex(function(b$){return bM.Equals(b6.key(b$),b5);},b7);b8!=null&&b8.$==1?(b9=b8.$0,b_=b4(bD.get(b7,b9)),b_!=null&&b_.$==1?(this["var"].Set(this.storage.SSetAt(b9,b_.$0,b7)),this.ObsoleteKey(b5)):void 0):void 0;},UpdateAll:function(b4){var b5;b5=this;this["var"].Update(function(b6){bD.iteri(function(b7,b8){var b9;b9=b4(b8);return b9==null?null:bD.set(b6,b7,b9.$0);},b6);return b5.storage.SSet(b6);});this.ObsoleteAll();},FindByKeyAsView:function(b4){return y.Map(function(b5){return b5.$0;},this.TryFindByKeyAsView(b4));},TryFindByKeyAsView:function(b4){var b5;b5=this;return function(){var b6,b7,b8;b6=(b7=null,[b5.it.TryGetValue(b4,{get:function(){return b7;},set:function(b9){b7=b9;}}),b7]);return b6[0]?b6[1]:(b8=w.New({$:2,$0:b5.TryFindByKey(b4),$1:[]}),(b5.it.Add(b4,b8),b8));};},TryFindByKey:function(b4){var b5;b5=this;return bD.tryFind(function(b6){return bM.Equals(b5.key(b6),b4);},this["var"].Get());},FindByKey:function(b4){var b5;b5=this;return bD.find(function(b6){return bM.Equals(b5.key(b6),b4);},this["var"].Get());},TryFindAsView:function(b4){return y.Map(function(b5){return bD.tryFind(b4,b5);},this["var"].get_View());},FindAsView:function(b4){return y.Map(function(b5){return bD.find(b4,b5);},this["var"].get_View());},TryFind:function(b4){return bD.tryFind(b4,this["var"].Get());},Find:function(b4){return bD.find(b4,this["var"].Get());},ContainsKeyAsView:function(b4){var b5;function b6(b7){return bM.Equals(b5.key(b7),b4);}b5=this;return y.Map(function(b7){return bD.exists(b6,b7);},this["var"].get_View());},ContainsKey:function(b4){var b5;b5=this;return bD.exists(function(b6){return bM.Equals(b5.key(b6),b4);},this["var"].Get());},Set:function(b4){this["var"].Set(this.storage.SSet(b4));this.ObsoleteAll();},Iter:function(b4){bD.iter(b4,this["var"].Get());},RemoveByKey:function(b4){var b5;b5=this;this["var"].Set(this.storage.SRemoveIf(function(b6){return bM.Equals(b5.key(b6),b4);},this["var"].Get()));this.ObsoleteKey(b4);},RemoveBy:function(b4){var b5,b6,b7,b8;b5=this["var"].Get();for(b6=0,b7=b5.length-1;b6<=b7;b6++){b8=bD.get(b5,b6);b4(b8)?this.ObsoleteKey(this.key(b8)):void 0;}this["var"].Set(this.storage.SRemoveIf(b4,this["var"].Get()));},Remove:function(b4){var b5,b6,b7,b8;b5=this;b6=this["var"].Get();M.Contains(b5.key,b4,b6)?(b7=b5.key,b8=b7(b4),this["var"].Set(this.storage.SRemoveIf(function(b9){return bM.Equals(b7(b9),b8);},b6)),this.ObsoleteKey(b8)):void 0;},PrependMany:function(b4){var b5,b6;function b7(b8,b9){var b_,b$;b_=b5.key(b9);b5.ObsoleteKey(b_);b$=bD.tryFindIndex(function(ca){return bM.Equals(b5.key(ca),b_);},b8);return b$==null?(b6.push(b9),b8):b5.storage.SSetAt(b$.$0,b9,b8);}b5=this;b6=[];this["var"].Set(this.storage.SPrependMany(b6,(((bL.Curried3(bJ.fold))(b7))(this["var"].Get()))(b4)));},Prepend:function(b4){var b5,b6,b7,b8;b5=this;b6=this["var"].Get();b7=this.key(b4);b8=bD.tryFindIndex(function(b9){return bM.Equals(b5.key(b9),b7);},b6);b8!=null&&b8.$==1?this["var"].Set(this.storage.SSetAt(b8.$0,b4,b6)):this["var"].Set(this.storage.SPrepend(b4,b6));this.ObsoleteKey(b7);},AppendMany:function(b4){var b5,b6;function b7(b8,b9){var b_,b$;b_=b5.key(b9);b5.ObsoleteKey(b_);b$=bD.tryFindIndex(function(ca){return bM.Equals(b5.key(ca),b_);},b8);return b$==null?(b6.push(b9),b8):b5.storage.SSetAt(b$.$0,b9,b8);}b5=this;b6=[];this["var"].Set(this.storage.SAppendMany(b6,(((bL.Curried3(bJ.fold))(b7))(this["var"].Get()))(b4)));},Append:function(b4){var b5,b6,b7,b8;b5=this;b6=this["var"].Get();b7=this.key(b4);b8=bD.tryFindIndex(function(b9){return bM.Equals(b5.key(b9),b7);},b6);b8!=null&&b8.$==1?this["var"].Set(this.storage.SSetAt(b8.$0,b4,b6)):this["var"].Set(this.storage.SAppend(b4,b6));this.ObsoleteKey(b7);},ObsoleteAll:function(){bJ.iter(function(b4){w.Obsolete(b4.V);},this.it);this.it.Clear();},ObsoleteKey:function(b4){var b5,b6;b5=(b6=null,[this.it.TryGetValue(b4,{get:function(){return b6;},set:function(b7){b6=b7;}}),b6]);b5[0]?(w.Obsolete(b5[1]),this.it.Remove(b4)):void 0;},GetEnumerator0:function(){return bE.Get0(this["var"].Get());},GetEnumerator:function(){return bE.Get(this["var"].Get());}},k,L);L.New=bL.Ctor(function(b4,b5){L.New$3.call(this,b4,A.Create$1(bD.ofSeq(bJ.distinctBy(b4,b5.SInit()))),b5);},L);L.New$1=bL.Ctor(function(b4){L.New$2.call(this,b4,[]);},L);L.New$2=bL.Ctor(function(b4,b5){var b6;b6=bD.ofSeq(b5);L.New$3.call(this,b4,A.Create$1(b6),I.InMemory(b6));},L);L.New$3=bL.Ctor(function(b4,b5,b6){k.New.call(this);this.key=b4;this["var"]=b5;this.storage=b6;this.v=y.Map(function(b7){return b7.slice();},this["var"].get_View());this.it=new bU.New$5();},L);M.Contains=function(b4,b5,b6){var b7;b7=b4(b5);return bD.exists(function(b8){return bM.Equals(b4(b8),b7);},b6);};L.Wrap=function(b4,b5,b6,b7){var b8,b9;b8=[new bU.New$5()];b9=bD.map(function(b_){var b$;b$=b6(b_);b8[0].set_Item(b4.key(b_),b$);return b$;},b4["var"].Get());return new L.New$3(function(b_){return b4.key(b5(b_));},A.Lens(b4["var"],function(b_){var b$,ca;b$=new bU.New$5();ca=bD.map(function(cb){var cc,cd;cc=b4.key(cb);cd=b8[0].ContainsKey(cc)?b7(b8[0].get_Item(cc),cb):b6(cb);b$.set_Item(cc,cd);return cd;},b_);b8[0]=b$;return ca;},function(b_,b$){var ca,cb;ca=new bU.New$5();cb=bD.map(function(cc){var cd;cd=b5(cc);ca.set_Item(b4.key(cd),cc);return cd;},b$);b8[0]=ca;return cb;}),I.InMemory(b9));};L.FromSeq=function(b4){return L.Create(a.id,b4);};L.Create=function(b4,b5){return L.CreateWithStorage(b4,I.InMemory(bD.ofSeq(b5)));};L.CreateWithStorage=function(b4,b5){return new L.New(b4,b5);};N.$cctor=function(){N.$cctor=a.ignore;N.Default={Encode:a.id,Decode:a.id};};O=c.ReactiveExtensions=bL.Class({},k,O);O.New=bL.Ctor(function(){k.New.call(this);},O);P=c.DoubleInterpolation=bL.Class({Interpolate:function(b4,b5,b6){return b5+b4*(b6-b5);}},null,P);P.DoubleInterpolation=new P({$:0});Q.get_Double=function(){return P.DoubleInterpolation;};R=c.Easing=bL.Class({TransformTime:function(b4){return this.transformTime(b4);}},k,R);R.get_CubicInOut=function(){return S.CubicInOut();};R.Custom=function(b4){return new R.New(b4);};R.New=bL.Ctor(function(b4){k.New.call(this);this.transformTime=b4;},R);S.CubicInOut=function(){W.$cctor();return W.CubicInOut;};T.get_Empty=function(){return{$:0,$0:p.Empty()};};T.WhenDone=function(b4,b5){return T.Append({$:0,$0:p.Single({$:0,$0:b4})},b5);};T.Run=function(b4,b5){var b6;function b7(b8){function b9(b_){return function(b$){var ca;ca=b$-b_;b5.Compute(ca);b4();return ca<=b6?void a.requestAnimationFrame(function(cb){(b9(b_))(cb);}):b8();};}a.requestAnimationFrame(function(b_){(b9(b_))(b_);});}b6=b5.Duration;return b6===0?bO.Zero():bO.FromContinuations(function(b8,b9,b_){return b7.apply(null,[b8,b9,b_]);});};T.Play=function(b4){var b5;b5=null;return bO.Delay(function(){return bO.Bind(T.Run(a.ignore,U.Actions(b4)),function(){U.Finalize(b4);return bO.Return(null);});});};T.Pack=function(b4){return{$:0,$0:p.Single({$:1,$0:b4})};};T.Map=function(b4,b5){var b6;return U.Def(b5.Duration,(b6=b5.Compute,function(b7){return b4(b6(b7));}));};T.Delayed=function(b4,b5,b6,b7,b8,b9){return{Compute:function(b_){return b_<=b7?b8:b4.Interpolate(b5.TransformTime((b_-b7)/b6),b8,b9);},Duration:b6+b7};};T.Simple=function(b4,b5,b6,b7,b8){return{Compute:function(b9){return b4.Interpolate(b5.TransformTime(b9/b6),b7,b8);},Duration:b6};};T.Const=function(b4){return U.Const(b4);};T.Concat=function(b4){return{$:0,$0:p.Concat(bJ.map(U.List,b4))};};T.Append=function(b4,b5){return{$:0,$0:p.Append(b4.$0,b5.$0)};};T.set_UseAnimations=function(b4){U.set_UseAnimations(b4);};T.get_UseAnimations=function(){return U.UseAnimations();};U.UseAnimations=function(){W.$cctor();return W.UseAnimations;};U.set_UseAnimations=function(b4){W.$cctor();W.UseAnimations=b4;};U.Actions=function(b4){return U.ConcatActions(bD.choose(function(b5){return b5.$==1?{$:1,$0:b5.$0}:null;},p.ToArray(b4.$0)));};U.ConcatActions=function(b4){var b5,b6,b7,b8;b5=d.ofSeqNonCopying(b4);b6=bD.length(b5);return b6===0?U.Const():b6===1?bD.get(b5,0):(b7=bJ.max(bJ.map(function(b9){return b9.Duration;},b5)),(b8=bD.map(function(b9){return U.Prolong(b7,b9);},b5),U.Def(b7,function(b9){bD.iter(function(b_){b_.Compute(b9);},b8);})));};U.Prolong=function(b4,b5){var b6,b7,b8;b6=b5.Compute;b7=b5.Duration;b8=bT.Create(function(){return b5.Compute(b5.Duration);});return{Compute:function(b9){return b9>=b7?b8.f():b6(b9);},Duration:b4};};U.Const=function(b4){return U.Def(0,function(){return b4;});};U.Def=function(b4,b5){return{Compute:b5,Duration:b4};};U.Finalize=function(b4){bD.iter(function(b5){if(b5.$==0)b5.$0();},p.ToArray(b4.$0));};U.List=function(b4){return b4.$0;};V=c.Trans=bL.Class({Copy:function(b4,b5,b6,b7){var b8,b9,b_,b$,ca;function cb(cc,cd){return b8.TChange(cc,cd);}b8=this;b9=b4==null?function(cc){return function(cd){return cb(cc,cd);};}:b4.$0;return new V.New$3(function(cc,cd){return(b9(cc))(cd);},(b_=this.get_TEnter(),b5==null?b_:b5.$0),(b$=this.get_TExit(),b6==null?b$:b6.$0),(ca=this.get_TFlags(),b7==null?ca:b7.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(b4,b5){return this.change(b4,b5);}},k,V);V.New=bL.Ctor(function(b4,b5,b6){V.New$3.call(this,b4,bM.Equals(b5,null)?T.Const:b5,bM.Equals(b6,null)?T.Const:b6,1|(bM.Equals(b5,null)?0:2)|(bM.Equals(b6,null)?0:4));},V);V.New$1=bL.Ctor(function(b4){V.New$3.call(this,b4,T.Const,T.Const,1);},V);V.New$2=bL.Ctor(function(){V.New$3.call(this,function(b4,b5){return T.Const(b5);},T.Const,T.Const,0);},V);V.New$3=bL.Ctor(function(b4,b5,b6,b7){k.New.call(this);this.change=b4;this.enter=b5;this.exit=b6;this.flags=b7;},V);V.Exit=function(b4,b5){return b5.Copy(null,null,{$:1,$0:b4},{$:1,$0:b5.get_TFlags()|4});};V.Enter=function(b4,b5){return b5.Copy(null,{$:1,$0:b4},null,{$:1,$0:b5.get_TFlags()|2});};V.Change=function(b4,b5){return b5.Copy({$:1,$0:b4},null,null,{$:1,$0:b5.get_TFlags()|1});};V.Create=function(b4){return new V.New$1(b4);};V.Trivial=function(){return new V.New$2();};V.CanAnimateExit=function(b4){var b5,b6;b5=b4.get_TFlags();b6=4;return(b5&b6)===b6;};V.CanAnimateEnter=function(b4){var b5,b6;b5=b4.get_TFlags();b6=2;return(b5&b6)===b6;};V.CanAnimateChange=function(b4){var b5,b6;b5=b4.get_TFlags();b6=1;return(b5&b6)===b6;};V.AnimateExit=function(b4,b5){return(b4.get_TExit())(b5);};V.AnimateEnter=function(b4,b5){return(b4.get_TEnter())(b5);};V.AnimateChange=function(b4,b5,b6){return b4.TChange(b5,b6);};W.$cctor=function(){W.$cctor=a.ignore;W.CubicInOut=R.Custom(function(b4){var b5;b5=b4*b4;return 3*b5-2*(b5*b4);});W.UseAnimations=true;};Z=c.OnAfterRenderControl=bL.Class({get_Body:function(){var b4,b5,b6,b7,b8,b9;b5=self.document.querySelectorAll("[ws-runafterrender]");for(b6=0,b7=b5.length-1;b6<=b7;b6++){b8=b5[b6];b9=a["eval"](b8.getAttribute("ws-runafterrender"));b8.removeAttribute("ws-runafterrender");b9(b8);}b4={ReplaceInDom:function(){return null;}};k.New.call(b4);return b4;}},Y,Z);_0=c.AnimatedAttrNode=bL.Class({sync:function(b4){var b5;if(this.dirty){b5=this.logical;b5==null?void 0:(this.push(b4))(b5.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(b4,b5){this.visible={$:1,$0:b5};this.dirty=true;(this.push(b4))(b5);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(b4){var b5,b6;b5=this;return T.WhenDone(function(){b5.dirty=true;b5.visible=null;},(b6=this.visible,b6!=null&&b6.$==1?T.Pack(T.Map(function(b7){b5.pushVisible(b4,b7);},V.AnimateExit(this.tr,b6.$0))):T.get_Empty()));},NGetEnterAnim:function(b4){var b5,b6,b7,b8,b9;b5=this;return T.WhenDone(function(){b5.sync(b4);},(b6=this.visible,(b7=this.logical,b6!=null&&b6.$==1&&(b7!=null&&b7.$==1&&(this.dirty&&(b8=[b7.$0,b6.$0],true)))?T.Pack(T.Map(function(b_){b5.pushVisible(b4,b_);},V.AnimateChange(this.tr,b8[1],b8[0]))):b6==null&&(b7!=null&&b7.$==1)?T.Pack(T.Map(function(b_){b5.pushVisible(b4,b_);},V.AnimateEnter(this.tr,b7.$0))):T.get_Empty())));},NGetChangeAnim:function(b4){var b5,b6,b7,b8;b5=this;return T.WhenDone(function(){b5.sync(b4);},(b6=this.visible,(b7=this.logical,b6!=null&&b6.$==1&&(b7!=null&&b7.$==1&&(this.dirty&&(b8=[b7.$0,b6.$0],true)))?T.Pack(T.Map(function(b9){b5.pushVisible(b4,b9);},V.AnimateChange(this.tr,b8[1],b8[0]))):T.get_Empty())));}},k,_0);_0.New=bL.Ctor(function(b4,b5,b6){var b7;b7=this;k.New.call(this);this.tr=b4;this.push=b6;this.logical=null;this.visible=null;this.dirty=true;this.updates=y.Map(function(b8){b7.logical={$:1,$0:b8};b7.dirty=true;},b5);},_0);_1=c.DynamicAttrNode=bL.Class({NChanged:function(){return this.updates;},NSync:function(b4){if(this.dirty){(this.push(b4))(this.value);this.dirty=false;}},NGetExitAnim:function(b4){return T.get_Empty();},NGetEnterAnim:function(b4){return T.get_Empty();},NGetChangeAnim:function(b4){return T.get_Empty();}},k,_1);_1.New=bL.Ctor(function(b4,b5){var b6;b6=this;k.New.call(this);this.push=b5;this.value=void 0;this.dirty=false;this.updates=y.Map(function(b7){b6.value=b7;b6.dirty=true;},b4);},_1);_2=c.AttrProxy=bL.Class({},null,_2);_2.Handler=function(b4,b5){return _2.HandlerImpl(b4,b5);};_2.HandlerImpl=function(b4,b5){return _6.Static(function(b6){b6.addEventListener(b4,function(b7){return(b5(b6))(b7);},false);});};_2.OnAfterRenderImpl=function(b4){return new _2({$:4,$0:b4});};_2.Concat=function(b4){var b5;b5=d.ofSeqNonCopying(b4);return d.TreeReduce(_6.EmptyAttr(),_2.Append,b5);};_2.Append=function(b4,b5){return _6.AppendTree(b4,b5);};_2.Create=function(b4,b5){return _6.Static(function(b6){b6.setAttribute(b4,b5);});};_5.New=function(b4,b5,b6,b7){var b8;b8={DynElem:b4,DynFlags:b5,DynNodes:b6};bL.SetOptional(b8,"OnAfterRender",b7);return b8;};_6.Static=function(b4){return new _2({$:3,$0:b4});};_6.Dynamic=function(b4,b5){return new _2({$:1,$0:new _1.New(b4,b5)});};_6.Animated=function(b4,b5,b6){var b7,b8,b9;b7=new _0.New(b4,b5,b6);b8=4;V.CanAnimateEnter(b4)?b8=b8|1:void 0;V.CanAnimateExit(b4)?b8=b8|2:void 0;b9=new _2({$:1,$0:b7});_6.SetFlags(b9,b8);return b9;};_6.EmptyAttr=function(){_.$cctor();return _.EmptyAttr;};_6.AppendTree=function(b4,b5){var b6;return b4===null?b5:b5===null?b4:(b6=new _2({$:2,$0:b4,$1:b5}),(_6.SetFlags(b6,_6.Flags(b4)|_6.Flags(b5)),b6));};_6.GetChangeAnim=function(b4){return _6.GetAnim(b4,function(b5,b6){return b5.NGetChangeAnim(b6);});};_6.GetExitAnim=function(b4){return _6.GetAnim(b4,function(b5,b6){return b5.NGetExitAnim(b6);});};_6.GetEnterAnim=function(b4){return _6.GetAnim(b4,function(b5,b6){return b5.NGetEnterAnim(b6);});};_6.GetAnim=function(b4,b5){return T.Concat(bD.map(function(b6){return b5(b6,b4.DynElem);},b4.DynNodes));};_6.Updates=function(b4){return d.MapTreeReduce(function(b5){return b5.NChanged();},y.Const(),y.Map2Unit,b4.DynNodes);};_6.Empty=function(b4){return _5.New(b4,0,[],null);};_6.Insert=function(b4,b5){var b6,b7,b8;function b9(b_){var b$,ca;while(true)if(!(b_===null)){if(b_!=null&&b_.$==1)return b6.push(b_.$0);else if(b_!=null&&b_.$==2){b$=b_.$1;ca=b_.$0;b9(ca);b_=b$;}else return b_!=null&&b_.$==3?b_.$0(b4):b_!=null&&b_.$==4?b7.push(b_.$0):null;}else return null;}b6=[];b7=[];b9(b5);b8=b6.slice(0);return _5.New(b4,_6.Flags(b5),b8,b7.length===0?null:{$:1,$0:function(b_){bJ.iter(function(b$){b$(b_);},b7);}});};_6.Sync=function(b4,b5){bD.iter(function(b6){b6.NSync(b4);},b5.DynNodes);};_6.SetFlags=function(b4,b5){b4.flags=b5;};_6.Flags=function(b4){return b4!==null&&b4.hasOwnProperty("flags")?b4.flags:0;};_6.HasExitAnim=function(b4){var b5;b5=2;return(b4.DynFlags&b5)===b5;};_6.HasEnterAnim=function(b4){var b5;b5=1;return(b4.DynFlags&b5)===b5;};_6.HasChangeAnim=function(b4){var b5;b5=4;return(b4.DynFlags&b5)===b5;};_7=c.CheckedInput=bL.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_7);_7.Make=function(b4){var b5;return new _7({$:0,$0:b4,$1:(b5=b4,a.String(b5))});};_8.FloatApplyChecked=function(){_.$cctor();return _.FloatApplyChecked;};_8.FloatGetChecked=function(){_.$cctor();return _.FloatGetChecked;};_8.FloatSetChecked=function(){_.$cctor();return _.FloatSetChecked;};_8.FloatApplyUnchecked=function(){_.$cctor();return _.FloatApplyUnchecked;};_8.FloatGetUnchecked=function(){_.$cctor();return _.FloatGetUnchecked;};_8.FloatSetUnchecked=function(){_.$cctor();return _.FloatSetUnchecked;};_8.IntApplyChecked=function(){_.$cctor();return _.IntApplyChecked;};_8.IntGetChecked=function(){_.$cctor();return _.IntGetChecked;};_8.IntSetChecked=function(){_.$cctor();return _.IntSetChecked;};_8.IntApplyUnchecked=function(){_.$cctor();return _.IntApplyUnchecked;};_8.IntGetUnchecked=function(){_.$cctor();return _.IntGetUnchecked;};_8.IntSetUnchecked=function(){_.$cctor();return _.IntSetUnchecked;};_8.StringApply=function(){_.$cctor();return _.StringApply;};_8.StringGet=function(){_.$cctor();return _.StringGet;};_8.StringSet=function(){_.$cctor();return _.StringSet;};_8.BoolCheckedApply=function(){_.$cctor();return _.BoolCheckedApply;};_8.ApplyValue=function(b4,b5,b6,b7,b8){return[b7(function(b9){function b_(){b6.UpdateMaybe(function(b$){var ca,cb;ca=b4(b9);return ca!=null&&ca.$==1&&(!bM.Equals(ca.$0,b$)&&(cb=[ca,ca.$0],true))?cb[0]:null;});}b9.addEventListener("change",b_);b9.addEventListener("input",b_);b9.addEventListener("keypress",b_);}),b8(function(b9){return function(b_){var b$,ca;b$=b4(b9);return b$!=null&&b$.$==1&&(bM.Equals(b$.$0,b_)&&(ca=b$.$0,true))?null:b5(b9,b_);};})];};_9.ValidateForm=function(){return _9.OnAfterRender(function(b4){if(self.H5F)self.H5F.setup(b4);});};_9.Checked=function(b4){var b5;b5=(((_8.BoolCheckedApply())(b4))(_6.Static))(function(b6){return _9.DynamicCustom(b6,b4.get_View());});return _2.Append(b5[0],b5[1]);};_9.FloatValue=function(b4){var b5;b5=(((_8.FloatApplyChecked())(b4))(_6.Static))(function(b6){return _9.DynamicCustom(b6,b4.get_View());});return _2.Append(b5[0],b5[1]);};_9.FloatValueUnchecked=function(b4){var b5;b5=(((_8.FloatApplyUnchecked())(b4))(_6.Static))(function(b6){return _9.DynamicCustom(b6,b4.get_View());});return _2.Append(b5[0],b5[1]);};_9.IntValue=function(b4){var b5;b5=(((_8.IntApplyChecked())(b4))(_6.Static))(function(b6){return _9.DynamicCustom(b6,b4.get_View());});return _2.Append(b5[0],b5[1]);};_9.IntValueUnchecked=function(b4){var b5;b5=(((_8.IntApplyUnchecked())(b4))(_6.Static))(function(b6){return _9.DynamicCustom(b6,b4.get_View());});return _2.Append(b5[0],b5[1]);};_9.Value=function(b4){var b5;b5=(((_8.StringApply())(b4))(_6.Static))(function(b6){return _9.DynamicCustom(b6,b4.get_View());});return _2.Append(b5[0],b5[1]);};_9.ContentEditableHtml=function(b4){var b5;b5=_9.CustomVar(b4,function(b6,b7){b6.innerHTML=b7;},function(b6){return{$:1,$0:b6.innerHTML};});return _2.Append(_2.Create("contenteditable","true"),b5);};_9.ContentEditableText=function(b4){var b5;b5=_9.CustomVar(b4,function(b6,b7){b6.textContent=b7;},function(b6){return{$:1,$0:b6.textContent};});return _2.Append(_2.Create("contenteditable","true"),b5);};_9.CustomValue=function(b4,b5,b6){return _9.CustomVar(b4,function(b7,b8){b7.value=b5(b8);},function(b7){return b6(b7.value);});};_9.CustomVar=function(b4,b5,b6){var b7;b7=_8.ApplyValue(b6,b5,b4,_6.Static,function(b8){return _9.DynamicCustom(b8,b4.get_View());});return _2.Append(b7[0],b7[1]);};_9.DynamicProp=function(b4,b5){return _6.Dynamic(b5,function(b6){return function(b7){b6[b4]=b7;};});};_9.Prop=function(b4,b5){return _6.Static(function(b6){b6[b4]=b5;});};_9.DynamicPred=function(b4,b5,b6){function b7(b8,b9){return b9[0]?b8.setAttribute(b4,b9[1]):b8.removeAttribute(b4);}return _6.Dynamic(y.Map2(function(b8,b9){return[b8,b9];},b5,b6),function(b8){return function(b9){return b7(b8,b9);};});};_9.DynamicClass=function(b4,b5,b6){return _9.DynamicClassPred(b4,y.Map(b6,b5));};_9.Class=function(b4){return _9.ClassPred(b4,true);};_9.ClassPred=function(b4,b5){return _6.Static(function(b6){if(b5)r.AddClass(b6,b4);else r.RemoveClass(b6,b4);});};_9.DynamicClassPred=function(b4,b5){return _6.Dynamic(b5,function(b6){return function(b7){return b7?r.AddClass(b6,b4):r.RemoveClass(b6,b4);};});};_9.OnAfterRenderView=function(b4,b5){var b6;b6=h.Id();return _2.Append(_9.OnAfterRender(function(b7){b5(b7,b7[b6]);}),_9.DynamicCustom(function(b7){return function(b8){b7[b6]=b8;};},b4));};_9.OnAfterRender=function(b4){return new _2({$:4,$0:b4});};_9.HandlerView=function(b4,b5,b6){return _6.Static(function(b7){var b8;b8=b6(b7);b7.addEventListener(b4,function(b9){return y.Get(b8(b9),b5);},false);});};_9.Handler=function(b4,b5){return _6.Static(function(b6){b6.addEventListener(b4,function(b7){return(b5(b6))(b7);},false);});};_9.DynamicStyle=function(b4,b5){return _6.Dynamic(b5,function(b6){return function(b7){return b6.style.setProperty(b4,b7);};});};_9.DynamicCustom=function(b4,b5){return _6.Dynamic(b5,b4);};_9.Dynamic=function(b4,b5){return _6.Dynamic(b5,function(b6){return function(b7){return b6.setAttribute(b4,b7);};});};_9.AnimatedStyle=function(b4,b5,b6,b7){return _6.Animated(b5,b6,function(b8){return function(b9){var b_;b_=b7(b9);return b8.style.setProperty(b4,b_);};});};_9.Animated=function(b4,b5,b6,b7){return _6.Animated(b5,b6,function(b8){return function(b9){return b8.setAttribute(b4,b7(b9));};});};_9.Style=function(b4,b5){return _6.Static(function(b6){b6.style.setProperty(b4,b5);});};_.$cctor=function(){var b4,b5,b6,b7,b8,b9,b_,b$,ca,cb;_.$cctor=a.ignore;_.EmptyAttr=null;_.BoolCheckedApply=bL.Curried3(function(cc,cd,ce){return[cd(function(cf){cf.addEventListener("change",function(){return!bM.Equals(cc.Get(),cf.checked)?cc.Set(cf.checked):null;});}),ce(function(cf){return function(cg){cf.checked=cg;};})];});_.StringSet=function(cc){return function(cd){cc.value=cd;};};_.StringGet=function(cc){return{$:1,$0:cc.value};};_.StringApply=(b4=_8.StringGet(),(b5=_8.StringSet(),bL.Curried(_8.ApplyValue,3,[b4,function(cc,cd){return(b5(cc))(cd);}])));_.IntSetUnchecked=function(cc){return function(cd){cc.value=a.String(cd);};};_.IntGetUnchecked=function(cc){var cd,ce;cd=cc.value;return e.isBlank(cd)?{$:1,$0:0}:(ce=+cd,ce!==ce>>0?null:{$:1,$0:ce});};_.IntApplyUnchecked=(b6=_8.IntGetUnchecked(),(b7=_8.IntSetUnchecked(),bL.Curried(_8.ApplyValue,3,[b6,function(cc,cd){return(b7(cc))(cd);}])));_.IntSetChecked=function(cc){return function(cd){var ce;ce=cd.get_Input();return cc.value!==ce?void(cc.value=ce):null;};};_.IntGetChecked=function(cc){var cd,ce,cf;cd=cc.value;return{$:1,$0:e.isBlank(cd)?(cc.checkValidity?cc.checkValidity():true)?new _7({$:2,$0:cd}):new _7({$:1,$0:cd}):(ce=(cf=0,[bW.TryParseInt32(cd,{get:function(){return cf;},set:function(cg){cf=cg;}}),cf]),ce[0]?new _7({$:0,$0:ce[1],$1:cd}):new _7({$:1,$0:cd}))};};_.IntApplyChecked=(b8=_8.IntGetChecked(),(b9=_8.IntSetChecked(),bL.Curried(_8.ApplyValue,3,[b8,function(cc,cd){return(b9(cc))(cd);}])));_.FloatSetUnchecked=function(cc){return function(cd){cc.value=a.String(cd);};};_.FloatGetUnchecked=function(cc){var cd,ce;cd=cc.value;return e.isBlank(cd)?{$:1,$0:0}:(ce=+cd,a.isNaN(ce)?null:{$:1,$0:ce});};_.FloatApplyUnchecked=(b_=_8.FloatGetUnchecked(),(b$=_8.FloatSetUnchecked(),bL.Curried(_8.ApplyValue,3,[b_,function(cc,cd){return(b$(cc))(cd);}])));_.FloatSetChecked=function(cc){return function(cd){var ce;ce=cd.get_Input();return cc.value!==ce?void(cc.value=ce):null;};};_.FloatGetChecked=function(cc){var cd,ce;cd=cc.value;return{$:1,$0:e.isBlank(cd)?(cc.checkValidity?cc.checkValidity():true)?new _7({$:2,$0:cd}):new _7({$:1,$0:cd}):(ce=+cd,a.isNaN(ce)?new _7({$:1,$0:cd}):new _7({$:0,$0:ce,$1:cd}))};};_.FloatApplyChecked=(ca=_8.FloatGetChecked(),(cb=_8.FloatSetChecked(),bL.Curried(_8.ApplyValue,3,[ca,function(cc,cd){return(cb(cc))(cd);}])));};$.BatchUpdatesEnabled=function(){bj.$cctor();return bj.BatchUpdatesEnabled;};$.set_BatchUpdatesEnabled=function(b4){bj.$cctor();bj.BatchUpdatesEnabled=b4;};ba=c.DocElemNode=bL.Class({GetHashCode:function(){return this.ElKey;},Equals:function(b4){return this.ElKey===b4.ElKey;}},null,ba);ba.New=function(b4,b5,b6,b7,b8,b9){var b_;return new ba((b_={Attr:b4,Children:b5,El:b7,ElKey:b8},(bL.SetOptional(b_,"Delimiters",b6),bL.SetOptional(b_,"Render",b9),b_)));};bc.FoldBack=function(b4,b5,b6){return bD.foldBack(b4,b5.$0,b6);};bc.Iter=function(b4,b5){bD.iter(b4,b5.$0);};bc.Except=function(b4,b5){var b6;b6=b4.$0;return{$:0,$0:bD.filter(function(b7){return bD.forall(function(b8){return!(b7===b8);},b6);},b5.$0)};};bc.DocChildren=function(b4){var b5;function b6(b7){var b8,b9,b_,b$;while(true){if(b7!=null&&b7.$==2){b9=b7.$0;b7=b9.Current;}else if(b7!=null&&b7.$==1)return b5.push(b7.$0.El);else if(b7==null)return null;else if(b7!=null&&b7.$==5)return b5.push(b7.$0);else if(b7!=null&&b7.$==4)return b5.push(b7.$0.Text);else if(b7!=null&&b7.$==6){b8=b7.$0.Els;return(function(ca){return function(cb){bD.iter(ca,cb);};}(function(ca){if(ca==null||ca.constructor===a.Object)b6(ca);else b5.push(ca);}))(b8);}else{b_=b7.$1;b$=b7.$0;b6(b$);b7=b_;}}}b5=[];b6(b4.Children);return{$:0,$0:d.ofSeqNonCopying(b5)};};bc.Children=function(b4,b5){var b6,b7,b8;if(b5!=null&&b5.$==1){b8=[];b6=b5.$0[0].nextSibling;while(b6!==b5.$0[1]){b8.push(b6);b6=b6.nextSibling;}return{$:0,$0:b8};}else return{$:0,$0:bD.init(b4.childNodes.length,(b7=b4.childNodes,function(b9){return b7[b9];}))};};bd.ToArray=function(b4){return i.ToArray(b4.$0);};bd.get_Empty=function(){return{$:0,$0:new bI.New$3()};};bd.IsEmpty=function(b4){return b4.$0.get_Count()===0;};bd.Intersect=function(b4,b5){return{$:0,$0:i.Intersect(b4.$0,b5.$0)};};bd.Except=function(b4,b5){return{$:0,$0:i.Except(b4.$0,b5.$0)};};bd.FindAll=function(b4){var b5;function b6(b9,b_){var b$,ca,cb,cc,cd;while(true)switch(b9){case 0:if(b_!=null&&b_.$==0){ca=b_.$1;cb=b_.$0;b6(0,cb);b_=ca;}else if(b_!=null&&b_.$==1){cc=b_.$0;b_=cc;b9=1;}else if(b_!=null&&b_.$==2){cd=b_.$0;b_=cd.Current;}else return b_!=null&&b_.$==6?(b$=b_.$0.Holes,(function(ce){return function(cf){bD.iter(ce,cf);};}(b8))(b$)):null;break;case 1:b5.push(b_);b_=b_.Children;b9=0;break;}}function b7(b9){return b6(0,b9);}function b8(b9){return b6(1,b9);}b5=[];b7(b4);return{$:0,$0:new bI.New$2(b5)};};bd.Filter=function(b4,b5){return{$:0,$0:i.Filter(b4,b5.$0)};};be.New=function(b4,b5){return{PreviousNodes:b4,Top:b5};};bf.UpdateTextNode=function(b4,b5){b4.Value=b5;b4.Dirty=true;};bf.CreateTextNode=function(){return{Text:self.document.createTextNode(""),Dirty:false,Value:""};};bf.UpdateEmbedNode=function(b4,b5){b4.Current=b5;b4.Dirty=true;};bf.CreateEmbedNode=function(){return{Current:null,Dirty:false};};bf.PerformSyncUpdate=function(b4,b5,b6){var b7;b7=bd.FindAll(b6);bf.SyncElemNode(b4,b5.Top);b5.PreviousNodes=b7;};bf.PerformAnimatedUpdate=function(b4,b5,b6){var b7;return T.get_UseAnimations()?(b7=null,bO.Delay(function(){var b8,b9,b_;b8=bd.FindAll(b6);b9=bf.ComputeChangeAnim(b5,b8);b_=bf.ComputeEnterAnim(b5,b8);return bO.Bind(T.Play(T.Append(b9,bf.ComputeExitAnim(b5,b8))),function(){return bO.Bind(bf.SyncElemNodesNextFrame(b4,b5),function(){return bO.Bind(T.Play(b_),function(){b5.PreviousNodes=b8;return bO.Return(null);});});});})):bf.SyncElemNodesNextFrame(b4,b5);};bf.SyncElemNodesNextFrame=function(b4,b5){function b6(b7){a.requestAnimationFrame(function(){bf.SyncElemNode(b4,b5.Top);b7();});}return $.BatchUpdatesEnabled()?bO.FromContinuations(function(b7,b8,b9){return b6.apply(null,[b7,b8,b9]);}):(bf.SyncElemNode(b4,b5.Top),bO.Return(null));};bf.ComputeEnterAnim=function(b4,b5){return T.Concat(bD.map(function(b6){return _6.GetEnterAnim(b6.Attr);},bd.ToArray(bd.Except(b4.PreviousNodes,bd.Filter(function(b6){return _6.HasEnterAnim(b6.Attr);},b5)))));};bf.ComputeChangeAnim=function(b4,b5){var b6;function b7(b8){return _6.HasChangeAnim(b8.Attr);}b6=function(b8){return bd.Filter(b7,b8);};return T.Concat(bD.map(function(b8){return _6.GetChangeAnim(b8.Attr);},bd.ToArray(bd.Intersect(b6(b4.PreviousNodes),b6(b5)))));};bf.ComputeExitAnim=function(b4,b5){return T.Concat(bD.map(function(b6){return _6.GetExitAnim(b6.Attr);},bd.ToArray(bd.Except(b5,bd.Filter(function(b6){return _6.HasExitAnim(b6.Attr);},b4.PreviousNodes)))));};bf.CreateDelimitedRunState=function(b4,b5,b6){return be.New(bd.get_Empty(),bf.CreateDelimitedElemNode(b4,b5,_6.EmptyAttr(),b6));};bf.CreateRunState=function(b4,b5){return be.New(bd.get_Empty(),bf.CreateElemNode(b4,_6.EmptyAttr(),b5));};bf.CreateDelimitedElemNode=function(b4,b5,b6,b7){var b8,b9;b8=b4.parentNode;bf.LinkPrevElement(b5,b7);b9=_6.Insert(b8,b6);return ba.New(b9,b7,{$:1,$0:[b4,b5]},b8,h.Int(),bL.GetOptional(b9.OnAfterRender));};bf.CreateElemNode=function(b4,b5,b6){var b7;bf.LinkElement(b4,b6);b7=_6.Insert(b4,b5);return ba.New(b7,b6,null,b4,h.Int(),bL.GetOptional(b7.OnAfterRender));};bf.SyncElemNode=function(b4,b5){!b4?bf.SyncElement(b5):void 0;bf.Sync(b5.Children);bf.AfterRender(b5);};bf.Sync=function(b4){var b5,b6,b7,b8,b9;while(true){if(b4!=null&&b4.$==1)return bf.SyncElemNode(false,b4.$0);else if(b4!=null&&b4.$==2){b7=b4.$0;b4=b7.Current;}else if(b4==null)return null;else if(b4!=null&&b4.$==5)return null;else if(b4!=null&&b4.$==4){b5=b4.$0;return b5.Dirty?(b5.Text.nodeValue=b5.Value,b5.Dirty=false):null;}else if(b4!=null&&b4.$==6){b6=b4.$0;bD.iter(function(b_){return function(b$){bf.SyncElemNode(b_,b$);};}(false),b6.Holes);bD.iter(function(b_){_6.Sync(b_[0],b_[1]);},b6.Attrs);return bf.AfterRender(b6);}else{b8=b4.$1;b9=b4.$0;bf.Sync(b9);b4=b8;}}};bf.AfterRender=function(b4){var b5;b5=bL.GetOptional(b4.Render);b5!=null&&b5.$==1?(b5.$0(b4.El),bL.SetOptional(b4,"Render",null)):void 0;};bf.InsertBeforeDelim=function(b4,b5){var b6,b7;b6=b4.parentNode;b7=self.document.createTextNode("");b6.insertBefore(b7,b4);bf.LinkPrevElement(b4,b5);return b7;};bf.LinkPrevElement=function(b4,b5){bf.InsertDoc(b4.parentNode,b5,b4);};bf.LinkElement=function(b4,b5){bf.InsertDoc(b4,b5,null);};bf.SyncElement=function(b4){function b5(b6){function b7(b8){var b9,b_,b$,ca;while(true){if(b8!=null&&b8.$==0){b_=b8.$1;b$=b8.$0;if(b7(b$))return true;else b8=b_;}else if(b8!=null&&b8.$==2){ca=b8.$0;if(ca.Dirty)return true;else b8=ca.Current;}else return b8!=null&&b8.$==6&&(b9=b8.$0,b9.Dirty||bD.exists(b5,b9.Holes));}}return b7(b6.Children);}_6.Sync(b4.El,b4.Attr);b5(b4)?bf.DoSyncElement(b4):void 0;};bf.DoSyncElement=function(b4){var b5,b6,b7;function b8(b9,b_){var b$,ca,cb,cc;while(true){if(b9!=null&&b9.$==1)return b9.$0.El;else if(b9!=null&&b9.$==2){ca=b9.$0;if(ca.Dirty){ca.Dirty=false;return bf.InsertDoc(b5,ca.Current,b_);}else b9=ca.Current;}else if(b9==null)return b_;else if(b9!=null&&b9.$==4)return b9.$0.Text;else if(b9!=null&&b9.$==5)return b9.$0;else if(b9!=null&&b9.$==6){b$=b9.$0;b$.Dirty?b$.Dirty=false:void 0;return bD.foldBack(function(cd,ce){return cd==null||cd.constructor===a.Object?b8(cd,ce):cd;},b$.Els,b_);}else{cb=b9.$1;cc=b9.$0;b9=cc;b_=b8(cb,b_);}}}b5=b4.El;bc.Iter((b6=b4.El,function(b9){r.RemoveNode(b6,b9);}),bc.Except(bc.DocChildren(b4),bc.Children(b4.El,bL.GetOptional(b4.Delimiters))));b8(b4.Children,(b7=bL.GetOptional(b4.Delimiters),b7!=null&&b7.$==1?b7.$0[1]:null));};bf.InsertDoc=function(b4,b5,b6){var b7,b8,b9;while(true)if(b5!=null&&b5.$==1)return bf.InsertNode(b4,b5.$0.El,b6);else if(b5!=null&&b5.$==2){b7=b5.$0;b7.Dirty=false;b5=b7.Current;}else if(b5==null)return b6;else if(b5!=null&&b5.$==4)return bf.InsertNode(b4,b5.$0.Text,b6);else if(b5!=null&&b5.$==5)return bf.InsertNode(b4,b5.$0,b6);else if(b5!=null&&b5.$==6)return bD.foldBack(function(b_,b$){return(((bL.Curried3(function(ca,cb,cc){return cb==null||cb.constructor===a.Object?bf.InsertDoc(ca,cb,cc):bf.InsertNode(ca,cb,cc);}))(b4))(b_))(b$);},b5.$0.Els,b6);else{b8=b5.$1;b9=b5.$0;b5=b9;b6=bf.InsertDoc(b4,b8,b6);}};bf.InsertNode=function(b4,b5,b6){r.InsertAt(b4,b6,b5);return b5;};bg=c.Doc=bL.Class({ReplaceInDom:function(b4){var b5;b5=self.document.createTextNode("");b4.parentNode.replaceChild(b5,b4);bg.RunBefore(b5,this);}},k,bg);bg.SvgElementMixed=function(b4,b5){var b6;b6=bg.MixedNodes(b5);return bg.SvgElement(b4,b6[0],b6[1]);};bg.SvgElement=function(b4,b5,b6){var b7,b8;b7=_2.Concat(b5);b8=bg.Concat(b6);return bh.New(self.document.createElementNS("http://www.w3.org/2000/svg",b4),b7,b8);};bg.ElementMixed=function(b4,b5){var b6;b6=bg.MixedNodes(b5);return bg.Element(b4,b6[0],b6[1]);};bg.ConcatMixed=function(b4){return bg.Concat(bJ.map(bg.ToMixedDoc,b4));};bg.MixedNodes=function(b4){var b5,b6,b7,b8;b5=[];b6=[];b7=bE.Get(b4);try{while(b7.MoveNext()){b8=b7.Current();b8 instanceof _2?b5.push(b8):b6.push(bg.ToMixedDoc(b8));}}finally{if(typeof b7=="object"&&"Dispose"in b7)b7.Dispose();}return[b5,b6];};bg.ToMixedDoc=function(b4){return b4 instanceof bg?b4:typeof b4=="string"?bg.TextNode(b4):b4 instanceof a.Element?bg.StaticProxy(b4):typeof b4=="function"?bg.EmbedView(y.Map(bg.ToMixedDoc,b4)):b4 instanceof x?bg.EmbedView(y.Map(bg.ToMixedDoc,b4.get_View())):bM.Equals(b4,null)?bg.get_Empty():bg.TextNode(a.String(b4));};bg.Element=function(b4,b5,b6){var b7,b8;b7=_2.Concat(b5);b8=bg.Concat(b6);return bh.New(self.document.createElement(b4),b7,b8);};bg.Radio=function(b4,b5,b6){var b7,b8;b7=self.document.createElement("input");b7.addEventListener("click",function(){return b6.Set(b5);},false);b8=_9.DynamicProp("checked",y.Map(function(b9){return bM.Equals(b9,b5);},b6.get_View()));return bh.New(b7,_2.Concat(bC.append(bC.ofArray([_2.Create("type","radio"),_2.Create("name",b6.get_Id()),b8]),bC.ofSeq(b4))),bg.get_Empty());};bg.LinkView=function(b4,b5,b6,b7){var b8;b8=_2.Concat(bJ.append([_9.HandlerView("click",b6,function(){return function(){return b7;};}),_2.Create("href","#")],b5));return bh.New(self.document.createElement("a"),b8,bg.TextNode(b4));};bg.Link=function(b4,b5,b6){var b7,b8;b7=(b8=_2.Concat(b5),_2.Append(_2.Create("href","#"),b8));return bh.New(bg.Clickable("a",b6),b7,bg.TextNode(b4));};bg.ButtonView=function(b4,b5,b6,b7){var b8;b8=_2.Concat(bJ.append([_9.HandlerView("click",b6,function(){return function(){return b7;};})],b5));return bh.New(self.document.createElement("button"),b8,bg.TextNode(b4));};bg.Button=function(b4,b5,b6){var b7;b7=_2.Concat(b5);return bh.New(bg.Clickable("button",b6),b7,bg.TextNode(b4));};bg.Clickable=function(b4,b5){var b6;b6=self.document.createElement(b4);b6.addEventListener("click",function(b7){b7.preventDefault();return b5();},false);return b6;};bg.CheckBoxGroup=function(b4,b5,b6){function b7(b8){return bM.Equals(b5,b8);}return bg.CheckBox(b4,A.Lens(b6,function(b8){return bC.exists(b7,b8);},function(b8,b9){return b9?bC.exists(function(b_){return bM.Equals(b5,b_);},b8)?b8:new bC.T({$:1,$0:b5,$1:b8}):bC.filter(function(b_){return!bM.Equals(b5,b_);},b8);}));};bg.CheckBox=function(b4,b5){return bg.InputInternal("input",function(){return bJ.append(b4,[_2.Create("type","checkbox"),_9.Checked(b5)]);});};bg.SelectDynOptional=function(b4,b5,b6,b7,b8){return bg.SelectDyn(b4,function(b9){return b9!=null&&b9.$==1?b6(b9.$0):b5;},y.Map(function(b9){return new bC.T({$:1,$0:null,$1:bC.map(function(b_){return{$:1,$0:b_};},b9)});},b7),b8);};bg.SelectOptional=function(b4,b5,b6,b7,b8){return bg.Select(b4,function(b9){return b9!=null&&b9.$==1?b6(b9.$0):b5;},new bC.T({$:1,$0:null,$1:bC.map(function(b9){return{$:1,$0:b9};},b7)}),b8);};bg.Select=function(b4,b5,b6,b7){return bg.SelectImpl(b4,b5,function(b8){b8[0]=b6;return bg.Concat(bC.mapi(function(b9,b_){return bg.Element("option",bC.ofArray([_2.Create("value",a.String(b9))]),bC.ofArray([bg.TextNode(b5(b_))]));},b6));},b7);};bg.SelectDyn=function(b4,b5,b6,b7){return bg.SelectImpl(b4,b5,function(b8){function b9(b_,b$){return bg.Element("option",bC.ofArray([_2.Create("value",a.String(b_))]),bC.ofArray([bg.TextNode(b5(b$))]));}return bg.Convert(function(b_){return b9(b_[0],b_[1]);},y.Map(function(b_){b8[0]=b_;return bJ.mapi(function(b$,ca){return[b$,ca];},b_);},b6));},b7);};bg.SelectImpl=function(b4,b5,b6,b7){var b8,b9,b_,b$;function ca(cf){return cf.selectedIndex;}function cb(cf,cg){cf.selectedIndex=cg;}function cc(cf){var cg;cg=ca(cf);return b8[0].get_Item(cg);}function cd(cf){return bJ.findIndex(function(cg){return bM.Equals(cf,cg);},b8[0]);}function ce(cf,cg){return cb(cf,cd(cg));}b8=[bC.T.Empty];b9=self.document.createElement("select");b_=_9.DynamicCustom(function(cf){return function(cg){return ce(cf,cg);};},b7.get_View());b9.addEventListener("change",function(){b7.UpdateMaybe(function(cf){var cg;cg=cc(b9);return bM.Equals(cf,cg)?null:{$:1,$0:cg};});},false);return bh.New(b9,(b$=_2.Append(b_,_2.Concat(b4)),_2.Append(_9.OnAfterRender(function(cf){ce(cf,b7.Get());}),b$)),b6(b8));};bg.InputArea=function(b4,b5){return bg.InputInternal("textarea",function(){return bJ.append(b4,[_9.Value(b5)]);});};bg.FloatInput=function(b4,b5){return bg.InputInternal("input",function(){return bJ.append(b4,[_9.FloatValue(b5),_2.Create("type","number")]);});};bg.FloatInputUnchecked=function(b4,b5){return bg.InputInternal("input",function(){return bJ.append(b4,[b5.Get()===0?_2.Create("value","0"):_6.EmptyAttr(),_9.FloatValueUnchecked(b5),_2.Create("type","number")]);});};bg.IntInput=function(b4,b5){return bg.InputInternal("input",function(){return bJ.append(b4,[_9.IntValue(b5),_2.Create("type","number")]);});};bg.IntInputUnchecked=function(b4,b5){return bg.InputInternal("input",function(){return bJ.append(b4,[b5.Get()===0?_2.Create("value","0"):_6.EmptyAttr(),_9.IntValueUnchecked(b5),_2.Create("type","number")]);});};bg.PasswordBox=function(b4,b5){return bg.InputInternal("input",function(){return bJ.append(b4,[_9.Value(b5),_2.Create("type","password")]);});};bg.Input=function(b4,b5){return bg.InputInternal("input",function(){return bJ.append(b4,[_9.Value(b5)]);});};bg.InputInternal=function(b4,b5){var b6;b6=self.document.createElement(b4);return bh.New(b6,_2.Concat(b5(b6)),bg.get_Empty());};bg.ConvertSeqVarBy=function(b4,b5,b6){return bg.Flatten(A.MapLens(b4,b5,b6));};bg.ConvertSeqBy=function(b4,b5,b6){return bg.Flatten(y.MapSeqCachedViewBy(b4,function(b7,b8){return(b5(b7))(b8);},b6));};bg.ConvertSeq=function(b4,b5){return bg.Flatten(y.MapSeqCachedView(b4,b5));};bg.ConvertBy=function(b4,b5,b6){return bg.Flatten(y.MapSeqCachedBy(b4,b5,b6));};bg.Convert=function(b4,b5){return bg.Flatten(y.MapSeqCached(b4,b5));};bg.Flatten=function(b4){return bg.EmbedView(y.Map(bg.Concat,b4));};bg.TextView=function(b4){var b5;b5=bf.CreateTextNode();return bg.Mk({$:4,$0:b5},y.Map(function(b6){bf.UpdateTextNode(b5,b6);},b4));};bg.RunReplaceById=function(b4,b5){var b6;b6=self.document.getElementById(b4);bM.Equals(b6,null)?bR.FailWith("invalid id: "+b4):b5.ReplaceInDom(b6);};bg.RunById=function(b4,b5){var b6;b6=self.document.getElementById(b4);bM.Equals(b6,null)?bR.FailWith("invalid id: "+b4):bg.Run(b6,b5);};bg.Run=function(b4,b5){bf.LinkElement(b4,b5.docNode);bg.RunInPlace(false,b4,b5);};bg.RunInPlace=function(b4,b5,b6){var b7;b7=bf.CreateRunState(b5,b6.docNode);y.Sink(T.get_UseAnimations()||$.BatchUpdatesEnabled()?n.StartProcessor(bf.PerformAnimatedUpdate(b4,b7,b6.docNode)):function(){bf.PerformSyncUpdate(b4,b7,b6.docNode);},b6.updates);};bg.RunPrependById=function(b4,b5){var b6;b6=self.document.getElementById(b4);bM.Equals(b6,null)?bR.FailWith("invalid id: "+b4):bg.RunPrepend(b6,b5);};bg.RunPrepend=function(b4,b5){var b6;b6=self.document.createTextNode("");b4.insertBefore(b6,b4.firstChild);bg.RunBefore(b6,b5);};bg.RunAppendById=function(b4,b5){var b6;b6=self.document.getElementById(b4);bM.Equals(b6,null)?bR.FailWith("invalid id: "+b4):bg.RunAppend(b6,b5);};bg.RunAppend=function(b4,b5){var b6;b6=self.document.createTextNode("");b4.appendChild(b6);bg.RunBefore(b6,b5);};bg.RunAfterById=function(b4,b5){var b6;b6=self.document.getElementById(b4);bM.Equals(b6,null)?bR.FailWith("invalid id: "+b4):bg.RunAfter(b6,b5);};bg.RunAfter=function(b4,b5){var b6;b6=self.document.createTextNode("");b4.parentNode.insertBefore(b6,b4.nextSibling);bg.RunBetween(b4,b6,b5);};bg.RunBeforeById=function(b4,b5){var b6;b6=self.document.getElementById(b4);bM.Equals(b6,null)?bR.FailWith("invalid id: "+b4):bg.RunBefore(b6,b5);};bg.RunBefore=function(b4,b5){var b6;b6=self.document.createTextNode("");b4.parentNode.insertBefore(b6,b4);bg.RunBetween(b6,b4,b5);};bg.RunBetween=function(b4,b5,b6){var b7;bf.LinkPrevElement(b5,b6.docNode);b7=bf.CreateDelimitedRunState(b4,b5,b6.docNode);y.Sink(T.get_UseAnimations()||$.BatchUpdatesEnabled()?n.StartProcessor(bf.PerformAnimatedUpdate(false,b7,b6.docNode)):function(){bf.PerformSyncUpdate(false,b7,b6.docNode);},b6.updates);};bg.Async=function(b4){return bg.EmbedView(y.MapAsync(a.id,y.Const(b4)));};bg.BindView=function(b4,b5){return bg.EmbedView(y.Map(b4,b5));};bg.EmbedView=function(b4){var b5;b5=bf.CreateEmbedNode();return bg.Mk({$:2,$0:b5},y.Map(a.ignore,y.Bind(function(b6){bf.UpdateEmbedNode(b5,b6.docNode);return b6.updates;},b4)));};bg.Verbatim=function(b4){return bg.Mk(d.MapTreeReduce(function(b5){return bM.Equals(b5.nodeType,bX.TEXT_NODE)?{$:5,$0:b5}:{$:1,$0:bf.CreateElemNode(b5,_6.EmptyAttr(),null)};},null,function(b5,b6){return{$:0,$0:b5,$1:b6};},r.ChildrenArray(r.ParseHTMLIntoFakeRoot(b4))),y.Const());};bg.StaticProxy=function(b4){return bh.New(b4,_6.EmptyAttr(),bg.get_Empty());};bg.TextNode=function(b4){return bg.Mk({$:5,$0:self.document.createTextNode(b4)},y.Const());};bg.get_Empty=function(){return bg.Mk(null,y.Const());};bg.Concat=function(b4){var b5;b5=d.ofSeqNonCopying(b4);return d.TreeReduce(bg.get_Empty(),bg.Append,b5);};bg.Append=function(b4,b5){return bg.Mk({$:0,$0:b4.docNode,$1:b5.docNode},y.Map2Unit(b4.updates,b5.updates));};bg.Mk=function(b4,b5){return new bg.New(b4,b5);};bg.New=bL.Ctor(function(b4,b5){k.New.call(this);this.docNode=b4;this.updates=b5;},bg);bh=c.Elt=bL.Class({SetStyle:function(b4,b5){this.elt.style[b4]=b5;},HasClass:function(b4){return(new a.RegExp("(\\s|^)"+b4+"(\\s|$)")).test(this.elt.className);},GetProperty:function(b4){return this.elt[b4];},SetProperty:function(b4,b5){this.elt[b4]=b5;},RemoveAttribute:function(b4){this.elt.removeAttribute(b4);},HasAttribute:function(b4){return this.elt.hasAttribute(b4);},GetAttribute:function(b4){return this.elt.getAttribute(b4);},SetAttribute:function(b4,b5){this.elt.setAttribute(b4,b5);},SetText:function(b4){var b5;b5=this.docNode$1;b5!=null&&b5.$==1?b5.$0.Children=null:b5!=null&&b5.$==6?(b5.$0.Els=[],this.ClearHoles()):bR.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());this.elt.textContent=b4;},GetText:function(){return this.elt.textContent;},SetValue:function(b4){this.elt.value=b4;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var b4;b4=this.docNode$1;b4!=null&&b4.$==1?b4.$0.Children=null:b4!=null&&b4.$==6?(b4.$0.Els=[],this.ClearHoles()):bR.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(b4){var b5,b6,b7,b8,b9;b5=this.docNode$1;b5!=null&&b5.$==1?(b6=b5.$0,b6.Children={$:0,$0:b4.docNode,$1:b6.Children},bf.InsertDoc(this.elt,b4.docNode,(b7=this.elt.firstChild,bM.Equals(b7,null)?null:b7))):b5!=null&&b5.$==6?(b8=this.elt.insertBefore(self.document.createTextNode(""),this.elt.firstChild),b9=bf.InsertBeforeDelim(b8,b4.docNode),this.AddHole(ba.New(_6.Empty(this.elt),b4.docNode,{$:1,$0:[b9,b8]},this.elt,h.Int(),null))):bR.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,b4.updates));},Append:function(b4){var b5,b6,b7,b8;b5=this.docNode$1;b5!=null&&b5.$==1?(b6=b5.$0,b6.Children={$:0,$0:b6.Children,$1:b4.docNode},bf.InsertDoc(this.elt,b4.docNode,null)):b5!=null&&b5.$==6?(b7=this.elt.appendChild(self.document.createTextNode("")),b8=bf.InsertBeforeDelim(b7,b4.docNode),this.AddHole(ba.New(_6.Empty(this.elt),b4.docNode,{$:1,$0:[b8,b7]},this.elt,h.Int(),null))):bR.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,b4.updates));},ToUpdater:function(){var b4,b5,b6;return new bi.New((b4=this.docNode$1,b4!=null&&b4.$==1?bL.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,b4.$0.Attr]],Render:(b5=null,b5?b5.$0:void 0),El:(b6={$:1,$0:this.elt},b6?b6.$0:void 0)},["Render","El"]):b4!=null&&b4.$==6?b4.$0:bR.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,A.Create$1([]));},OnAfterRenderView:function(b4,b5){var b6,b7;b6=this;b7=h.Id();this.Append(bg.BindView(function(b8){b6.elt[b7]=b8;return bg.get_Empty();},b4));return this["OnAfterRender'"](function(b8){b5(b8,b8[b7]);});},OnAfterRender:function(b4){return this["OnAfterRender'"](b4);},"OnAfterRender'":function(b4){var b5,b6,b7,b8,b9,b_,b$;b5=this.docNode$1;b5!=null&&b5.$==1?(b6=b5.$0,bL.SetOptional(b6,"Render",(b7=bL.GetOptional(b6.Render),b7!=null&&b7.$==1?(b8=b7.$0,{$:1,$0:function(ca){b8(ca);b4(ca);}}):{$:1,$0:b4}))):b5!=null&&b5.$==6?(b9=b5.$0,bL.SetOptional(b9,"Render",(b_=bL.GetOptional(b9.Render),b_!=null&&b_.$==1?(b$=b_.$0,{$:1,$0:function(ca){b$(ca);b4(ca);}}):{$:1,$0:b4}))):bR.FailWith("Invalid docNode in Elt");return this;},onView:function(b4,b5,b6){var b7;b7=b6(this.elt);this.elt.addEventListener(b4,function(b8){return y.Get(b7(b8),b5);},false);return this;},on:function(b4,b5){var b6;b6=this;this.elt.addEventListener(b4,function(b7){return b5(b6.elt,b7);},false);return this;},ClearHoles:function(){var b4;b4=this.docNode$1;b4!=null&&b4.$==6?b4.$0.Holes=[]:void 0;},AddHole:function(b4){var b5;b5=this.docNode$1;b5!=null&&b5.$==6?b5.$0.Holes.push(b4):void 0;}},bg,bh);bh.TreeNode=function(b4,b5){var b6,b7;function b8(b9){return b9[1];}b6=B.Create(b5);return new bh.New$1({$:6,$0:b4},y.Map2Unit((b7=bD.map(function(b9){return _6.Updates(b8(b9));},b4.Attrs),d.TreeReduce(y.Const(),y.Map2Unit,b7)),b6.v),bD.get(b4.Els,0),b6);};bh.New=function(b4,b5,b6){var b7,b8;b7=bf.CreateElemNode(b4,b5,b6.docNode);b8=B.Create(b6.updates);return new bh.New$1({$:1,$0:b7},y.Map2Unit(_6.Updates(b7.Attr),b8.v),b4,b8);};bh.New$1=bL.Ctor(function(b4,b5,b6,b7){bg.New.call(this,b4,b5);this.docNode$1=b4;this.updates$1=b5;this.elt=b6;this.rvUpdates=b7;},bh);bi=_3.EltUpdater=bL.Class({ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];this.holeUpdates.Set([]);},AddHole:function(b4){this.origHoles.push(b4);this.treeNode.Holes=this.treeNode.Holes.concat([b4]);},RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;this.holeUpdates.Set([]);},RemoveUpdated:function(b4){var b5,b6;function b7(b8){return b8!==b6;}b5=b4.docNode;b5!=null&&b5.$==1?(b6=b5.$0.ElKey,this.treeNode.Holes=bD.filter(function(b8){return b8.ElKey!==b6;},this.treeNode.Holes),this.holeUpdates.Set(bD.filter(function(b8){return b7(b8[0]);},this.holeUpdates.Get()))):bR.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(b4){var b5,b6,b7;b5=b4.docNode;b5!=null&&b5.$==1?(b6=b5.$0,this.treeNode.Holes=this.treeNode.Holes.concat([b6]),b7=this.holeUpdates.Get(),b7.push([b6.ElKey,b4.updates]),this.holeUpdates.Set(b7)):bR.FailWith("DocUpdater.AddUpdated expects a single element node");}},bh,bi);bi.New=bL.Ctor(function(b4,b5,b6,b7,b8){var b9,b_,b$,ca;function cb(cc){return cc[1];}bh.New$1.call(this,{$:6,$0:b4},y.Map2Unit(b5,(b9=b8.get_View(),y.BindInner((b_=function(cc){return bD.map(cb,cc);},(b$=(ca=y.Const(),function(cc){return d.TreeReduce(ca,y.Map2Unit,cc);}),function(cc){return b$(b_(cc));})),b9))),b6,b7);this.treeNode=b4;this.holeUpdates=b8;this.origHoles=this.treeNode.Holes;},bi);bj.$cctor=function(){bj.$cctor=a.ignore;bj.BatchUpdatesEnabled=true;};bl.failNotLoaded=function(b4){bN.warn("Instantiating non-loaded template",b4);};bl.fill=function(b4,b5,b6){while(true)if(b4.hasChildNodes())b6=b5.insertBefore(b4.lastChild,b6);else return null;};bl.fillTextHole=function(b4,b5,b6){var b7;b7=b4.querySelector("[ws-replace]");return bM.Equals(b7,null)?(bN.warn("Filling non-existent text hole",b6),null):(b7.parentNode.replaceChild(self.document.createTextNode(b5),b7),{$:1,$0:b7.getAttribute("ws-replace")});};bl.removeHolesExcept=function(b4,b5){function b6(b7){bk.foreachNotPreserved(b4,"["+b7+"]",function(b8){if(!b5.Contains(b8.getAttribute(b7)))b8.removeAttribute(b7);});}b6("ws-attr");b6("ws-onafterrender");b6("ws-var");bk.foreachNotPreserved(b4,"[ws-hole]",function(b7){if(!b5.Contains(b7.getAttribute("ws-hole"))){b7.removeAttribute("ws-hole");while(b7.hasChildNodes())b7.removeChild(b7.lastChild);}});bk.foreachNotPreserved(b4,"[ws-replace]",function(b7){if(!b5.Contains(b7.getAttribute("ws-replace")))b7.parentNode.removeChild(b7);});bk.foreachNotPreserved(b4,"[ws-on]",function(b7){b7.setAttribute("ws-on",bF.concat(" ",bD.filter(function(b8){return b5.Contains(bD.get(bF.SplitChars(b8,[":"],1),1));},bF.SplitChars(b7.getAttribute("ws-on"),[" "],1))));});bk.foreachNotPreserved(b4,"[ws-attr-holes]",function(b7){var b8,b9,b_,b$,ca;b8=bF.SplitChars(b7.getAttribute("ws-attr-holes"),[" "],1);for(b9=0,b_=b8.length-1;b9<=b_;b9++){b$=bD.get(b8,b9);b7.setAttribute(b$,(ca=new a.RegExp(bk.TextHoleRE(),"g"),b7.getAttribute(b$).replace(ca,function(cb,cc){return b5.Contains(cc)?cb:"";})));}});};bl.fillInstanceAttrs=function(b4,b5){var b6,b7,b8,b9,b_;bl.convertAttrs(b5);b6=b5.nodeName.toLowerCase();b7=b4.querySelector("[ws-attr="+b6+"]");if(bM.Equals(b7,null))bN.warn("Filling non-existent attr hole",b6);else{b7.removeAttribute("ws-attr");for(b8=0,b9=b5.attributes.length-1;b8<=b9;b8++){b_=b5.attributes.item(b8);b_.name==="class"&&b7.hasAttribute("class")?b7.setAttribute("class",b7.getAttribute("class")+" "+b_.nodeValue):b7.setAttribute(b_.name,b_.nodeValue);}}};bl.mapHoles=function(b4,b5){function b6(b7){bk.foreachNotPreserved(b4,"["+b7+"]",function(b8){var b9,b_;b9=(b_=null,[b5.TryGetValue(b8.getAttribute(b7).toLowerCase(),{get:function(){return b_;},set:function(b$){b_=b$;}}),b_]);b9[0]?b8.setAttribute(b7,b9[1]):void 0;});}b6("ws-hole");b6("ws-replace");b6("ws-attr");b6("ws-onafterrender");b6("ws-var");bk.foreachNotPreserved(b4,"[ws-on]",function(b7){b7.setAttribute("ws-on",bF.concat(" ",bD.map(function(b8){var b9,b_,b$;b9=bF.SplitChars(b8,[":"],1);b_=(b$=null,[b5.TryGetValue(bD.get(b9,1),{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);return b_[0]?bD.get(b9,0)+":"+b_[1]:b8;},bF.SplitChars(b7.getAttribute("ws-on"),[" "],1))));});bk.foreachNotPreserved(b4,"[ws-attr-holes]",function(b7){var b8,b9,b_;b8=bF.SplitChars(b7.getAttribute("ws-attr-holes"),[" "],1);for(b9=0,b_=b8.length-1;b9<=b_;b9++)(function(){var b$;function ca(cb,cc){var cd;cd=bR.KeyValue(cc);return cb.replace(new a.RegExp("\\${"+cd[0]+"}","ig"),"${"+cd[1]+"}");}b$=bD.get(b8,b9);return b7.setAttribute(b$,(((bL.Curried3(bJ.fold))(ca))(b7.getAttribute(b$)))(b5));}());});};bl.convertTextNode=function(b4){var b5,b6,b7,b8,b9,b_;b5=null;b6=0;b8=b4.textContent;b9=new a.RegExp(bk.TextHoleRE(),"g");while(b5=b9.exec(b8),b5!==null){b4.parentNode.insertBefore(self.document.createTextNode(bY.string(b8,{$:1,$0:b6},{$:1,$0:b9.lastIndex-bD.get(b5,0).length-1})),b4);b6=b9.lastIndex;b_=self.document.createElement("span");b_.setAttribute("ws-replace",bD.get(b5,1).toLowerCase());b4.parentNode.insertBefore(b_,b4);}b9.lastIndex=0;b4.textContent=bY.string(b8,{$:1,$0:b6},null);};bl.convertAttrs=function(b4){var b6,b7,b8,b9,b_,b$,ca,cb;function b5(cc){var cd;cd=b4.getAttribute(cc);cd===null?void 0:b4.setAttribute(cc,cd.toLowerCase());}b6=b4.attributes;b7=[];b8=[];b9=[];for(b_=0,b$=b6.length-1;b_<=b$;b_++){ca=b6.item(b_);bF.StartsWith(ca.nodeName,"ws-on")&&ca.nodeName!=="ws-onafterrender"&&ca.nodeName!=="ws-on"?(b7.push(ca.nodeName),b8.push(bY.string(ca.nodeName,{$:1,$0:"ws-on".length},null)+":"+ca.nodeValue.toLowerCase())):!bF.StartsWith(ca.nodeName,"ws-")&&(new a.RegExp(bk.TextHoleRE())).test(ca.nodeValue)?(ca.nodeValue=(cb=new a.RegExp(bk.TextHoleRE(),"g"),ca.nodeValue.replace(cb,function(cc,cd){return"${"+cd.toLowerCase()+"}";})),b9.push(ca.nodeName)):void 0;}!(b8.length==0)?b4.setAttribute("ws-on",bF.concat(" ",b8)):void 0;!(b9.length==0)?b4.setAttribute("ws-attr-holes",bF.concat(" ",b9)):void 0;b5("ws-hole");b5("ws-replace");b5("ws-attr");b5("ws-onafterrender");b5("ws-var");bD.iter(function(cc){b4.removeAttribute(cc);},b7);};bk.GetOrLoadTemplate=function(b4,b5,b6,b7){bk.LoadLocalTemplates("");bk.PrepareTemplate(b4,b5,b6);return bk.NamedTemplate(b4,b5,b7);};bk.NamedTemplate=function(b4,b5,b6){var b7,b8;b7=(b8=null,[bk.LoadedTemplateFile(b4).TryGetValue(b5==null?"":b5.$0,{get:function(){return b8;},set:function(b9){b8=b9;}}),b8]);return b7[0]?bk.ChildrenTemplate(b7[1].cloneNode(true),b6):(bN.warn("Local template doesn't exist",b5),bg.get_Empty());};bk.RunFullDocTemplate=function(b4){var b5,b6,b7;return bk.RenderedFullDocTemplate()==null?(b5=(bk.LoadLocalTemplates(""),bk.PrepareTemplateStrict("",null,self.document.body,null),b6=bk.ChildrenTemplate(self.document.body,b4),b7=self.document.body,function(b8){bg.RunInPlace(true,b7,b8);}(b6),b6),(bk.set_RenderedFullDocTemplate({$:1,$0:b5}),b5)):bk.RenderedFullDocTemplate().$0;};bk.RenderedFullDocTemplate=function(){bm.$cctor();return bm.RenderedFullDocTemplate;};bk.set_RenderedFullDocTemplate=function(b4){bm.$cctor();bm.RenderedFullDocTemplate=b4;};bk.LoadLocalTemplates=function(b4){!bk.LocalTemplatesLoaded()?(bk.set_LocalTemplatesLoaded(true),bk.LoadNestedTemplates(self.document.body,"")):void 0;bk.LoadedTemplates().set_Item(b4,bk.LoadedTemplateFile(""));};bk.LoadNestedTemplates=function(b4,b5){var b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch;function b6(ci){var cj,ck;if(!b7.ContainsKey(ci)){cj=(ck=null,[b8.TryGetValue(ci,{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);cj[0]?(ch.Add(ci),b8.Remove(ci),bk.PrepareTemplateStrict(b5,{$:1,$0:ci},cj[1],{$:1,$0:b6})):bN.warn(ch.Contains(ci)?"Encountered loop when instantiating "+ci:"Local template does not exist: "+ci);}}b7=bk.LoadedTemplateFile(b5);b8=new bU.New$5();b9=b4.querySelectorAll("[ws-template]");for(b_=0,b$=b9.length-1;b_<=b$;b_++){ca=b9[b_];cb=ca.getAttribute("ws-template").toLowerCase();ca.removeAttribute("ws-template");b8.set_Item(cb,bk.FakeRootSingle(ca));}cc=b4.querySelectorAll("[ws-children-template]");for(cd=0,ce=cc.length-1;cd<=ce;cd++){cf=cc[cd];cg=cf.getAttribute("ws-children-template").toLowerCase();cf.removeAttribute("ws-children-template");b8.set_Item(cg,bk.FakeRoot(cf));}ch=new bI.New$3();while(b8.count>0)b6(bJ.head(b8.get_Keys()));};bk.PrepareTemplate=function(b4,b5,b6){if(!bk.LoadedTemplateFile(b4).ContainsKey(b5==null?"":b5.$0))bk.PrepareTemplateStrict(b4,b5,b6(),null);};bk.PrepareSingleTemplate=function(b4,b5,b6){var b7;b7=bk.FakeRootSingle(b6);return function(b8){bk.PrepareTemplateStrict(b4,b5,b7,b8);};};bk.PrepareTemplateStrict=function(b4,b5,b6,b7){var b8;function b9(cd,ce){var cf,cg,ch,ci,cj,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF;function ck(cG){}while(true)switch(cd){case 0:if(ce!==null){cf=ce.nextSibling;if(bM.Equals(ce.nodeType,bX.TEXT_NODE))bl.convertTextNode(ce);else if(bM.Equals(ce.nodeType,bX.ELEMENT_NODE))b$(ce);ce=cf;}else return null;break;case 1:cl=bY.string(ce.nodeName,{$:1,$0:3},null).toLowerCase();cm=(cg=cl.indexOf("."),cg===-1?[b4,cl]:[bY.string(cl,null,{$:1,$0:cg-1}),bY.string(cl,{$:1,$0:cg+1},null)]);cn=cm[1];co=cm[0];if(co!==""&&!bk.LoadedTemplates().ContainsKey(co))return bl.failNotLoaded(cn);else{if(co===""&&b7!=null)b7.$0(cn);cp=bk.LoadedTemplates().get_Item(co);if(!cp.ContainsKey(cn))return bl.failNotLoaded(cn);else{cq=cp.get_Item(cn);cr=cq.cloneNode(true);cs=new bI.New$3();ct=new bU.New$5();cu=ce.attributes;for(cv=0,cw=cu.length-1;cv<=cw;cv++){cx=cu.item(cv).name.toLowerCase();ct.set_Item(cx,(cy=cu.item(cv).nodeValue,cy===""?cx:cy.toLowerCase()));!cs.Add(cx)?bN.warn("Hole mapped twice",cx):void 0;}for(cz=0,cA=ce.childNodes.length-1;cz<=cA;cz++){cB=ce.childNodes[cz];bM.Equals(cB.nodeType,bX.ELEMENT_NODE)?!cs.Add(cB.nodeName.toLowerCase())?bN.warn("Hole filled twice",cn):void 0:void 0;}cC=ce.childNodes.length===1&&bM.Equals(ce.firstChild.nodeType,bX.TEXT_NODE);if(cC){ci=bl.fillTextHole(cr,ce.firstChild.textContent,cn);((function(cG){return function(cH){if(cH!=null)cG(cH.$0);};}((cj=function(cG){return function(cH){return cG.Add(cH);};}(cs),function(cG){return ck(cj(cG));})))(ci));}bl.removeHolesExcept(cr,cs);if(!cC){for(cD=0,cE=ce.childNodes.length-1;cD<=cE;cD++){cF=ce.childNodes[cD];bM.Equals(cF.nodeType,bX.ELEMENT_NODE)?cF.hasAttributes()?bl.fillInstanceAttrs(cr,cF):b_(cr,cF):void 0;}}bl.mapHoles(cr,ct);bl.fill(cr,ce.parentNode,ce);ce.parentNode.removeChild(ce);return;}}break;}}function b_(cd,ce){var cf,ch,ci;function cg(cj,ck){var cl;if(ch==="title"&&ce.hasChildNodes()){cl=r.ParseHTMLIntoFakeRoot(ce.textContent);ce.removeChild(ce.firstChild);while(cl.hasChildNodes())ce.appendChild(cl.firstChild);}else null;b$(ce);return bl.fill(ce,cj,ck);}ch=ce.nodeName.toLowerCase();bk.foreachNotPreserved(cd,"[ws-attr-holes]",function(cj){var ck,cl,cm,cn,co;ck=bF.SplitChars(cj.getAttribute("ws-attr-holes"),[" "],1);for(cl=0,cm=ck.length-1;cl<=cm;cl++){cn=bD.get(ck,cl);cj.setAttribute(cn,(co=new a.RegExp("\\${"+ch+"}","ig"),cj.getAttribute(cn).replace(co,ce.textContent)));}});ci=cd.querySelector("[ws-hole="+ch+"]");if(bM.Equals(ci,null)){cf=cd.querySelector("[ws-replace="+ch+"]");return bM.Equals(cf,null)?null:(cg(cf.parentNode,cf),void cf.parentNode.removeChild(cf));}else{while(ci.hasChildNodes())ci.removeChild(ci.lastChild);ci.removeAttribute("ws-hole");return cg(ci,null);}}function b$(cd){if(!cd.hasAttribute("ws-preserve"))if(bF.StartsWith(cd.nodeName.toLowerCase(),"ws-"))cb(cd);else{bl.convertAttrs(cd);ca(cd.firstChild);}}function ca(cd){return b9(0,cd);}function cb(cd){return b9(1,cd);}function cc(cd){var ce,cf,cg,ch;while(true){ce=cd.querySelector("[ws-template]");if(bM.Equals(ce,null)){cf=cd.querySelector("[ws-children-template]");if(bM.Equals(cf,null))return null;else{cg=cf.getAttribute("ws-children-template");cf.removeAttribute("ws-children-template");bk.PrepareTemplateStrict(b4,{$:1,$0:cg},cf,null);cd=cd;}}else{ch=ce.getAttribute("ws-template");(bk.PrepareSingleTemplate(b4,{$:1,$0:ch},ce))(null);cd=cd;}}}b8=(b5==null?"":b5.$0).toLowerCase();bk.LoadedTemplateFile(b4).set_Item(b8,b6);b6.hasChildNodes()?(cc(b6),ca(b6.firstChild)):void 0;};bk.FakeRootSingle=function(b4){var b5,b6,b7,b8;b4.removeAttribute("ws-template");b5=b4.getAttribute("ws-replace");b5===null?void 0:(b4.removeAttribute("ws-replace"),b6=b4.parentNode,bM.Equals(b6,null)?void 0:(b7=self.document.createElement(b4.tagName),b7.setAttribute("ws-replace",b5),b6.replaceChild(b7,b4)));b8=self.document.createElement("div");b8.appendChild(b4);return b8;};bk.FakeRoot=function(b4){var b5;b5=self.document.createElement("div");while(b4.hasChildNodes())b5.appendChild(b4.firstChild);return b5;};bk.ChildrenTemplate=function(b4,b5){var b6,b7,b8,b9,b_;b6=bk.InlineTemplate(b4,bJ.append(b5,bk.GlobalHoles().get_Values()));b7=b6[1];b8=b6[0];b9=b8.Els;return!bM.Equals(b9,null)&&b9.length===1&&(bD.get(b9,0)instanceof bX&&(bM.Equals(bD.get(b9,0).nodeType,bX.ELEMENT_NODE)&&(b_=bD.get(b9,0),true)))?bh.TreeNode(b8,b7):bg.Mk({$:6,$0:b8},b7);};bk.InlineTemplate=function(b4,b5){var b6,b7,b8,b9,ca,cb,cc,cd,ce,cf,cg;function b_(ch,ci){var cj,ck,cl;cj=_6.Insert(ch,ci);cb.push(_6.Updates(cj));cc.push([ch,cj]);ck=bL.GetOptional(cj.OnAfterRender);return ck==null?null:(cl=ck.$0,void cd.push(function(){cl(ch);}));}function b$(ch){var ci,cj;ci=(cj=null,[ce.TryGetValue(ch,{get:function(){return cj;},set:function(ck){cj=ck;}}),cj]);return ci[0]?ci[1].$==0?{$:1,$0:ci[1].$1}:ci[1].$==1?{$:1,$0:bg.TextNode(ci[1].$1)}:ci[1].$==2?{$:1,$0:bg.TextView(ci[1].$1)}:ci[1].$==8?{$:1,$0:bg.TextView(ci[1].$1.get_View())}:ci[1].$==9?{$:1,$0:bg.TextView(y.Map(a.String,ci[1].$1.get_View()))}:ci[1].$==10?{$:1,$0:bg.TextView(y.Map(function(ck){return ck.get_Input();},ci[1].$1.get_View()))}:ci[1].$==11?{$:1,$0:bg.TextView(y.Map(a.String,ci[1].$1.get_View()))}:ci[1].$==12?{$:1,$0:bg.TextView(y.Map(function(ck){return ck.get_Input();},ci[1].$1.get_View()))}:ci[1].$==13?{$:1,$0:bg.TextView(y.Map(a.String,ci[1].$1.get_View()))}:(bN.warn("Content hole filled with attribute data",ch),null):null;}ca=[];cb=[];cc=[];cd=[];ce=new bU.New$5();cf=bE.Get(b5);try{while(cf.MoveNext()){cg=cf.Current();ce.set_Item(cg.$0,cg);}}finally{if(typeof cf=="object"&&"Dispose"in cf)cf.Dispose();}b6=r.ChildrenArray(b4);bk.foreachNotPreserved(b4,"[ws-hole]",function(ch){var ci,cj,ck;ck=ch.getAttribute("ws-hole");ch.removeAttribute("ws-hole");while(ch.hasChildNodes())ch.removeChild(ch.lastChild);ci=b$(ck);ci!=null&&ci.$==1?(cj=ci.$0,bf.LinkElement(ch,cj.docNode),ca.push(ba.New(_6.Empty(ch),cj.docNode,null,ch,h.Int(),null)),cb.push(cj.updates)):void 0;});bk.foreachNotPreserved(b4,"[ws-replace]",function(ch){var ci,cj,ck,cl,cm,cn;ci=b$(ch.getAttribute("ws-replace"));ci!=null&&ci.$==1?(cj=ci.$0,ck=ch.parentNode,cl=self.document.createTextNode(""),ck.replaceChild(cl,ch),cm=bf.InsertBeforeDelim(cl,cj.docNode),cn=bD.tryFindIndex(function(co){return ch===co;},b6),cn==null?void 0:bD.set(b6,cn.$0,cj.docNode),ca.push(ba.New(_6.Empty(ck),cj.docNode,{$:1,$0:[cm,cl]},ck,h.Int(),null)),cb.push(cj.updates)):void 0;});bk.foreachNotPreserved(b4,"[ws-attr]",function(ch){var ci,cj,ck;ci=ch.getAttribute("ws-attr");ch.removeAttribute("ws-attr");cj=(ck=null,[ce.TryGetValue(ci,{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);cj[0]?cj[1].$==3?b_(ch,cj[1].$1):bN.warn("Attribute hole filled with non-attribute data",ci):void 0;});bk.foreachNotPreserved(b4,"[ws-on]",function(ch){b_(ch,_2.Concat(bD.choose(function(ci){var cj,ck,cl;cj=bF.SplitChars(ci,[":"],1);ck=(cl=null,[ce.TryGetValue(bD.get(cj,1),{get:function(){return cl;},set:function(cm){cl=cm;}}),cl]);return ck[0]?ck[1].$==4?{$:1,$0:_9.Handler(bD.get(cj,0),ck[1].$1)}:ck[1].$==5?{$:1,$0:_2.Handler(bD.get(cj,0),ck[1].$1)}:(bN.warn("Event hole on"+bD.get(cj,0)+" filled with non-event data",bD.get(cj,1)),null):null;},bF.SplitChars(ch.getAttribute("ws-on"),[" "],1))));ch.removeAttribute("ws-on");});bk.foreachNotPreserved(b4,"[ws-onafterrender]",function(ch){var ci,cj,ck;ci=ch.getAttribute("ws-onafterrender");cj=(ck=null,[ce.TryGetValue(ci,{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);cj[0]?cj[1].$==6?(ch.removeAttribute("ws-onafterrender"),b_(ch,_9.OnAfterRender(cj[1].$1))):cj[1].$==7?(ch.removeAttribute("ws-onafterrender"),b_(ch,_9.OnAfterRender(cj[1].$1))):bN.warn("onafterrender hole filled with non-onafterrender data",ci):void 0;});bk.foreachNotPreserved(b4,"[ws-var]",function(ch){var ci,cj,ck;ci=ch.getAttribute("ws-var");ch.removeAttribute("ws-var");cj=(ck=null,[ce.TryGetValue(ci,{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);cj[0]?cj[1].$==8?b_(ch,_9.Value(cj[1].$1)):cj[1].$==9?b_(ch,_9.Checked(cj[1].$1)):cj[1].$==10?b_(ch,_9.IntValue(cj[1].$1)):cj[1].$==11?b_(ch,_9.IntValueUnchecked(cj[1].$1)):cj[1].$==12?b_(ch,_9.FloatValue(cj[1].$1)):cj[1].$==13?b_(ch,_9.FloatValueUnchecked(cj[1].$1)):bN.warn("Var hole filled with non-Var data",ci):void 0;});bk.foreachNotPreserved(b4,"[ws-attr-holes]",function(ch){var ci,cj,ck,cl;ci=new a.RegExp(bk.TextHoleRE(),"g");cj=bF.SplitChars(ch.getAttribute("ws-attr-holes"),[" "],1);ch.removeAttribute("ws-attr-holes");for(ck=0,cl=cj.length-1;ck<=cl;ck++)(function(){var cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy;cv=bD.get(cj,ck);cw=ch.getAttribute(cv);cm=null;cn=0;cx=[];while(cm=ci.exec(cw),cm!==null){cy=bY.string(cw,{$:1,$0:cn},{$:1,$0:ci.lastIndex-bD.get(cm,0).length-1});cn=ci.lastIndex;cx.push([cy,bD.get(cm,1)]);}cp=bY.string(cw,{$:1,$0:cn},null);ci.lastIndex=0;cq=bD.foldBack(function(cz,cA){return(function(cB){var cC,cD;cC=cB[0];cD=cB[1];return function(cE){var cF,cG,cH,cI,cJ;cF=cE[0];cG=cE[1];cH=(cI=(cJ=null,[ce.TryGetValue(cD,{get:function(){return cJ;},set:function(cK){cJ=cK;}}),cJ]),cI[0]?cI[1].$==1?{$:0,$0:cI[1].$1}:cI[1].$==2?{$:1,$0:cI[1].$1}:cI[1].$==8?{$:1,$0:cI[1].$1.get_View()}:cI[1].$==9?{$:1,$0:y.Map(a.String,cI[1].$1.get_View())}:cI[1].$==10?{$:1,$0:y.Map(function(cK){return cK.get_Input();},cI[1].$1.get_View())}:cI[1].$==11?{$:1,$0:y.Map(a.String,cI[1].$1.get_View())}:cI[1].$==12?{$:1,$0:y.Map(function(cK){return cK.get_Input();},cI[1].$1.get_View())}:cI[1].$==13?{$:1,$0:y.Map(a.String,cI[1].$1.get_View())}:(bN.warn("Attribute value hole filled with non-text data",cD),{$:0,$0:""}):{$:0,$0:""});return cH.$==1?[cC,new bC.T({$:1,$0:cF===""?cH.$0:y.Map(function(cK){return cK+cF;},cH.$0),$1:cG})]:[cC+cH.$0+cF,cG];};}(cz))(cA);},cx,[cp,bC.T.Empty]);return b_(ch,cq[1].$==1?cq[1].$1.$==1?cq[1].$1.$1.$==1?cq[1].$1.$1.$1.$==0?(cr=cq[0],_9.Dynamic(cv,y.Map3(function(cz,cA,cB){return cr+cz+cA+cB;},cq[1].$0,cq[1].$1.$0,cq[1].$1.$1.$0))):(cs=cq[0],_9.Dynamic(cv,y.Map(function(cz){return cs+bF.concat("",cz);},y.Sequence(cq[1])))):(ct=cq[0],_9.Dynamic(cv,y.Map2(function(cz,cA){return ct+cz+cA;},cq[1].$0,cq[1].$1.$0))):cq[0]===""?_9.Dynamic(cv,cq[1].$0):(cu=cq[0],_9.Dynamic(cv,y.Map(function(cz){return cu+cz;},cq[1].$0))):_2.Create(cv,cq[0]));}());});return[bL.DeleteEmptyFields({Els:b6,Dirty:true,Holes:ca,Attrs:cc,Render:(b7=cd.length==0?null:{$:1,$0:function(ch){bD.iter(function(ci){ci(ch);},cd);}},b7?b7.$0:void 0),El:(b8=!bM.Equals(b6,null)&&b6.length===1&&(bD.get(b6,0)instanceof bX&&(bD.get(b6,0)instanceof a.Element&&(b9=bD.get(b6,0),true)))?{$:1,$0:b9}:null,b8?b8.$0:void 0)},["Render","El"]),d.TreeReduce(y.Const(),y.Map2Unit,cb)];};bk.foreachNotPreserved=function(b4,b5,b6){r.IterSelector(b4,b5,function(b7){if(b7.closest("[ws-preserve]")==null)b6(b7);});};bk.TextHoleRE=function(){bm.$cctor();return bm.TextHoleRE;};bk.GlobalHoles=function(){bm.$cctor();return bm.GlobalHoles;};bk.set_GlobalHoles=function(b4){bm.$cctor();bm.GlobalHoles=b4;};bk.LocalTemplatesLoaded=function(){bm.$cctor();return bm.LocalTemplatesLoaded;};bk.set_LocalTemplatesLoaded=function(b4){bm.$cctor();bm.LocalTemplatesLoaded=b4;};bk.LoadedTemplateFile=function(b4){var b5,b6,b7;b5=(b6=null,[bk.LoadedTemplates().TryGetValue(b4,{get:function(){return b6;},set:function(b8){b6=b8;}}),b6]);return b5[0]?b5[1]:(b7=new bU.New$5(),(bk.LoadedTemplates().set_Item(b4,b7),b7));};bk.LoadedTemplates=function(){bm.$cctor();return bm.LoadedTemplates;};bm.$cctor=function(){bm.$cctor=a.ignore;bm.LoadedTemplates=new bU.New$5();bm.LocalTemplatesLoaded=false;bm.GlobalHoles=new bU.New$5();bm.TextHoleRE="\\${([^}]+)}";bm.RenderedFullDocTemplate=null;};bn=c.Flow=bL.Class({get_Render:function(){return this.render;}},k,bn);bn.New=bL.Ctor(function(b4){bn.New$1.call(this,function(b5){return function(b6){return A.Set(b5,b4(b6));};});},bn);bn.New$1=bL.Ctor(function(b4){k.New.call(this);this.render=b4;},bn);bn.get_Do=function(){return new bo.New();};bn.Static=function(b4){return new bn.New$1(function(b5){return function(b6){A.Set(b5,b4);return b6();};});};bn.Define=function(b4){return new bn.New(function(b5){return b4(function(b6){b5(b6);});});};bn.Embed=function(b4){var b5;b5=A.Create$1(bg.get_Empty());((b4.get_Render())(b5))(a.ignore);return bg.EmbedView(b5.get_View());};bn.Return=function(b4){return new bn.New$1(function(){return function(b5){return b5(b4);};});};bn.Bind=function(b4,b5){return new bn.New$1(function(b6){return function(b7){return((b4.get_Render())(b6))(function(b8){((b5(b8).get_Render())(b6))(b7);});};});};bn.Map=function(b4,b5){return new bn.New$1(function(b6){return function(b7){return((b5.get_Render())(b6))(function(b8){b7(b4(b8));});};});};bo=c.FlowBuilder=bL.Class({ReturnFrom:a.id,Return:function(b4){return bn.Return(b4);},Bind:function(b4,b5){return bn.Bind(b4,b5);}},k,bo);bo.New=bL.Ctor(function(){k.New.call(this);},bo);bq=bp.attr=bL.Class({},k,bq);bq.New=bL.Ctor(function(){k.New.call(this);},bq);br.InstallHash=function(b4,b5){var b6;b6=A.Create$1(void 0);br.InstallHashInto(b6,b4,b5);return b6;};br.InstallHashInto=function(b4,b5,b6){function b7(b_){return b0.Parse(b6,b1.FromHash(b_,{$:1,$0:true}));}function b8(){return br.getCurrentHash(b7,b5);}function b9(b_){if(!bM.Equals(b4.Get(),b_))b4.Set(b_);}b9(b8());self.addEventListener("popstate",function(){return b9(b8());},false);self.addEventListener("hashchange",function(){return b9(b8());},false);self.document.body.addEventListener("click",function(b_){var b$,ca,cb;b$=(ca=br.findLinkHref(b_.target),ca==null?null:(cb=ca.$0,bF.StartsWith(cb,"#")?b7(cb):null));return b$==null?null:(b9(b$.$0),b_.preventDefault());},false);y.Sink(function(b_){var b$;if(!bM.Equals(b_,b8())){b$=b0.HashLink(b6,b_);self.history.pushState(null,null,b$);}},b4.get_View());};br.getCurrentHash=function(b4,b5){var b6,b7;b6=self.location.hash;b7=b4(b6);return b7==null?((function(b8){return function(b9){return b8("Failed to parse route: "+b2.toSafe(b9));};}(function(b8){bN.log(b8);}))(b6),b5):b7.$0;};br.Install=function(b4,b5){var b6;b6=A.Create$1(void 0);br.InstallInto(b6,b4,b5);return b6;};br.InstallInto=function(b4,b5,b6){function b7(b_){return b0.Parse(b6,b_);}function b8(){return br.getCurrent(b7,b5);}function b9(b_){if(!bM.Equals(b4.Get(),b_))b4.Set(b_);}b9(b8());self.addEventListener("popstate",function(){return b9(b8());},false);self.document.body.addEventListener("click",function(b_){var b$,ca,cb;b$=(ca=(cb=br.findLinkHref(b_.target),cb==null?null:br.hrefToAbsolute(cb.$0)),ca==null?null:b7(b1.FromUrl(ca.$0,null)));return b$==null?null:(b9(b$.$0),b_.preventDefault());},false);y.Sink(function(b_){var b$;if(!bM.Equals(b_,b8())){b$=b0.Link(b6,b_);self.history.pushState(null,null,b$);}},b4.get_View());};br.findLinkHref=function(b4){while(true)if(b4.tagName==="A")return b3.ofObj(b4.getAttribute("href"));else if(b4===self.document.body)return null;else b4=b4.parentNode;};br.hrefToAbsolute=function(b4){var b5;return bF.StartsWith(b4,"?")?{$:1,$0:br.trimFragment(self.location.pathname+b4)}:bF.StartsWith(b4,"#")?null:bF.StartsWith(b4,"/")?{$:1,$0:br.trimFragment(b4)}:(new a.RegExp("^[a-zA-Z0-9]:")).test(b4)?null:(b5=self.location.pathname,{$:1,$0:br.trimFragment(bY.string(b5,null,{$:1,$0:b5.lastIndexOf("/")})+b4)});};br.trimFragment=function(b4){var b5;b5=b4.indexOf("#");return b5===-1?b4:bY.string(b4,null,{$:1,$0:b5-1});};br.getCurrent=function(b4,b5){var b6,b7,b8;b6=self.location;b7=b1.FromUrl(b6.pathname+b6.search,null);b8=b4(b7);return b8==null?((function(b9){return function(b_){return b9("Failed to parse route: "+b2.toSafe(b_));};}(function(b9){bN.log(b9);}))(b7.ToLink()),b5):b8.$0;};bs.Append=function(b4,b5){return{$:0,$0:p.Append(b4.$0,b5.$0),$1:bP.FoldBack(function(b6,b7,b8){return b8.Add(b6,b7);},b4.$1,b5.$1)};};bs.FromList=function(b4,b5){return{$:0,$0:p.FromArray(bD.ofList(b4)),$1:b5};};bs.ToList=function(b4){return[bC.ofArray(p.ToArray(b4.$0)),b4.$1];};bs.SameHash=function(b4,b5){return bs.NoHash(b4)===bs.NoHash(b5);};bs.MakeHash=function(b4){var b5,b6;b5=b4.$1;b6=bF.concat("/",bD.map(function(b7){return a.encodeURIComponent(b7);},p.ToArray(b4.$0)));return b5.get_IsEmpty()?b6:b6+"?"+bF.concat("&",bJ.map(function(b7){var b8;b8=bR.KeyValue(b7);return a.encodeURIComponent(b8[0])+"="+a.encodeURIComponent(b8[1]);},b5));};bs.ParseHash=function(b4){var b5,b6,b7,b8;b5=bs.NoHash(b4);b6=(b7=b5.indexOf("?"),b7===-1?[b5,""]:[bY.string(b5,null,{$:1,$0:b7-1}),bY.string(b5,{$:1,$0:b7+1},null)]);b8=b6[0];return{$:0,$0:p.FromArray(b8===""?[]:bD.map(function(b9){return a.decodeURIComponent(b9);},bF.SplitChars(b8,["/"],0))),$1:bP.OfArray(bD.map(function(b9){var b_;b_=b9.indexOf("=");return b_===-1?[a.decodeURIComponent(b9),""]:[a.decodeURIComponent(bY.string(b9,null,{$:1,$0:b_-1})),a.decodeURIComponent(bY.string(b9,{$:1,$0:b_+1},null))];},bF.SplitChars(b6[1],["&"],0)))};};bs.NoHash=function(b4){return bF.StartsWith(b4,"#")?b4.substring(1):b4;};bt.DoLink=function(b4,b5){var b6;b6=b4.Ser(b5);return bs.FromList(b6[0],b6[1]);};bt.DoRoute=function(b4,b5){return b4.Des(bs.ToList(b5));};bt.InstallMap=function(b4){var b5;function b6(b_,b$){return bM.Equals(b4.Ser(b_),b4.Ser(b$));}function b7(){return b4.Des(bs.ToList(bs.ParseHash(self.location.hash)));}function b8(b_){if(!b6(b5.Get(),b_))b5.Set(b_);}function b9(b_){return b8(b7());}b5=A.Create$1(b7());self.onpopstate=b9;self.onhashchange=b9;y.Sink(function(b_){var b$,ca;b$=bs.MakeHash((ca=b4.Ser(b_),bs.FromList(ca[0],ca[1])));!bs.SameHash(self.location.hash,b$)?self.location.replace("#"+b$):void 0;},b5.get_View());return b5;};bu.Install=function(b4){return bt.InstallMap(b4);};bu.Create=function(b4,b5){function b6(b7){return b7[0];}return{Des:function(b7){return b5(b6(b7));},Ser:function(b7){return[b4(b7),new bQ.New([])];}};};bu.CreateWithQuery=function(b4,b5){return{Des:b5,Ser:b4};};bw.New=function(b4,b5){return{Active:b4,PosV:b5};};bx.New=function(b4,b5,b6,b7){return{Active:b4,Left:b5,Middle:b6,Right:b7};};by.get_MousePressed=function(){bv.ActivateButtonListener();return y.Apply(y.Apply(y.Apply(y.Const(bL.Curried3(function(b4,b5,b6){return b4||b5||b6;})),bv.MouseBtnSt$1().Left.get_View()),bv.MouseBtnSt$1().Middle.get_View()),bv.MouseBtnSt$1().Right.get_View());};by.get_RightPressed=function(){bv.ActivateButtonListener();return bv.MouseBtnSt$1().Right.get_View();};by.get_MiddlePressed=function(){bv.ActivateButtonListener();return bv.MouseBtnSt$1().Middle.get_View();};by.get_LeftPressed=function(){bv.ActivateButtonListener();return bv.MouseBtnSt$1().Left.get_View();};by.get_Position=function(){!bv.MousePosSt$1().Active?(self.document.addEventListener("mousemove",function(b4){return A.Set(bv.MousePosSt$1().PosV,[b4.clientX,b4.clientY]);}),bv.MousePosSt$1().Active=true):void 0;return bv.MousePosSt$1().PosV.get_View();};bz.New=function(b4,b5,b6){return{KeysPressed:b4,KeyListenerActive:b5,LastPressed:b6};};bA.IsPressed=function(b4){function b5(b6){return b6===b4;}bv.ActivateKeyListener();return y.Map(function(b6){return bC.exists(b5,b6);},bv.KeyListenerState().KeysPressed.get_View());};bA.get_LastPressed=function(){bv.ActivateKeyListener();return bv.KeyListenerState().LastPressed.get_View();};bA.get_KeysPressed=function(){bv.ActivateKeyListener();return bv.KeyListenerState().KeysPressed.get_View();};bv.ActivateKeyListener=function(){bB.$cctor();return bB.ActivateKeyListener;};bv.KeyListenerState=function(){bB.$cctor();return bB.KeyListenerState;};bv.ActivateButtonListener=function(){bB.$cctor();return bB.ActivateButtonListener;};bv.MouseBtnSt$1=function(){bB.$cctor();return bB.MouseBtnSt;};bv.MousePosSt$1=function(){bB.$cctor();return bB.MousePosSt;};bB.$cctor=function(){bB.$cctor=a.ignore;function b4(b5,b6){var b7;b7=b5.button;return b7===0?A.Set(bv.MouseBtnSt$1().Left,b6):b7===1?A.Set(bv.MouseBtnSt$1().Middle,b6):b7===2?A.Set(bv.MouseBtnSt$1().Right,b6):null;}bB.MousePosSt=bw.New(false,A.Create$1([0,0]));bB.MouseBtnSt=bx.New(false,A.Create$1(false),A.Create$1(false),A.Create$1(false));bB.ActivateButtonListener=!bv.MouseBtnSt$1().Active?(bv.MouseBtnSt$1().Active=true,self.document.addEventListener("mousedown",function(b5){return b4(b5,true);}),self.document.addEventListener("mouseup",function(b5){return b4(b5,false);})):null;bB.KeyListenerState=bz.New(A.Create$1(bC.T.Empty),false,A.Create$1(-1));bB.ActivateKeyListener=!bv.KeyListenerState().KeyListenerActive?(bv.KeyListenerState().KeyListenerActive=true,self.document.addEventListener("keydown",function(b5){var b6,b7,b8;b6=b5.which;b7=b6===null?b5.keyCode:b6;A.Set(bv.KeyListenerState().LastPressed,b7);b8=bv.KeyListenerState().KeysPressed.Get();return!bC.exists(function(b9){return b9===b7;},b8)?bv.KeyListenerState().KeysPressed.Set(bC.append(b8,bC.ofArray([b7]))):null;}),self.document.addEventListener("keyup",function(b5){var b6,b7;function b8(b9){return b9!==b7;}b6=b5.which;b7=b6===null?b5.keyCode:b6;return A.Update(bv.KeyListenerState().KeysPressed,function(b9){return bC.filter(b8,b9);});})):null;};}());
