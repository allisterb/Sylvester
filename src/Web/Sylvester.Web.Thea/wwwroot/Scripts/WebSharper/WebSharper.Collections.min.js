(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;a=self;b=a.WebSharper=a.WebSharper||{};c=b.Collections=b.Collections||{};d=c.BalancedTree=c.BalancedTree||{};e=d.Tree=d.Tree||{};f=c.Pair=c.Pair||{};g=c.MapUtil=c.MapUtil||{};h=b&&b.Obj;i=c.FSharpMap=c.FSharpMap||{};j=c.Map=c.Map||{};k=c.FSharpSet=c.FSharpSet||{};l=c.Set=c.Set||{};m=c.ListEnumerator=c.ListEnumerator||{};n=c.List=c.List||{};o=c.LinkedListEnumerator=c.LinkedListEnumerator||{};p=c.LinkedList=c.LinkedList||{};q=b.Grouping=b.Grouping||{};r=b.FsComparer=b.FsComparer||{};s=b.ProjectionComparer=b.ProjectionComparer||{};t=b.CompoundComparer=b.CompoundComparer||{};u=b.ReverseComparer=b.ReverseComparer||{};v=b.OrderedEnumerable=b.OrderedEnumerable||{};w=b.Linq=b.Linq||{};x=b.Query=b.Query||{};y=b&&b.Arrays;z=b&&b.Seq;A=b&&b.Unchecked;B=b&&b.List;C=a.IntelliFactory;D=C&&C.Runtime;E=b&&b.Enumerator;F=b&&b.Operators;G=c&&c.HashSet;H=c&&c.Dictionary;I=b&&b.Nullable;J=b&&b.Option;e.New=function(K,L,M,N,O){return{Node:K,Left:L,Right:M,Height:N,Count:O};};d.TryFind=function(K,L){var M;M=(d.Lookup(K,L))[0];return M==null?null:{$:1,$0:M.Node};};d.Contains=function(K,L){return!((d.Lookup(K,L))[0]==null);};d.Add=function(K,L){return d.Put(function(M,N){return N;},K,L);};d.Remove=function(K,L){var M,N,O,P;M=d.Lookup(K,L);N=M[0];O=M[1];return N==null?L:N.Right==null?d.Rebuild(O,N.Left):N.Left==null?d.Rebuild(O,N.Right):d.Rebuild(O,(P=y.ofSeq(z.append(d.Enumerate(false,N.Left),d.Enumerate(false,N.Right))),d.Build(P,0,P.length-1)));};d.Put=function(K,L,M){var N,O;N=d.Lookup(L,M);O=N[0];return O==null?d.Rebuild(N[1],d.Branch(L,null,null)):d.Rebuild(N[1],d.Branch(K(O.Node,L),O.Left,O.Right));};d.Rebuild=function(K,L){var M,O,P,Q,R,S,T,U,V,W;function N(X){return X==null?0:X.Height;}M=L;for(O=0,P=y.length(K)-1;O<=P;O++){M=(Q=y.get(K,O),Q[0]?(R=Q[1],(S=Q[2],N(M)>N(S)+1?N(M.Left)===N(M.Right)+1?(T=M.Left,d.Branch(T.Node,d.Branch(R,S,T.Left),d.Branch(M.Node,T.Right,M.Right))):d.Branch(M.Node,d.Branch(R,S,M.Left),M.Right):d.Branch(R,S,M))):(U=Q[1],(V=Q[2],N(M)>N(V)+1?N(M.Right)===N(M.Left)+1?(W=M.Right,d.Branch(W.Node,d.Branch(M.Node,M.Left,W.Left),d.Branch(U,W.Right,V))):d.Branch(M.Node,M.Left,d.Branch(U,M.Right,V)):d.Branch(U,M,V))));}return M;};d.Lookup=function(K,L){var M,N,O,P;M=[];N=L;O=true;while(O)if(N==null)O=false;else{P=A.Compare(K,N.Node);P===0?O=false:P===1?(M.unshift([true,N.Node,N.Left]),N=N.Right):(M.unshift([false,N.Node,N.Right]),N=N.Left);}return[N,M];};d.OfSeq=function(K){var L;L=y.ofSeq(z.distinct(K));y.sortInPlace(L);return d.Build(L,0,L.length-1);};d.Build=function(K,L,M){var N,O,P;return M-L+1<=0?null:(N=(L+M)/2>>0,(O=d.Build(K,L,N-1),(P=d.Build(K,N+1,M),d.Branch(y.get(K,N),O,P))));};d.Enumerate=function(K,L){function M(N,O){var P;while(true)if(N==null)return O.$==1?{$:1,$0:[O.$0[0],[O.$0[1],O.$1]]}:null;else if(K){P=N;N=P.Right;O=new B.T({$:1,$0:[P.Node,P.Left],$1:O});}else{P=N;N=P.Left;O=new B.T({$:1,$0:[P.Node,P.Right],$1:O});}}return z.unfold(function(N){return M(N[0],N[1]);},[L,B.T.Empty]);};d.Branch=function(K,L,M){var N,O;return e.New(K,L,M,1+(N=L==null?0:L.Height,(O=M==null?0:M.Height,A.Compare(N,O)===1?N:O)),1+(L==null?0:L.Count)+(M==null?0:M.Count));};f=c.Pair=D.Class({Equals:function(K){return A.Equals(this.Key,K.Key);},GetHashCode:function(){return A.Hash(this.Key);},CompareTo0:function(K){return A.Compare(this.Key,K.Key);}},null,f);f.New=function(K,L){return new f({Key:K,Value:L});};g.fromSeq=function(K){var L;L=y.ofSeq(z.map(function(M){return f.New(M[0],M[1]);},z.distinctBy(function(M){return M[0];},z.rev(K))));y.sortInPlace(L);return d.Build(L,0,L.length-1);};i=c.FSharpMap=D.Class({Equals:function(K){return this.get_Count()===K.get_Count()&&z.forall2(A.Equals,this,K);},GetHashCode:function(){return A.Hash(y.ofSeq(this));},GetEnumerator$1:function(){return E.Get(z.map(function(K){return{K:K.Key,V:K.Value};},d.Enumerate(false,this.tree)));},TryFind:function(K){var L;L=d.TryFind(f.New(K,void 0),this.tree);return L==null?null:{$:1,$0:L.$0.Value};},Remove:function(K){return new i.New$1(d.Remove(f.New(K,void 0),this.tree));},get_Item:function(K){var L;L=this.TryFind(K);return L==null?F.FailWith("The given key was not present in the dictionary."):L.$0;},get_IsEmpty:function(){return this.tree==null;},get_Count:function(){var K;K=this.tree;return K==null?0:K.Count;},TryGetValue:function(K,L){var M;M=this.TryFind(K);return M!=null&&M.$==1&&(L.set(M.$0),true);},ContainsKey:function(K){return d.Contains(f.New(K,void 0),this.tree);},Add:function(K,L){return new i.New$1(d.Add(f.New(K,L),this.tree));},get_Tree:function(){return this.tree;},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();},CompareTo0:function(K){return z.compareWith(A.Compare,this,K);}},h,i);i.New=D.Ctor(function(K){i.New$1.call(this,g.fromSeq(K));},i);i.New$1=D.Ctor(function(K){h.New.call(this);this.tree=K;},i);j.Map=function(K,L){return new i.New$1(d.OfSeq(z.map(function(M){return f.New(M.Key,K(M.Key,M.Value));},d.Enumerate(false,L.get_Tree()))));};j.TryPick=function(K,L){return z.tryPick(function(M){return K(M.K,M.V);},L);};j.TryFindKey=function(K,L){return z.tryPick(function(M){return K(M.K,M.V)?{$:1,$0:M.K}:null;},L);};j.TryFind=function(K,L){return L.TryFind(K);};j.ToSeq=function(K){return z.map(function(L){return[L.Key,L.Value];},d.Enumerate(false,K.get_Tree()));};j.Pick=function(K,L){return z.pick(function(M){return K(M.K,M.V);},L);};j.Partition=function(K,L){var M,N,O;M=y.partition(function(P){return K(P.Key,P.Value);},y.ofSeq(d.Enumerate(false,L.get_Tree())));return[new i.New$1((N=M[0],d.Build(N,0,N.length-1))),new i.New$1((O=M[1],d.Build(O,0,O.length-1)))];};j.OfArray=function(K){return new i.New$1(d.OfSeq(z.map(function(L){return f.New(L[0],L[1]);},K)));};j.Iterate=function(K,L){z.iter(function(M){K(M.K,M.V);},L);};j.ForAll=function(K,L){return z.forall(function(M){return K(M.K,M.V);},L);};j.FoldBack=function(K,L,M){return z.fold(function(N,O){return K(O.Key,O.Value,N);},M,d.Enumerate(true,L.get_Tree()));};j.Fold=function(K,L,M){return z.fold(function(N,O){return K(N,O.Key,O.Value);},L,d.Enumerate(false,M.get_Tree()));};j.FindKey=function(K,L){return z.pick(function(M){return K(M.K,M.V)?{$:1,$0:M.K}:null;},L);};j.Filter=function(K,L){var M;return new i.New$1((M=y.ofSeq(z.filter(function(N){return K(N.Key,N.Value);},d.Enumerate(false,L.get_Tree()))),d.Build(M,0,M.length-1)));};j.Exists=function(K,L){return z.exists(function(M){return K(M.K,M.V);},L);};k=c.FSharpSet=D.Class({Equals:function(K){return this.get_Count()===K.get_Count()&&z.forall2(A.Equals,this,K);},GetHashCode:function(){return -1741749453+A.Hash(y.ofSeq(this));},GetEnumerator$1:function(){return E.Get(d.Enumerate(false,this.tree));},Remove:function(K){return new k.New$1(d.Remove(K,this.tree));},get_MinimumElement:function(){return z.head(d.Enumerate(false,this.tree));},get_MaximumElement:function(){return z.head(d.Enumerate(true,this.tree));},IsSupersetOf:function(K){var L;L=this;return z.forall(function(M){return L.Contains(M);},K);},IsSubsetOf:function(K){return z.forall(function(L){return K.Contains(L);},this);},IsProperSupersetOf:function(K){return this.IsSupersetOf(K)&&this.get_Count()>K.get_Count();},IsProperSubsetOf:function(K){return this.IsSubsetOf(K)&&this.get_Count()<K.get_Count();},get_Tree:function(){return this.tree;},get_IsEmpty:function(){return this.tree==null;},get_Count:function(){var K;K=this.tree;return K==null?0:K.Count;},Contains:function(K){return d.Contains(K,this.tree);},Add:function(K){return new k.New$1(d.Add(K,this.tree));},sub:function(K){return l.Filter(function(L){return!K.Contains(L);},this);},add:function(K){return new k.New$1(d.OfSeq(z.append(this,K)));},CompareTo0:function(K){return z.compareWith(A.Compare,this,K);},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();}},h,k);k.op_Subtraction=function(K,L){return l.Filter(function(M){return!L.Contains(M);},K);};k.op_Addition=function(K,L){return new k.New$1(d.OfSeq(z.append(K,L)));};k.New=D.Ctor(function(K){k.New$1.call(this,d.OfSeq(K));},k);k.New$1=D.Ctor(function(K){h.New.call(this);this.tree=K;},k);l.Partition=function(K,L){var M;M=y.partition(K,y.ofSeq(L));return[new k.New$1(d.OfSeq(M[0])),new k.New$1(d.OfSeq(M[1]))];};l.FoldBack=function(K,L,M){return z.fold(function(N,O){return K(O,N);},M,d.Enumerate(true,L.get_Tree()));};l.Filter=function(K,L){var M;return new k.New$1((M=y.ofSeq(z.filter(K,L)),d.Build(M,0,M.length-1)));};m=c.ListEnumerator=D.Class({get_Current:function(){return y.get(this.arr,this.i);},MoveNext$1:function(){this.i=this.i+1;return this.i<y.length(this.arr);},Dispose:a.ignore,Current:function(){return y.get(this.arr,this.i);},Reset:function(){F.FailWith("IEnumerator.Reset not supported");},Current0:function(){return y.get(this.arr,this.i);},MoveNext:function(){return this.MoveNext$1();}},h,m);m.New=D.Ctor(function(K){h.New.call(this);this.arr=K;this.i=-1;},m);n=c.List=D.Class({GetEnumerator:function(){return E.Get(this);},GetEnumerator0:function(){return E.Get0(this);}},null,n);n.RemoveAll=function(K,L){var M,N,O,P;M=0;N=0;while(N<y.length(K))if(L(K[N])){O=N+1;while(O<y.length(K)&&L(K[O]))O=O+1;M=M+O-N;P=O-N;K.splice.apply(K,[N,P]);}else N=N+1;return M;};n.Remove=function(K,L){var M;M=y.findIndexBound(K,0,y.length(K),L==null?function(N){return N==null;}:function(N){var O;O=L;return A.Equals(O,N);});return M===-1?false:(K.splice.apply(K,[M,1]),true);};o=c.LinkedListEnumerator=D.Class({Reset:a.ignore,Dispose:a.ignore,MoveNext:function(){this.c=this.c.n;return!A.Equals(this.c,null);},Current0:function(){return this.c.v;},Current:function(){return this.c.v;}},h,o);o.New=D.Ctor(function(K){h.New.call(this);this.c=K;},o);p=c.LinkedList=D.Class({RemoveLast:function(){this.Remove$1(this.p);},RemoveFirst:function(){this.Remove$1(this.n);},Remove:function(K){var L;L=this.Find(K);return A.Equals(L,null)?false:(this.Remove$1(L),true);},Remove$1:function(K){var L,M;L=K.p;M=K.n;A.Equals(L,null)?this.n=M:L.n=M;A.Equals(M,null)?this.p=L:M.p=L;this.c=this.c-1;},GetEnumerator$1:function(){return new o.New(this);},FindLast:function(K){var L,M;L=this.p;M=true;while(M&&!A.Equals(L,null))if(L.v==K)M=false;else L=L.p;return M?null:L;},Find:function(K){var L,M;L=this.n;M=true;while(M&&!A.Equals(L,null))if(L.v==K)M=false;else L=L.n;return M?null:L;},Contains:function(K){var L,M;L=false;M=this.n;while(!A.Equals(M,null)&&!L)if(M.v==K)L=true;else M=M.n;return L;},Clear:function(){this.c=0;this.n=null;this.p=null;},AddLast:function(K){var L;return this.c===0?(L={p:null,n:null,v:K},(this.n=L,this.p=this.n,this.c=1,L)):this.AddAfter(this.p,K);},AddFirst:function(K){var L;return this.c===0?(L={p:null,n:null,v:K},(this.n=L,this.p=this.n,this.c=1,L)):this.AddBefore(this.n,K);},AddBefore:function(K,L){var M,N;M=K.p;N={p:M,n:K,v:L};A.Equals(K.p,null)?this.n=N:void 0;K.p=N;!A.Equals(M,null)?M.n=N:void 0;this.c=this.c+1;return N;},AddAfter:function(K,L){var M,N;M=K.n;N={p:K,n:M,v:L};A.Equals(K.n,null)?this.p=N:void 0;K.n=N;!A.Equals(M,null)?M.p=N:void 0;this.c=this.c+1;return N;},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();}},h,p);p.New=D.Ctor(function(){p.New$1.call(this,[]);},p);p.New$1=D.Ctor(function(K){var L,M;h.New.call(this);this.c=0;this.n=null;this.p=null;L=E.Get(K);L.MoveNext()?(this.n={p:null,n:null,v:L.Current()},this.p=this.n,this.c=1):void 0;while(L.MoveNext()){M={p:this.p,n:null,v:L.Current()};this.p.n=M;this.p=M;this.c=this.c+1;}},p);q=b.Grouping=D.Class({System_Linq_IGrouping_2$get_Key:function(){return this.k;},GetEnumerator0:function(){return E.Get0(this.v);},GetEnumerator:function(){return E.Get(this.v);}},h,q);q.New=D.Ctor(function(K,L){h.New.call(this);this.k=K;this.v=L;},q);r=b.FsComparer=D.Class({Compare:function(K,L){return A.Compare(K,L);}},h,r);r.New=D.Ctor(function(){h.New.call(this);},r);s=b.ProjectionComparer=D.Class({Compare:function(K,L){return this.primary.Compare(this.projection(K),this.projection(L));}},h,s);s.New=D.Ctor(function(K,L){h.New.call(this);this.primary=K;this.projection=L;},s);t=b.CompoundComparer=D.Class({Compare:function(K,L){var M;M=this.primary.Compare(K,L);return M===0?this.secondary.Compare(K,L):M;}},h,t);t.New=D.Ctor(function(K,L){h.New.call(this);this.primary=K;this.secondary=L;},t);u=b.ReverseComparer=D.Class({Compare:function(K,L){return this.primary.Compare(this.projection(L),this.projection(K));}},h,u);u.New=D.Ctor(function(K,L){h.New.call(this);this.primary=K;this.projection=L;},u);v=b.OrderedEnumerable=D.Class({GetEnumerator0:function(){return E.Get(this);},GetEnumerator:function(){var K,L;K=this;L=y.ofSeq(this.source);y.sortInPlaceWith(function(M,N){return K.primary.Compare(M,N);},L);return E.Get(L);},System_Linq_IOrderedEnumerable_1$CreateOrderedEnumerable:function(K,L,M){return new v.New(this.source,new t.New(this.primary,M?new u.New(L,K):new s.New(L,K)));}},h,v);v.New=D.Ctor(function(K,L){h.New.call(this);this.source=K;this.primary=L;},v);w.ElementAtOrDefault=function(K,L,M){try{return z.nth(L,K);}catch(N){return M;}};w.FirstOrDefault=function(K,L){var M;M=E.Get(K);try{return M.MoveNext()?M.Current():L;}finally{if(typeof M=="object"&&"Dispose"in M)M.Dispose();}};w.FirstOrDefault$1=function(K,L,M){var N;N=z.tryFind(L,K);return N==null?M:N.$0;};w.LastOrDefault=function(K,L,M){var N;N=w.LastPred(K,L);return N==null?M:N.$0;};w.SingleOrDefault=function(K,L,M){var N,O;N=E.Get(K);try{O=null;while(N.MoveNext())if(L(N.Current()))if(O!=null&&O.$==1)F.InvalidOp("Sequence contains more than one element");else O={$:1,$0:N.Current()};return O==null?M:O.$0;}finally{if(typeof N=="object"&&"Dispose"in N)N.Dispose();}};w.Where=function(K,L){return z.delay(function(){return z.enumUsing(E.Get(K),function(M){var N;N=0;return z.enumWhile(function(){return M.MoveNext();},z.delay(function(){return z.append(L(M.Current(),N)?[M.Current()]:[],z.delay(function(){N=N+1;return[];}));}));});});};w.Union=function(K,L,M){var N,O;N=new G.New(K,M);O=E.Get(L);try{while(O.MoveNext())N.Add(O.Current());}finally{if(typeof O=="object"&&"Dispose"in O)O.Dispose();}return N;};w.ToDictionary=function(K,L,M,N){var O;O=new H.New$3(N);z.iter(function(P){O.Add(L(P),M(P));},K);return O;};w.ToDictionary$1=function(K,L,M){var N;N=new H.New$3(M);z.iter(function(O){N.Add(L(O),O);},K);return N;};w.TakeWhile=function(K,L){return z.delay(function(){return z.enumUsing(E.Get(K),function(M){return z.enumWhile(function(){return M.MoveNext()&&L(M.Current());},z.delay(function(){return[M.Current()];}));});});};w.TakeWhile$1=function(K,L){return z.delay(function(){return z.enumUsing(E.Get(K),function(M){var N;N=0;return z.enumWhile(function(){return M.MoveNext()&&L(M.Current(),N);},z.delay(function(){N=N+1;return[M.Current()];}));});});};w.Take=function(K,L){return z.delay(function(){return z.enumUsing(E.Get(K),function(M){var N;N=0;return z.enumWhile(function(){return N<L&&M.MoveNext();},z.delay(function(){N=N+1;return[M.Current()];}));});});};w.Sum=function(K){var L;L=z.choose(function(M){return M!=null?{$:1,$0:I.get(M)}:null;},K);return z.isEmpty(L)?null:z.sum(L);};w.SkipWhile=function(K,L){return z.delay(function(){return z.enumUsing(E.Get(K),function(M){var N;N=true;return z.append(z.enumWhile(function(){return N&&M.MoveNext();},z.delay(function(){return!L(M.Current())?(N=false,[]):[];})),z.delay(function(){return!N?z.append([M.Current()],z.delay(function(){return z.enumWhile(function(){return M.MoveNext();},z.delay(function(){return[M.Current()];}));})):[];}));});});};w.SkipWhile$1=function(K,L){return z.delay(function(){return z.enumUsing(E.Get(K),function(M){var N,O;N=0;O=true;return z.append(z.enumWhile(function(){return O&&M.MoveNext();},z.delay(function(){return L(M.Current(),N)?(N=N+1,[]):(O=false,[]);})),z.delay(function(){return!O?z.append([M.Current()],z.delay(function(){return z.enumWhile(function(){return M.MoveNext();},z.delay(function(){return[M.Current()];}));})):[];}));});});};w.Skip=function(K,L){return z.delay(function(){return z.enumUsing(E.Get(K),function(M){var N;N=0;return z.append(z.enumWhile(function(){return N<L&&M.MoveNext();},z.delay(function(){N=N+1;return[];})),z.delay(function(){return z.enumWhile(function(){return M.MoveNext();},z.delay(function(){return[M.Current()];}));}));});});};w.Single=function(K,L){var M;function N(O,P){return L(P)?O!=null?F.InvalidOp("Sequence contains more than one matching element"):{$:1,$0:P}:O;}M=(((D.Curried3(z.fold))(N))(null))(K);return M!=null&&M.$==1?M.$0:F.InvalidOp("Sequence contains no elements");};w.SequenceEqual=function(K,L,M){var N,O,P;N=E.Get(K);function Q(){while(true)if(N.MoveNext()){if(!(P.MoveNext()&&M.CEquals(N.Current(),P.Current())))return false;}else return!P.MoveNext();}try{P=E.Get(K);try{O=Q();}finally{if(typeof P=="object"&&"Dispose"in P)P.Dispose();}return O;}finally{if(typeof N=="object"&&"Dispose"in N)N.Dispose();}};w.SelectMany=function(K,L,M){function N(O,P){return z.map(function(Q){return M(O,Q);},P);}return z.collect(function(O){return N(O[0],O[1]);},z.mapi(function(O,P){return[P,L(P,O)];},K));};w.SelectMany$1=function(K,L,M){function N(O,P){return z.map(function(Q){return M(O,Q);},P);}return z.collect(function(O){return N(O[0],O[1]);},z.map(function(O){return[O,L(O)];},K));};w.SelectMany$2=function(K,L){return z.concat(z.mapi(function(M,N){return L(N,M);},K));};w.Select=function(K,L){return z.mapi(function(M,N){return L(N,M);},K);};w.Reverse=function(K){return y.ofSeq(K).slice().reverse();};w.Repeat=function(K,L){return z.init(L,function(){return K;});};w.Range=function(K,L){return z.init(L,function(M){return K+M;});};w.OrderByDescending=function(K,L,M){return new v.New(K,new u.New(M,L));};w.OrderBy=function(K,L,M){return new v.New(K,new s.New(M,L));};w.Min=function(K){var L;L=z.choose(function(M){return M!=null?{$:1,$0:I.get(M)}:null;},K);return z.isEmpty(L)?null:z.min(L);};w.Max=function(K){var L;L=z.choose(function(M){return M!=null?{$:1,$0:I.get(M)}:null;},K);return z.isEmpty(L)?null:z.max(L);};w.Last=function(K,L){var M;M=w.LastPred(K,L);return M==null?F.InvalidOp("Sequence contains no matching element"):M.$0;};w.LastPred=function(K,L){function M(N,O){return L(O)?{$:1,$0:O}:N;}return(((D.Curried3(z.fold))(M))(null))(K);};w.Join=function(K,L,M,N,O,P){return z.delay(function(){var Q,R,S;Q=new H.New$3(P);R=y.ofSeq(z.delay(function(){return z.collect(function(T){var U,V,W;U=M(T);return(V=null,[Q.TryGetValue(U,{get:function(){return V;},set:function(X){V=X;}}),V])[0]?[]:(W=[T,[]],(Q.Add(U,W),[W]));},K);}));S=E.Get(L);try{while(S.MoveNext())(function(){var T,U,V;T=S.Current();U=(V=null,[Q.TryGetValue(N(T),{get:function(){return V;},set:function(W){V=W;}}),V]);return U[0]?void U[1][1].push(T):null;}());}finally{if(typeof S=="object"&&"Dispose"in S)S.Dispose();}return y.ofSeq(z.delay(function(){return z.collect(function(T){var U;U=T[0];return z.map(function(V){return O(U,V);},T[1]);},R);}));});};w.Intersect=function(K,L,M){var N;N=new G.New(K,M);return z.delay(function(){var O;O=new G.New$1(M);return z.collect(function(P){return N.Contains(P)&&O.Add(P)?[P]:[];},L);});};w.GroupJoin=function(K,L,M,N,O,P){return z.delay(function(){var Q,R,S;Q=new H.New$3(P);R=y.ofSeq(z.delay(function(){return z.collect(function(T){var U,V,W;U=M(T);return(V=null,[Q.TryGetValue(U,{get:function(){return V;},set:function(X){V=X;}}),V])[0]?[]:(W=[T,[]],(Q.Add(U,W),[W]));},K);}));S=E.Get(L);try{while(S.MoveNext())(function(){var T,U,V;T=S.Current();U=(V=null,[Q.TryGetValue(N(T),{get:function(){return V;},set:function(W){V=W;}}),V]);return U[0]?void U[1][1].push(T):null;}());}finally{if(typeof S=="object"&&"Dispose"in S)S.Dispose();}y.iteri(function(T,U){return y.set(R,T,O(U[0],U[1]));},R);return R;});};w.GroupBy=function(K,L,M,N,O){return z.map(function(P){return N(P.System_Linq_IGrouping_2$get_Key(),P);},w.GroupBy$1(K,L,M,O));};w.GroupBy$1=function(K,L,M,N){return z.delay(function(){return y.ofSeq(z.delay(function(){var O;O=new H.New$3(N);return z.collect(function(P){var Q,R,S,T,U;Q=L(P);R=M(P);S=(T=null,[O.TryGetValue(Q,{get:function(){return T;},set:function(V){T=V;}}),T]);return S[0]?(S[1].push(R),[]):(U=[],(U.push(R),O.set_Item(Q,U),[new q.New(Q,U)]));},K);}));});};w.Except=function(K,L,M){var N,O;N=new G.New(K,M);O=E.Get(L);try{while(O.MoveNext())N.Remove(O.Current());}finally{if(typeof O=="object"&&"Dispose"in O)O.Dispose();}return N;};w.Distinct=function(K,L){return z.delay(function(){return z.enumUsing(E.Get(K),function(M){var N;N=new G.New$1(L);return z.enumWhile(function(){return M.MoveNext();},z.delay(function(){return N.Add(M.Current())?[M.Current()]:[];}));});});};w.DefaultIfEmpty=function(K,L){return z.isEmpty(K)?[L]:K;};w.Average=function(K){var L,M,N,O;L=[];M=E.Get(K);try{while(M.MoveNext()){if(N=M.Current(),N!=null){L.push((O=M.Current(),I.get(O)));}}return y.length(L)===0?null:z.sum(L)/y.length(L);}finally{if(typeof M=="object"&&"Dispose"in M)M.Dispose();}};x=b.Query=D.Class({},h,x);x.averageByNullable=function(K,L){var M;M=y.ofSeq(z.choose(function(N){return J.ofNullable(L(N));},K));return y.length(M)===0?null:y.average(M);};x.sumByNullable=function(K,L){return y.sum(y.ofSeq(z.choose(function(M){return J.ofNullable(L(M));},K)));};x.CheckThenBySource=function(K){return typeof K=="object"&&"System_Linq_IOrderedEnumerable_1$CreateOrderedEnumerable"in K?K:F.FailWith("'thenBy' and 'thenByDescending' may only be used with an ordered input");};x.New=D.Ctor(function(){h.New.call(this);},x);}());
