(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7;a=self;b=a.Sylvester=a.Sylvester||{};c=b.Web=b.Web||{};d=c.Thea=c.Thea||{};e=d.ClientExtensions=d.ClientExtensions||{};f=d._Html=d._Html||{};g=d.htmModule=d.htmModule||{};h=a.StartupCode$Sylvester_Web_Thea$ClientExtensions=a.StartupCode$Sylvester_Web_Thea$ClientExtensions||{};i=a.SMApp=a.SMApp||{};j=i.Bootstrap=i.Bootstrap||{};k=j.Controls=j.Controls||{};l=a.StartupCode$Sylvester_Web_Thea$Bootstrap=a.StartupCode$Sylvester_Web_Thea$Bootstrap||{};m=d.CUI=d.CUI||{};n=m.User=m.User||{};o=m.MicState=m.MicState||{};p=m.ClientState=m.ClientState||{};q=m.Interpreter=m.Interpreter||{};r=m.CUI=m.CUI||{};s=a.StartupCode$Sylvester_Web_Thea$CUI=a.StartupCode$Sylvester_Web_Thea$CUI||{};t=d.NLU=d.NLU||{};u=t.Intent=t.Intent||{};v=t.Trait=t.Trait||{};w=t.Entity=t.Entity||{};x=t.Meaning=t.Meaning||{};y=t.Question=t.Question||{};z=t.Voice=t.Voice||{};A=z["Entity'"]=z["Entity'"]||{};B=t.Text=t.Text||{};C=B["Meaning'"]=B["Meaning'"]||{};D=B["Intent'"]=B["Intent'"]||{};E=B["Entity'"]=B["Entity'"]||{};F=a.StartupCode$Sylvester_Web_Thea$NLU=a.StartupCode$Sylvester_Web_Thea$NLU||{};G=d.Main=d.Main||{};H=a.StartupCode$Sylvester_Web_Thea$Main=a.StartupCode$Sylvester_Web_Thea$Main||{};I=d.Client=d.Client||{};J=a.StartupCode$Sylvester_Web_Thea$Client=a.StartupCode$Sylvester_Web_Thea$Client||{};K=a.Sylvester$Web$Thea_GeneratedPrintf=a.Sylvester$Web$Thea_GeneratedPrintf||{};L=a.WebSharper;M=L&&L.Strings;N=a.IntelliFactory;O=N&&N.Runtime;P=L&&L.Utils;Q=a.console;R=a.jQuery;S=L&&L.Arrays;T=L&&L.List;U=L&&L.Seq;V=L&&L.UI;W=V&&V.Doc;X=V&&V.AttrModule;Y=L&&L.Concurrency;Z=L&&L.Random;_0=L&&L.Operators;_1=L&&L.Remoting;_2=_1&&_1.AjaxRemotingProvider;_3=a.Wit;_4=a.document;_5=L&&L.Unchecked;_6=L&&L.Collections;_7=_6&&_6.Dictionary;e.replace_tok=function(_8,_9,_){return M.Replace(_,_8,_9);};e.toLower=function(_8){return _8.toLowerCase();};e.debug=function(_8,_9){e.info((((O.Curried3(function(_,$,ba){return _("DEBUG: "+P.toSafe($)+": "+P.prettyPrint(ba));}))(a.id))(_8.toUpperCase()))(_9));};e.error=function(_8){Q.error(_8);};e.info=function(_8){Q.info(_8);};e.jserror=function(_8){R.error(_8);};e.toArray=function(_8){return S.map(a.id,R.makeArray(_8));};e["Terminal.EchoHtml'"]=function(_8,_9){_8.pause();_8.echo(_9,e.rawOpt());_8.resume();};e["Terminal.Echo'"]=function(_8,_9){_8.pause();_8.echo(_9);_8.resume();};e.rawOpt=function(){h.$cctor();return h.rawOpt;};f=d._Html=O.Class({toString:function(){return f.toString(this);}},null,f);f.toString=function(_8){function _9(_){return function($){var ba,bb,bc,bd,be,bf,bg;bb=M.replicate(_," ");switch($.$==0?$.$1.$==1?$.$1.$0.$==2?$.$1.$1.$==0?(ba=[$.$1.$0.$0,$.$0],1):(ba=[$.$1,$.$0],2):(ba=[$.$1,$.$0],2):(ba=[$.$1,$.$0],2):$.$==2?(ba=$.$0,3):(ba=[$.$0,$.$1],0)){case 0:return ba[0]+"=\""+ba[1]+"\"";case 1:bc=ba[1];return bb+"<"+bc+">"+ba[0]+"</"+bc+">\r\n";case 2:bd=ba[1];be=T.partition(function(bh){return bh.$==1;},ba[0]);bf=be[1];bg=be[0];return bf.$==0?bb+"<"+bd+(bg.$===0?"":" "+M.concat(" ",T.ofSeq(U.delay(function(){return U.map(function(bh){return(_9(0))(bh);},bg);}))))+"/>\r\n":bb+"<"+bd+(bg.$===0?"":" "+M.concat(" ",T.ofSeq(U.delay(function(){return U.map(function(bh){return(_9(0))(bh);},bg);}))))+">\r\n"+M.concat("",T.ofSeq(U.delay(function(){return U.map(function(bh){return(_9(_+1))(bh);},bf);})))+bb+"</"+bd+">\r\n";case 3:return bb+ba+"\r\n";}};}return(_9(0))(_8);};g.alt=function(_8){return new f({$:1,$0:"alt",$1:_8});};g.src=function(_8){return new f({$:1,$0:"src",$1:_8});};g.cls=function(_8){return new f({$:1,$0:"class",$1:_8});};g.str=function(_8){return f.toString(_8);};g.op_PercentEquals=function(_8,_9){return new f({$:1,$0:_8,$1:_9});};g.op_Splice=function(_8){var _9;return T.ofArray([new f({$:2,$0:(_9=_8,a.String(_9))})]);};g.strong=function(){h.$cctor();return h.strong;};g.h4=function(){h.$cctor();return h.h4;};g.h3=function(){h.$cctor();return h.h3;};g.h2=function(){h.$cctor();return h.h2;};g.h1=function(){h.$cctor();return h.h1;};g.li=function(){h.$cctor();return h.li;};g.ul=function(){h.$cctor();return h.ul;};g.th=function(){h.$cctor();return h.th;};g.td=function(){h.$cctor();return h.td;};g.tr=function(){h.$cctor();return h.tr;};g.a=function(){h.$cctor();return h.a;};g.p=function(){h.$cctor();return h.p;};g.area=function(){h.$cctor();return h.area;};g.map=function(){h.$cctor();return h.map;};g.img=function(){h.$cctor();return h.img;};g.tfoot=function(){h.$cctor();return h.tfoot;};g.tbody=function(){h.$cctor();return h.tbody;};g.thead=function(){h.$cctor();return h.thead;};g.table=function(){h.$cctor();return h.table;};g.span=function(){h.$cctor();return h.span;};g.section=function(){h.$cctor();return h.section;};g.br=function(){h.$cctor();return h.br;};g.div=function(){h.$cctor();return h.div;};g.body=function(){h.$cctor();return h.body;};g.style=function(){h.$cctor();return h.style;};g.title=function(){h.$cctor();return h.title;};g.head=function(){h.$cctor();return h.head;};g.html=function(){h.$cctor();return h.html;};g.elem=function(_8,_9){return new f({$:0,$0:_8,$1:_9});};h.$cctor=function(){var _8;h.$cctor=a.ignore;h.rawOpt=(_8={},_8.raw=true,_8);h.html=function(_9){return g.elem("html",_9);};h.head=function(_9){return g.elem("head",_9);};h.title=function(_9){return g.elem("title",_9);};h.style=function(_9){return g.elem("style",_9);};h.body=function(_9){return g.elem("body",_9);};h.div=function(_9){return g.elem("div",_9);};h.br=function(_9){return g.elem("br",_9);};h.section=function(_9){return g.elem("section",_9);};h.span=function(_9){return g.elem("span",_9);};h.table=function(_9){return g.elem("table",_9);};h.thead=function(_9){return g.elem("thead",_9);};h.tbody=function(_9){return g.elem("tbody",_9);};h.tfoot=function(_9){return g.elem("tfoot",_9);};h.img=function(_9){return g.elem("img",_9);};h.map=function(_9){return g.elem("map",_9);};h.area=function(_9){return g.elem("area",_9);};h.p=function(_9){return g.elem("p",_9);};h.a=function(_9){return g.elem("a",_9);};h.tr=function(_9){return g.elem("tr",_9);};h.td=function(_9){return g.elem("td",_9);};h.th=function(_9){return g.elem("th",_9);};h.ul=function(_9){return g.elem("ul",_9);};h.li=function(_9){return g.elem("li",_9);};h.h1=function(_9){return g.elem("h1",_9);};h.h2=function(_9){return g.elem("h1",_9);};h.h3=function(_9){return g.elem("h1",_9);};h.h4=function(_9){return g.elem("h1",_9);};h.strong=function(_9){return g.elem("strong",_9);};};k.Radio=function(_8,_9,_,$,ba){return W.Element("div",new T.T({$:1,$0:(k.cls())("radio"),$1:_9}),[W.Element("label",$,[W.Radio(ba,true,_),W.TextNode(_8)])]);};k.Checkbox=function(_8,_9,_,$,ba){return W.Element("div",new T.T({$:1,$0:(k.cls())("checkbox"),$1:_9}),[W.Element("label",$,[W.CheckBox(ba,_),W.TextNode(_8)])]);};k.TextArea=function(_8,_9,_,$,ba){return W.Element("div",new T.T({$:1,$0:(k.cls())("form-group"),$1:_9}),[W.Element("label",$,[W.TextNode(_8)]),W.InputArea(new T.T({$:1,$0:(k.cls())("form-control"),$1:ba}),_)]);};k.InputPassword=function(_8,_9,_,$,ba){return W.Element("div",new T.T({$:1,$0:(k.cls())("form-group"),$1:_9}),[W.Element("label",$,[W.TextNode(_8)]),W.PasswordBox(new T.T({$:1,$0:(k.cls())("form-control"),$1:ba}),_)]);};k.Input=function(_8,_9,_,$,ba){return W.Element("div",new T.T({$:1,$0:(k.cls())("form-group"),$1:_9}),[W.Element("label",$,[W.TextNode(_8)]),W.Input(new T.T({$:1,$0:(k.cls())("form-control"),$1:ba}),_)]);};k.Container=function(_8){return W.Element("div",[(k.cls())("container")],_8);};k.Class=function(){l.$cctor();return l.Class;};k.cls=function(){l.$cctor();return l.cls;};l.$cctor=function(){l.$cctor=a.ignore;l.cls=X.Class;l.Class=X.Class;};n=m.User=O.Class({toString:function(){return this.Name;}},null,n);n.New=function(_8,_9){return new n({Name:_8,LastLoggedIn:_9});};o.MicReady={$:5};o.MicAudioEnd={$:4};o.MicAudioStart={$:3};o.MicDisconnected={$:2};o.MicConnecting={$:1};o.MicNotInitialized={$:0};p.ClientUnderstand={$:2};p.ClientReady={$:1};p.ClientNotInitialzed={$:0};q=m.Interpreter=O.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,q);r=m.CUI=O.Class({SayVoices:function(){var _8,_9,_;_8=this;_9=a.speechSynthesis.getVoices();!(_9==null)?(_=e.toArray(_9),_8.Say((function($){return function(ba){return $("There are currently "+a.String(ba)+" voices installed on this computer or device.");};}(a.id))(S.length(_))),S.iteri(function($,ba){return _8.Say(((((O.Curried(function(bb,bc,bd,be){return bb("Voice "+a.String(bc)+". Name: "+P.toSafe(bd)+", Local: "+P.prettyPrint(be)+".");},4))(a.id))($))(ba.name))(ba.localService));},_)):void 0;},Wait:function(_8){this.Wait$1(function(){Y.Start(_8,null);});},Wait$1:function(_8){this["Echo'"]("please wait...");this.Term.pause();_8();this.Term.resume();},sayRandom:function(_8,_9){this.Say(m.getRandomPhrase(_8,_9));},Say:function(_8){var _9,_,$;_9=this.Voice;_9!=null&&_9.$==1?(_=_9.$0,Y.Start(($=null,Y.Delay(function(){var ba;ba=new a.SpeechSynthesisUtterance(_8);ba.voice=_;a.speechSynthesis.speak(ba);return Y.Zero();})),null),this.Caption?this["Echo'"](_8):void 0):this["Echo'"](_8);},Debug:function(_8,_9){e.debug(_8,_9);},"EchoHtml'":function(_8){var _9,_;_9=(_={},_.raw=true,_);this.Term.disable();this.Term.echo(_8,_9);this.Term.enable();},"Echo'":function(_8){this.Term.disable();this.Term.echo(_8);this.Term.enable();}},null,r);r.New=function(_8,_9,_,$){return new r({Voice:_8,Mic:_9,Term:_,Caption:$});};m.waitAddPhrases=function(){s.$cctor();return s.waitAddPhrases;};m.waitRetrievePhrases=function(){s.$cctor();return s.waitRetrievePhrases;};m.helpPhrases=function(){s.$cctor();return s.helpPhrases;};m.helloUserPhrases=function(){s.$cctor();return s.helloUserPhrases;};m.helloPhrases=function(){s.$cctor();return s.helloPhrases;};m["getRandomPhrase'"]=function(_8){return e.replace_tok("$0","",U.nth(m.rng().Next(0,_8.get_Length()),_8));};m.getRandomPhrase=function(_8,_9){return e.replace_tok("$0",_9,U.nth(m.rng().Next(0,_8.get_Length()),_8));};m.rng=function(){s.$cctor();return s.rng;};s.$cctor=function(){s.$cctor=a.ignore;s.rng=new Z.New();s.helloPhrases=T.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);s.helloUserPhrases=T.ofArray(["Hi $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0."]);s.helpPhrases=T.ofArray(["What can I help you with $0?"]);s.waitRetrievePhrases=T.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);s.waitAddPhrases=T.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0."]);};u=t.Intent=O.Class({toString:function(){return(((O.Curried3(function(_8,_9,_){return _8("Intent("+P.toSafe(_9)+", "+K.p$2(_)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,u);v=t.Trait=O.Class({toString:function(){return(((O.Curried3(function(_8,_9,_){return _8("Trait("+P.toSafe(_9)+", "+P.prettyPrint(_)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,v);w=t.Entity=O.Class({toString:function(){return((((O.Curried(function(_8,_9,_,$){return _8("Entity("+P.toSafe(_9)+", "+P.toSafe(_)+", "+K.p$2($)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[2];},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,w);x=t.Meaning=O.Class({toString:function(){return((((O.Curried(function(_8,_9,_,$){return _8(K.p(_9)+" "+K.p$3(_)+" "+K.p$5($));},4))(a.id))(this.get_Intent()))(this.get_Trait()))(this.get_Entities());},get_Entities:function(){return(this.Unwrap())[2];},get_Trait:function(){return(this.Unwrap())[1];},get_Intent:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,x);y=t.Question=O.Class({toString:function(){return(((O.Curried3(function(_8,_9,_){return _8("Name: "+P.toSafe(_9)+" Text: "+P.toSafe(_));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return(this.Unwrap())[1];},get_Name:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1];}},null,y);A.New=function(_8,_9,_,$,ba){return{body:_8,end:_9,start:_,suggested:$,value:ba};};z["Intent'"]=function(_8,_9){return!(_9.intent==null)?{$:1,$0:new u({$:0,$0:e.toLower(_9.intent.value),$1:null})}:null;};z["Trait'"]=function(_8){return!(_8.greetings==null)?{$:1,$0:new v({$:0,$0:"greetings",$1:e.toLower(_8.contact.value)})}:null;};z["Entity'$1"]=function(_8){return!(_8.contact==null)?{$:1,$0:new w({$:0,$0:"contact",$1:e.toLower(_8.contact.value),$2:null})}:null;};C=B["Meaning'"]=O.Class({get_TopIntent:function(){return T.head(T.sortBy(function(_8){return _8.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,C);D=B["Intent'"]=O.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,D);E=B["Entity'"]=O.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,E);B.HasMeaning=function(_8){var _9,_,$,ba,bb,bc;return _8!=null&&_8.$==1&&(_8.$0.$0.$==0&&(_8.$0.$1.get_Length()>0&&(_9=_8.$0.$1,true)))?{$:1,$0:new x({$:0,$0:null,$1:null,$2:{$:1,$0:T.map(function(bd){return new w({$:0,$0:e.toLower(bd.get_Role()),$1:bd.get_Value(),$2:{$:1,$0:bd.get_Confidence()}});},T.filter(function(bd){return bd.get_Confidence()>B.entityConfidenceThreshold();},_9))}})}:_8!=null&&_8.$==1&&(_8.$0.$1.$==0&&(_8.$0.$0.get_Length()>0&&_8.$0.get_TopIntent().get_Confidence()>B.intentConfidenceThreshold()&&(_=[_8.$0.$0,_8],true)))?($=_[1],{$:1,$0:new x({$:0,$0:{$:1,$0:new u({$:0,$0:e.toLower($.$0.get_TopIntent().get_Name()),$1:{$:1,$0:$.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):_8!=null&&_8.$==1&&(_8.$0.$0.get_Length()>0&&_8.$0.$1.get_Length()>0&&_8.$0.get_TopIntent().get_Confidence()>B.intentConfidenceThreshold()&&(ba=[_8.$0.$1,_8.$0.$0,_8],true))?(bb=ba[2],(bc=T.map(function(bd){return new w({$:0,$0:e.toLower(bd.get_Role()),$1:bd.get_Value(),$2:{$:1,$0:bd.get_Confidence()}});},T.filter(function(bd){return bd.get_Confidence()>B.entityConfidenceThreshold();},bb.$0.get_Entities())),{$:1,$0:new x({$:0,$0:{$:1,$0:new u({$:0,$0:e.toLower(bb.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bb.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bc}})})):null;};B.entityConfidenceThreshold=function(){F.$cctor();return F.entityConfidenceThreshold;};B.set_entityConfidenceThreshold=function(_8){F.$cctor();F.entityConfidenceThreshold=_8;};B.intentConfidenceThreshold=function(){F.$cctor();return F.intentConfidenceThreshold;};B.set_intentConfidenceThreshold=function(_8){F.$cctor();F.intentConfidenceThreshold=_8;};B.QuickPrograms=function(_8){return _8==="programs"?{$:1,$0:new x({$:0,$0:{$:1,$0:new u({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};B.QuickNo=function(_8){var _9;return _8==="no"||(_8==="NO"||(_8==="No"||(_8==="nope"||(_8==="no way"||(_8==="nah"||(_8==="don't do it"||_8==="stop"))))))?{$:1,$0:new x({$:0,$0:{$:1,$0:new u({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};B.QuickYes=function(_8){var _9;return _8==="yes"||(_8==="YES"||(_8==="Yes"||(_8==="YEs"||(_8==="ok"||(_8==="sure"||(_8==="yeah"||(_8==="yep"||(_8==="uh huh"||(_8==="go ahead"||_8==="go")))))))))?{$:1,$0:new x({$:0,$0:{$:1,$0:new u({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};B.QuickHelp=function(_8){var _9;return _8==="help"||(_8==="help me"||(_8==="what's this?"||_8==="huh"))?{$:1,$0:new x({$:0,$0:{$:1,$0:new u({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};B.QuickHello=function(_8){var _9;return _8==="hello"||(_8==="hey"||(_8==="yo"||_8==="hi"))?{$:1,$0:new x({$:0,$0:{$:1,$0:new u({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};B.Voices=function(_8){return _8==="voices"?{$:1,$0:null}:null;};B.Debug=function(_8){return _8==="debug"?{$:1,$0:null}:null;};B.Blank=function(_8){return _8===""?{$:1,$0:null}:null;};t.No=function(_8){var _9,_;return(_=t.Intent$1("no",_8),_!=null&&_.$==1&&(_.$0[0]==null&&(_.$0[1]==null&&(_9=_8,true))))?{$:1,$0:_9}:null;};t.Yes=function(_8){var _9,_;return(_=t.Intent$1("yes",_8),_!=null&&_.$==1&&(_.$0[0]==null&&(_.$0[1]==null&&(_9=_8,true))))?{$:1,$0:_9}:null;};t.Entity$1=function(_8,_9){return _9.get_Name()===_8?{$:1,$0:_9.get_Value()}:null;};t.Intent$1=function(_8,_9){var _;return _9.get_Intent()!=null&&_9.get_Intent().$0.get_Name()===_8?(_=_9.Unwrap(),{$:1,$0:[_[1],_[2]]}):null;};F.$cctor=function(){F.$cctor=a.ignore;F.intentConfidenceThreshold=0.85;F.entityConfidenceThreshold=0.85;};G.update=function(_8,_9,_,$,ba){var bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ;function b0(cf){return _9.ContainsKey(cf);}function b1(cf,cg){return _9.Add(cf,cg);}function b2(cf){_9.Remove(cf);}function b3(){ba.shift();}function b4(){_.shift();}function b5(cf){var cg;cg=G.getQuestion(cf);cg==null?(function(ch){return function(ci){return ch("No such question: "+P.toSafe(ci));};}(_0.FailWith))(cf):_.unshift(cg.$0);}function b6(cf){_8.Say(cf);}function b7(cf){$.unshift(cf);b6(cf);}function b8(cf,cg){var ch;ch=m.getRandomPhrase(cf,cg);$.unshift(ch);return _8.Say(ch);}function b9(cf,cg){b1(cf,cg);b5(cf);G.debug((function(ch){return function(ci){return ch("Added question: "+K.p$8(ci)+".");};}(a.id))(_[0]));return b7(e.replace_tok("$0",cg,G.getQuestion(cf).$0.get_Text()));}function b_(cf,cg){return b0(cf)?{$:1,$0:cg}:null;}function b$(cf,cg){return!b0(cf)?{$:1,$0:cg}:null;}function ca(cf){var cg;cg=b$("user",cf);return cg!=null&&cg.$==1?{$:1,$0:cg.$0}:null;}function cb(cf){var cg;cg=b_("user",cf);return cg!=null&&cg.$==1?{$:1,$0:cg.$0}:null;}function cc(cf){return _.length===0?(b3(),{$:1,$0:cf}):null;}function cd(cf,cg){var ch;return G.haveQuestion(cf)&&_.length>0&&_[0].get_Name()===cf?(b3(),b4(),b0(cf)?(ch=_9.get_Item(cf),(b2(cf),{$:1,$0:[cg,{$:1,$0:ch}]})):{$:1,$0:[cg,null]}):null;}function ce(cf){return typeof cf=="string"?{$:1,$0:cf}:null;}G.debug((function(cf){return function(cg){return cf("Begin context: "+P.prettyPrint(cg)+".");};}(a.id))(ba));G.debug((function(cf){return function(cg){return cf("Begin questions: "+P.prettyPrint(cg)+".");};}(a.id))(_));bb=T.ofSeq(U.take(ba.length>=5?5:ba.length,ba));bb.$==1&&(bd=ca(bb.$0),bd!=null&&bd.$==1&&(be=(bf=b$("started",bd.$0),bf!=null&&bf.$==1?{$:1,$0:bf.$0}:null),be!=null&&be.$==1&&(bg=cc(be.$0),bg!=null&&bg.$==1&&(bh=t.Intent$1("hello",bg.$0),bh!=null&&bh.$==1&&(bh.$0[0]==null&&(bh.$0[1]==null&&bb.$1.$==0))))))?(_9.Add("started",true),b8(m.helloPhrases(),"")):bb.$==1&&(bj=ca(bb.$0),bj!=null&&bj.$==1&&(bk=cc(bj.$0),bk!=null&&bk.$==1&&(bl=t.Intent$1("hello",bk.$0),bl!=null&&bl.$==1&&(bl.$0[0]==null&&(bl.$0[1]==null&&bb.$1.$==0)))))?b7("Hello, tell me your user name to get started."):bb.$==1&&(bn=ca(bb.$0),bn!=null&&bn.$==1&&(bo=cc(bn.$0),bo!=null&&bo.$==1&&(bp=t.Intent$1("hello",bo.$0),bp!=null&&bp.$==1&&(bp.$0[0]==null&&((bq=bp.$0[1],bq!=null&&bq.$==1)&&(bp.$0[1].$0.$==1&&(br=t.Entity$1("contact",bp.$0[1].$0.$0),br!=null&&br.$==1&&(bp.$0[1].$0.$1.$==0&&(bb.$1.$==0&&(bm=br.$0,true))))))))))?Y.Start((bs=null,Y.Delay(function(){b8(m.waitRetrievePhrases(),"user name");return Y.Bind((new _2.New()).Async("Sylvester.Web.Thea:Sylvester.Web.Thea.Server.GetUser:-313696020",[bm]),function(cf){var cg;return cf==null?(b7((function(ch){return function(ci){return ch("Sorry I did not find the user name "+P.toSafe(ci)+".");};}(a.id))(bm)),b9("addUser",bm),Y.Zero()):(cg=cf.$0,Y.Bind((new _2.New()).Async("Sylvester.Web.Thea:Sylvester.Web.Thea.Server.UpdateUserLastLogin:641375343",[cg.Name]),function(){_9.Add("user",cg);b8(m.helloUserPhrases(),(function(ch){return function(ci){return ch(P.prettyPrint(ci));};}(a.id))(_9.get_Item("user")));return cg.LastLoggedIn!=null?(b7((function(ch){return function(ci){return ch("You last logged in on "+P.prettyPrint(ci)+".");};}(a.id))(cg.LastLoggedIn.$0)),Y.Zero()):Y.Zero();}));});})),null):bb.$==1&&(bu=ca(bb.$0),bu!=null&&bu.$==1&&(bv=t.Yes(bu.$0),bv!=null&&bv.$==1&&(bw=cd("addUser",bv.$0),bw!=null&&bw.$==1&&((bx=bw.$0[1],bx!=null&&bx.$==1)&&(by=ce(bw.$0[1].$0),by!=null&&by.$==1&&(bb.$1.$==0&&(bt=by.$0,true)))))))?Y.Start((bz=null,Y.Delay(function(){b8(m.waitAddPhrases(),"user");return Y.Bind((new _2.New()).Async("Sylvester.Web.Thea:Sylvester.Web.Thea.Server.AddUser:1671533762",[bt]),function(cf){return cf==null?(b7((function(cg){return function(ch){return cg("Sorry I was not able to add the user "+P.toSafe(ch)+" to the system.");};}(a.id))(bt)),Y.Zero()):(b1("user",bt),b7((function(cg){return function(ch){return cg("Hello "+P.prettyPrint(ch)+", nice to meet you.");};}(a.id))(_9.get_Item("user"))),Y.Zero());});})),null):bb.$==1&&(bB=ca(bb.$0),bB!=null&&bB.$==1&&(bC=t.No(bB.$0),bC!=null&&bC.$==1&&(bD=cd("addUser",bC.$0),bD!=null&&bD.$==1&&((bE=bD.$0[1],bE!=null&&bE.$==1)&&(bF=ce(bD.$0[1].$0),bF!=null&&bF.$==1&&(bb.$1.$==0&&(bA=bF.$0,true)))))))?b7((function(cf){return function(cg){return cf("Ok I did not add the user "+P.toSafe(cg)+".");};}(a.id))(bA)):bb.$==1&&(bH=cb(bb.$0),bH!=null&&bH.$==1&&(bI=cc(bH.$0),bI!=null&&bI.$==1&&(bJ=t.Intent$1("hello",bI.$0),bJ!=null&&bJ.$==1&&(bJ.$0[0]==null&&((bK=bJ.$0[1],bK!=null&&bK.$==1)&&(bJ.$0[1].$0.$==1&&(bL=t.Entity$1("contact",bJ.$0[1].$0.$0),bL!=null&&bL.$==1&&(bJ.$0[1].$0.$1.$==0&&(bb.$1.$==0&&(bG=bL.$0,true))))))))))?Y.Start((bM=null,Y.Delay(function(){return Y.Bind((new _2.New()).Async("Sylvester.Web.Thea:Sylvester.Web.Thea.Server.GetUser:-313696020",[bG]),function(cf){return cf==null?(b7((function(cg){return function(ch){return cg("Sorry, the user "+P.toSafe(ch)+" does not exist.");};}(a.id))(bG)),Y.Zero()):(b9("switchUser",cf.$0.Name),Y.Zero());});})),null):bb.$==1&&(bO=cb(bb.$0),bO!=null&&bO.$==1&&(bP=t.Yes(bO.$0),bP!=null&&bP.$==1&&(bQ=cd("switchUser",bP.$0),bQ!=null&&bQ.$==1&&((bR=bQ.$0[1],bR!=null&&bR.$==1)&&(bS=ce(bQ.$0[1].$0),bS!=null&&bS.$==1&&(bb.$1.$==0&&(bN=bS.$0,true)))))))?(_9.set_Item("user",bN),b7((function(cf){return function(cg){return cf("Ok I switched to user "+P.prettyPrint(cg)+".");};}(a.id))(bN))):bb.$==1&&(bU=cb(bb.$0),bU!=null&&bU.$==1&&(bV=t.No(bU.$0),bV!=null&&bV.$==1&&(bW=cd("switchUser",bV.$0),bW!=null&&bW.$==1&&((bX=bW.$0[1],bX!=null&&bX.$==1)&&(bY=ce(bW.$0[1].$0),bY!=null&&bY.$==1&&(bb.$1.$==0&&(bT=bY.$0,true)))))))?b7((function(cf){return function(cg){return cf("Ok I did not switch to user "+P.toSafe(cg)+".");};}(a.id))(bT)):(G.debug((function(cf){return function(cg){return cf("Did not understand "+P.printList(function(ch){return K.p$7(ch);},cg)+".");};}(a.id))(bb)),b3(),b7("Sorry I didn't understand what you meant."),_.length>0?(bZ=U.nth(0,_),b0(bZ.get_Name())?b7(e.replace_tok("$0",_9.get_Item(bZ.get_Name()),bZ.get_Text())):b7(bZ.get_Text())):void 0);G.debug((function(cf){return function(cg){return cf("End context: "+P.prettyPrint(cg)+".");};}(a.id))(ba));G.debug((function(cf){return function(cg){return cf("End questions: "+P.prettyPrint(cg)+".");};}(a.id))(_));};G.haveQuestion=function(_8){return T.exists(function(_9){return _9.get_Name()===_8;},G.questions());};G.getQuestion=function(_8){return U.tryFind(function(_9){return _9.get_Name()===_8;},G.questions());};G.questions=function(){H.$cctor();return H.questions;};G.debug=function(_8){e.debug("Main",_8);};H.$cctor=function(){H.$cctor=a.ignore;H.questions=T.ofArray([new y({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new y({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"})]);};I.run=function(){var _8,_9;_8=O.ThisFunc(function(_,$){return((I.Main().get_Text())(_))($);});_9=I.Main().get_Options();a.$("#main").terminal(_8,_9);return W.get_Empty();};I.Main=function(){J.$cctor();return J.Main;};I.container=function(){J.$cctor();return J.container;};I.wait=function(_8){e["Terminal.Echo'"](I.CUI().Term,"please wait");I.CUI().Term.pause();_8();I.CUI().Term.resume();};I.sayRandom=function(_8,_9){I.say(m.getRandomPhrase(_9,_8));};I.sayVoices=function(){var _8;_8=e.toArray(a.speechSynthesis.getVoices());I["say'"]((function(_9){return function(_){return _9("There are currently "+a.String(_)+" voices installed on this computer or device.");};}(a.id))(S.length(_8)));S.iteri(function(_9,_){return I["say'"](((((O.Curried(function($,ba,bb,bc){return $("Voice "+a.String(ba)+". Name: "+P.toSafe(bb)+", Local: "+P.prettyPrint(bc)+".");},4))(a.id))(_9))(_.name))(_.localService));},_8);};I.say=function(_8){I.Responses().unshift(_8);I["say'"](_8);};I["say'"]=function(_8){var _9,_,$;_9=I.CUI().Voice;_9!=null&&_9.$==1?(_=_9.$0,Y.Start(($=null,Y.Delay(function(){var ba;ba=new a.SpeechSynthesisUtterance(_8);ba.voice=_;a.speechSynthesis.speak(ba);I.CUI().Caption?e["Terminal.Echo'"](I.CUI().Term,_8):void 0;return Y.Zero();})),null)):e["Terminal.Echo'"](I.CUI().Term,_8);};I.initMic=function(_8,_9){var _,$;I.set_CUI((_={$:1,$0:new _3.Microphone(_4.getElementById("microphone"))},r.New(I.CUI().Voice,_,I.CUI().Term,I.CUI().Caption)));$=I.CUI().Mic.$0;$.onconnecting=function(){I.set_MicState(o.MicConnecting);return I.debug("Mic connecting...");};$.ondisconnected=function(){I.set_MicState(o.MicDisconnected);return I.debug("Mic disconnected.");};$.onaudiostart=function(){I.set_MicState(o.MicAudioStart);return I.debug("Mic audio start...");};$.onaudioend=function(){I.set_MicState(o.MicAudioEnd);return I.debug("Mic audio end.");};$.onerror=function(ba){I.set_MicState({$:6,$0:ba});return I.debug((function(bb){return function(bc){return bb("Mic error : "+P.toSafe(bc)+".");};}(a.id))(ba));};$.onready=function(){I.set_MicState(o.MicReady);return I.debug("Mic ready.");};$.onresult=function(ba,bb){return I.ClientState().$==2?I.echo("I'm still trying to understand what you said before."):I.ClientState().$==0?e.error("Client is not intialized."):!(ba==null||bb==null)?(I.set_MicState({$:7,$0:ba,$1:bb}),I.debug((((O.Curried3(function(bc,bd,be){return bc("Mic result: "+P.prettyPrint(bd)+" "+P.prettyPrint(be)+".");}))(a.id))(ba))(bb)),_8($,[ba,bb])):I.debug("Mic: No result returned.");};$.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};I.initSpeech=function(){var _8;_8=e.toArray(I.synth().getVoices());S.iter(function(_9){if(_5.Equals(I.CUI().Voice,null)&&(_9.name.indexOf("Microsoft Zira")!=-1||_9.name.toLowerCase().indexOf("female")!=-1)){I.set_CUI(r.New({$:1,$0:_9},I.CUI().Mic,I.CUI().Term,I.CUI().Caption));I.debug((function(_){return function($){return _("Using voice "+P.toSafe($)+".");};}(a.id))(I.CUI().Voice.$0.name));}},_8);_5.Equals(I.CUI().Voice,null)&&S.length(_8)>0?(I.set_CUI(r.New({$:1,$0:S.find(function(_9){return _9["default"];},_8)},I.CUI().Mic,I.CUI().Term,I.CUI().Caption)),I.debug((function(_9){return function(_){return _9("Using default voice "+P.toSafe(_)+".");};}(a.id))(I.CUI().Voice.$0.name))):_5.Equals(I.CUI().Voice,null)?I.echo("No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma."):void 0;};I.synth=function(){J.$cctor();return J.synth;};I.push=function(_8){I.Context().unshift(_8);return I.Context();};I.Props=function(){J.$cctor();return J.Props;};I.Responses=function(){J.$cctor();return J.Responses;};I.Questions=function(){J.$cctor();return J.Questions;};I.Context=function(){J.$cctor();return J.Context;};I.debug=function(_8){e.debug("CLIENT",_8);};I.echo=function(_8){if(!(I.CUI().Term==null))e["Terminal.EchoHtml'"](I.CUI().Term,(function(_9){return function(_){return _9(P.prettyPrint(_));};}(a.id))(_8));};I.ClientState=function(){J.$cctor();return J.ClientState;};I.set_ClientState=function(_8){J.$cctor();J.ClientState=_8;};I.MicState=function(){J.$cctor();return J.MicState;};I.set_MicState=function(_8){J.$cctor();J.MicState=_8;};I.CUI=function(){J.$cctor();return J.CUI;};I.set_CUI=function(_8){J.$cctor();J.CUI=_8;};J.$cctor=function(){var _8;J.$cctor=a.ignore;function _9($,ba){var bb,bc,bd,be,bf,bg,bh,bi,bj,bk;bb=ba[0];bc=ba[1];I.debug((((O.Curried3(function(bl,bm,bn){return bl("Voice: "+P.prettyPrint(bm)+" "+P.prettyPrint(bn));}))(a.id))(bb))(bc));bd=(be=z["Intent'"](bb,bc),be!=null&&be.$==1?{$:1,$0:be.$0}:null);bf=(bg=z["Trait'"](bc),bg!=null&&bg.$==1?{$:1,$0:bg.$0}:null);bh=(bi=z["Entity'$1"](bc),bi!=null&&bi.$==1?{$:1,$0:T.ofArray([bi.$0])}:null);return bd==null&&(bf==null&&bh==null)?null:(I.debug(((((O.Curried(function(bl,bm,bn,bo){return bl("Voice: "+K.p(bm)+" "+K.p$3(bn)+" "+K.p$5(bo));},4))(a.id))(bd))(bf))(bh)),bk=I.push(new x({$:0,$0:bd,$1:bf,$2:bh})),G.update(I.CUI(),I.Props(),I.Questions(),I.Responses(),bk));}function _($,ba){var bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl;I.set_CUI(r.New(I.CUI().Voice,I.CUI().Mic,$,I.CUI().Caption));_5.Equals(I.CUI().Mic,null)?I.initMic(_9,$):void 0;_5.Equals(I.CUI().Voice,null)?I.initSpeech():void 0;I.ClientState().$===0?I.set_ClientState(p.ClientReady):void 0;return(bb=B.Blank(ba),bb!=null&&bb.$==1)?I["say'"]("Tell me what you want me to do or ask me a question."):(bc=B.Debug(ba),bc!=null&&bc.$==1)?(I.debug((function(bm){return function(bn){return bm("Context: "+P.prettyPrint(bn));};}(a.id))(I.Context())),I.debug((function(bm){return function(bn){return bm("Questions: "+P.prettyPrint(bn));};}(a.id))(I.Questions()))):(bd=B.Voices(ba),bd!=null&&bd.$==1)?I.sayVoices():I.ClientState().$==1?(bf=B.QuickHello(ba),bf!=null&&bf.$==1?(be=bf.$0,true):(bg=B.QuickHelp(ba),bg!=null&&bg.$==1?(be=bg.$0,true):(bh=B.QuickYes(ba),bh!=null&&bh.$==1?(be=bh.$0,true):(bi=B.QuickNo(ba),bi!=null&&bi.$==1?(be=bi.$0,true):(bj=B.QuickPrograms(ba),bj!=null&&bj.$==1&&(be=bj.$0,true))))))?(I.debug((function(bm){return function(bn){return bm("Quick Text: "+K.p$7(bn)+".");};}(a.id))(be)),bk=I.push(be),G.update(I.CUI(),I.Props(),I.Questions(),I.Responses(),bk),I.set_ClientState(p.ClientReady)):I.CUI().Wait((bl=null,Y.Delay(function(){I.set_ClientState(p.ClientUnderstand);return Y.Combine(Y.Bind((new _2.New()).Async("Sylvester.Web.Thea:Sylvester.Web.Thea.Server.GetMeaning:-1158914928",[ba]),function(bm){var bn,bo,bp;bn=B.HasMeaning(bm);return bn!=null&&bn.$==1?(bo=bn.$0,(I.debug(((((O.Curried(function(bq,br,bs,bt){return bq("Text: "+K.p(br)+" "+K.p$3(bs)+" "+K.p$5(bt));},4))(a.id))(bo.get_Intent()))(bo.get_Trait()))(bo.get_Entities())),bp=I.push(bo),G.update(I.CUI(),I.Props(),I.Questions(),I.Responses(),bp),Y.Zero())):(I.debug("Text: Did not receive a meaning from the server."),I["say'"]("Sorry I did not understand what you said."),Y.Zero());}),Y.Delay(function(){I.set_ClientState(p.ClientReady);return Y.Zero();}));}))):I.ClientState().$==0?e.error("Client is not initialized."):I["say'"]("I'm still trying to understand what you said before.");}J.CUI=r.New(null,null,null,false);J.MicState=o.MicNotInitialized;J.ClientState=p.ClientNotInitialzed;J.Context=[];J.Questions=[];J.Responses=[];J.Props=new _7.New$5();J.synth=a.speechSynthesis;J.container=k.Container;J.Main=new q({$:0,$0:function($){return function(ba){return _9($,ba);};},$1:[function($){return function(ba){return _($,ba);};},(_8={},_8.name="Main",_8.greetings="Welcome to Selma. Enter 'hello my name is...(you)' to begin and initialize speech or help for more assistance.",_8.prompt=">",_8)]});};K.p$8=function(_8){return"Question ("+P.prettyPrint(_8.$0)+", "+P.prettyPrint(_8.$1)+")";};K.p$2=function(_8){return _8==null?"null":"Some "+P.prettyPrint(_8.$0);};K.p$1=function(_8){return"Intent ("+P.prettyPrint(_8.$0)+", "+K.p$2(_8.$1)+")";};K.p=function(_8){return _8==null?"null":"Some "+K.p$1(_8.$0);};K.p$4=function(_8){return"Trait ("+P.prettyPrint(_8.$0)+", "+P.prettyPrint(_8.$1)+")";};K.p$3=function(_8){return _8==null?"null":"Some "+K.p$4(_8.$0);};K.p$6=function(_8){return"Entity ("+P.prettyPrint(_8.$0)+", "+P.prettyPrint(_8.$1)+", "+K.p$2(_8.$2)+")";};K.p$5=function(_8){return _8==null?"null":"Some "+P.printList(function(_9){return K.p$6(_9);},_8.$0);};K.p$7=function(_8){return"Meaning ("+K.p(_8.$0)+", "+K.p$3(_8.$1)+", "+K.p$5(_8.$2)+")";};}());
